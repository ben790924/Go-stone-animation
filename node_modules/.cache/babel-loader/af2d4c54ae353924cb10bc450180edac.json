{"remainingRequest":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/babel-loader/lib/index.js!/Users/linchengxun/Desktop/vuego-testfunc/node_modules/eslint-loader/index.js??ref--13-0!/Users/linchengxun/Desktop/vuego-testfunc/src/assets/wgo.js","dependencies":[{"path":"/Users/linchengxun/Desktop/vuego-testfunc/src/assets/wgo.js","mtime":1552875321440},{"path":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _parseInt from \"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/@babel/runtime-corejs2/core-js/parse-int\";\nimport \"core-js/modules/es6.array.fill\";\nimport _typeof from \"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\nimport _Object$create from \"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/@babel/runtime-corejs2/core-js/object/create\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.regexp.search\";\nimport \"core-js/modules/es6.regexp.split\";\n\n/* eslint-disable */\n\n/*!\n * Copyright (c) 2013 Jan Prokop\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this\n * software and associated documentation files (the \"Software\"), to deal in the Software\n * without restriction, including without limitation the rights to use, copy, modify, merge,\n * publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons\n * to whom the Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all copies or\n * substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n * BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/* WGo.js 2.3.1 */\n(function (window, undefined) {\n  \"use strict\";\n\n  var scripts = document.getElementsByTagName('script');\n  var path = scripts[scripts.length - 1].src.split('?')[0]; // remove any ?query\n\n  var mydir = path.split('/').slice(0, -1).join('/') + '/';\n  /**\n   * Main namespace - it initializes WGo in first run and then execute main function.\n   * You must call WGo.init() if you want to use library, without calling WGo.\n   */\n\n  var WGo = {\n    // basic information\n    version: \"2.3.1\",\n    // constants for colors (rather use WGo.B or WGo.W)\n    B: 1,\n    W: -1,\n    // if true errors will be shown in dialog window, otherwise they will be ignored\n    ERROR_REPORT: true,\n    DIR: mydir,\n    // Language of player, you can change this global variable any time. Object WGo.i18n.<your lang> must exist.\n    lang: \"en\",\n    // Add terms for each language here\n    i18n: {\n      en: {}\n    } // browser detection - can be handy\n\n  };\n  WGo.opera = navigator.userAgent.search(/(opera)(?:.*version)?[ \\/]([\\w.]+)/i) != -1;\n  WGo.webkit = navigator.userAgent.search(/(webkit)[ \\/]([\\w.]+)/i) != -1;\n  WGo.msie = navigator.userAgent.search(/(msie) ([\\w.]+)/i) != -1;\n  WGo.mozilla = navigator.userAgent.search(/(mozilla)(?:.*? rv:([\\w.]+))?/i) != -1 && !WGo.webkit && !WGo.msie; // translating function\n\n  WGo.t = function (str) {\n    var loc = WGo.i18n[WGo.lang][str] || WGo.i18n.en[str];\n\n    if (loc) {\n      for (var i = 1; i < arguments.length; i++) {\n        loc = loc.replace(\"$\", arguments[i]);\n      }\n\n      return loc;\n    }\n\n    return str;\n  }; // helping function for class inheritance\n\n\n  WGo.extendClass = function (parent, child) {\n    child.prototype = _Object$create(parent.prototype);\n    child.prototype.constructor = child;\n    child.prototype.super = parent;\n    return child;\n  }; // helping function for class inheritance\n\n\n  WGo.abstractMethod = function () {\n    throw Error('unimplemented abstract method');\n  }; // helping function for deep cloning of simple objects,\n\n\n  WGo.clone = function (obj) {\n    if (obj && _typeof(obj) == \"object\") {\n      var n_obj = obj.constructor == Array ? [] : {};\n\n      for (var key in obj) {\n        if (obj[key] == obj) n_obj[key] = obj;else n_obj[key] = WGo.clone(obj[key]);\n      }\n\n      return n_obj;\n    } else return obj;\n  }; // filter html to avoid XSS\n\n\n  WGo.filterHTML = function (text) {\n    if (!text || typeof text != \"string\") return text;\n    return text.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n  }; //---------------------- WGo.Board -----------------------------------------------------------------------------\n\n  /**\n   * Board class constructor - it creates a canvas board\n   *\n   * @param elem DOM element to put in\n   * @param config configuration object. It is object with \"key: value\" structure. Possible configurations are:\n   *\n   * - size: number - size of the board (default: 19)\n   * - width: number - width of the board (default: 0)\n   * - height: number - height of the board (default: 0)\n   * - font: string - font of board writings (!deprecated)\n   * - lineWidth: number - line width of board drawings (!deprecated)\n   * - autoLineWidth: boolean - if set true, line width will be automatically computed accordingly to board size - this option rewrites 'lineWidth' /and it will keep markups sharp/ (!deprecated)\n   * - starPoints: Object - star points coordinates, defined for various board sizes. Look at Board.default for more info.\n   * - stoneHandler: Board.DrawHandler - stone drawing handler (default: Board.drawHandlers.SHELL)\n   * - starSize: number - size of star points (default: 1). Radius of stars is dynamic, however you can modify it by given constant. (!deprecated)\n   * - stoneSize: number - size of stone (default: 1). Radius of stone is dynamic, however you can modify it by given constant. (!deprecated)\n   * - shadowSize: number - size of stone shadow (default: 1). Radius of shadow is dynamic, however you can modify it by given constant. (!deprecated)\n   * - background: string - background of the board, it can be either color (#RRGGBB) or url. Empty string means no background. (default: WGo.DIR+\"wood1.jpg\")\n   * - section: {\n   *     top: number,\n   *     right: number,\n   *     bottom: number,\n   *     left: number\n   *   }\n   *   It defines a section of board to be displayed. You can set a number of rows(or cols) to be skipped on each side.\n   *   Numbers can be negative, in that case there will be more empty space. In default all values are zeros.\n   * - theme: Object - theme object, which defines all graphical attributes of the board. Default theme object is \"WGo.Board.themes.default\". For old look you may use \"WGo.Board.themes.old\".\n   *\n   * Note: properties lineWidth, autoLineWidth, starPoints, starSize, stoneSize and shadowSize will be considered only if you set property 'theme' to 'WGo.Board.themes.old'.\n   */\n\n\n  var Board = function Board(elem, config) {\n    var config = config || {}; // set user configuration\n\n    for (var key in config) {\n      this[key] = config[key];\n    } // add default configuration\n\n\n    for (var key in WGo.Board.default) {\n      if (this[key] === undefined) this[key] = WGo.Board.default[key];\n    } // add default theme variables\n\n\n    for (var key in Board.themes.default) {\n      if (this.theme[key] === undefined) this.theme[key] = Board.themes.default[key];\n    } // set section if set\n\n\n    this.tx = this.section.left;\n    this.ty = this.section.top;\n    this.bx = this.size - 1 - this.section.right;\n    this.by = this.size - 1 - this.section.bottom; // init board\n\n    this.init(); // append to element\n\n    elem.appendChild(this.element); // set initial dimensions\n    // set the pixel ratio for HDPI (e.g. Retina) screens\n\n    this.pixelRatio = window.devicePixelRatio || 1;\n    if (this.width && this.height) this.setDimensions(this.width, this.height);else if (this.width) this.setWidth(this.width);else if (this.height) this.setHeight(this.height);\n  }; // New experimental board theme system - it can be changed in future, if it will appear to be unsuitable.\n\n\n  Board.themes = {};\n  Board.themes.old = {\n    shadowColor: \"rgba(32,32,32,0.5)\",\n    shadowTransparentColor: \"rgba(32,32,32,0)\",\n    shadowBlur: 0,\n    shadowSize: function shadowSize(board) {\n      return board.shadowSize;\n    },\n    markupBlackColor: \"rgba(255,255,255,0.8)\",\n    markupWhiteColor: \"rgba(0,0,0,0.8)\",\n    markupNoneColor: \"rgba(0,0,0,0.8)\",\n    markupLinesWidth: function markupLinesWidth(board) {\n      return board.autoLineWidth ? board.stoneRadius / 7 : board.lineWidth;\n    },\n    gridLinesWidth: 1,\n    gridLinesColor: function gridLinesColor(board) {\n      return \"rgba(0,0,0,\" + Math.min(1, board.stoneRadius / 15) + \")\";\n    },\n    starColor: \"#000\",\n    starSize: function starSize(board) {\n      return board.starSize * (board.width / 300 + 1);\n    },\n    stoneSize: function stoneSize(board) {\n      return board.stoneSize * Math.min(board.fieldWidth, board.fieldHeight) / 2;\n    },\n    coordinatesColor: \"rgba(0,0,0,0.7)\",\n    font: function font(board) {\n      return board.font;\n    },\n    linesShift: 0.5\n    /**\n     * Object containing default graphical properties of a board.\n     * A value of all properties can be even static value or function, returning final value.\n     * Theme object doesn't set board and stone textures - they are set separately.\n     */\n\n  };\n  Board.themes.default = {\n    shadowColor: \"rgba(62,32,32,0.5)\",\n    shadowTransparentColor: \"rgba(62,32,32,0)\",\n    shadowBlur: function shadowBlur(board) {\n      return board.stoneRadius * 0.1;\n    },\n    shadowSize: 1,\n    markupBlackColor: \"rgba(255,255,255,0.9)\",\n    markupWhiteColor: \"rgba(0,0,0,0.7)\",\n    markupNoneColor: \"rgba(0,0,0,0.7)\",\n    markupLinesWidth: function markupLinesWidth(board) {\n      return board.stoneRadius / 8;\n    },\n    gridLinesWidth: function gridLinesWidth(board) {\n      return board.stoneRadius / 15;\n    },\n    gridLinesColor: \"#654525\",\n    starColor: \"#531\",\n    starSize: function starSize(board) {\n      return board.stoneRadius / 8 + 1;\n    },\n    stoneSize: function stoneSize(board) {\n      return Math.min(board.fieldWidth, board.fieldHeight) / 2;\n    },\n    coordinatesColor: \"#531\",\n    variationColor: \"rgba(0,32,128,0.8)\",\n    font: \"calibri\",\n    linesShift: 0.25\n  };\n\n  var theme_variable = function theme_variable(key, board) {\n    return typeof board.theme[key] == \"function\" ? board.theme[key](board) : board.theme[key];\n  };\n\n  var shadow_handler = {\n    draw: function draw(args, board) {\n      var xr = board.getX(args.x),\n          yr = board.getY(args.y),\n          sr = board.stoneRadius;\n      this.beginPath();\n      var blur = theme_variable(\"shadowBlur\", board);\n      var radius = Math.max(0, sr - 0.5);\n      var gradient = this.createRadialGradient(xr - board.ls, yr - board.ls, radius - 1 - blur, xr - board.ls, yr - board.ls, radius + blur);\n      gradient.addColorStop(0, theme_variable(\"shadowColor\", board));\n      gradient.addColorStop(1, theme_variable(\"shadowTransparentColor\", board));\n      this.fillStyle = gradient;\n      this.arc(xr - board.ls, yr - board.ls, radius + blur, 0, 2 * Math.PI, true);\n      this.fill();\n    },\n    clear: function clear(args, board) {\n      var xr = board.getX(args.x),\n          yr = board.getY(args.y),\n          sr = board.stoneRadius;\n      this.clearRect(xr - 1.1 * sr - board.ls, yr - 1.1 * sr - board.ls, 2.2 * sr, 2.2 * sr);\n    } // Shadow handler for the 'REALISITC' rendering mode\n\n  };\n  var shadow_handler_realistic = {\n    draw: function draw(args, board) {\n      var xr = board.getX(args.x),\n          yr = board.getY(args.y),\n          sr = board.stoneRadius,\n          lsX = 1.0,\n          lsY = -5.0,\n          blur = 5.0;\n      this.beginPath();\n      var radius = Math.max(0, (sr - 0.5) * 0.85);\n      var gradient = this.createRadialGradient(xr - lsX, yr - lsY, radius - 1 - blur, xr - lsX, yr - lsY, radius + blur);\n      gradient.addColorStop(0, theme_variable(\"shadowColor\", board));\n      gradient.addColorStop(1, theme_variable(\"shadowTransparentColor\", board));\n      this.fillStyle = gradient;\n      this.arc(xr - lsX, yr - lsY, radius + blur, 0, 2 * Math.PI, true);\n      this.fill();\n    },\n    clear: function clear(args, board) {\n      var xr = board.getX(args.x),\n          yr = board.getY(args.y),\n          sr = board.stoneRadius,\n          lsX = 1.0,\n          lsY = -5.0,\n          blur = 5.0;\n      this.clearRect(xr - 1.1 * sr - lsX, yr - 1.1 * sr - lsY, 2.2 * sr, 2.2 * sr);\n    }\n  };\n\n  var get_markup_color = function get_markup_color(board, x, y) {\n    if (board.obj_arr[x][y][0].c == WGo.B) return theme_variable(\"markupBlackColor\", board);else if (board.obj_arr[x][y][0].c == WGo.W) return theme_variable(\"markupWhiteColor\", board);\n    return theme_variable(\"markupNoneColor\", board);\n  };\n\n  var is_here_stone = function is_here_stone(board, x, y) {\n    return board.obj_arr[x][y][0] && board.obj_arr[x][y][0].c == WGo.W || board.obj_arr[x][y][0].c == WGo.B;\n  };\n\n  var redraw_layer = function redraw_layer(board, layer) {\n    var handler;\n    board[layer].clear();\n    board[layer].draw(board);\n\n    for (var x = 0; x < board.size; x++) {\n      for (var y = 0; y < board.size; y++) {\n        for (var z = 0; z < board.obj_arr[x][y].length; z++) {\n          var obj = board.obj_arr[x][y][z];\n          if (!obj.type) handler = board.stoneHandler;else if (typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];else handler = obj.type;\n          if (handler[layer]) handler[layer].draw.call(board[layer].getContext(obj), obj, board);\n        }\n      }\n    }\n\n    for (var i = 0; i < board.obj_list.length; i++) {\n      var obj = board.obj_list[i];\n      var handler = obj.handler;\n      if (handler[layer]) handler[layer].draw.call(board[layer].getContext(obj.args), obj.args, board);\n    }\n  }; // shell stone helping functions\n\n\n  var shell_seed;\n\n  var draw_shell_line = function draw_shell_line(ctx, x, y, radius, start_angle, end_angle, factor, thickness) {\n    ctx.strokeStyle = \"rgba(64,64,64,0.2)\";\n    ctx.lineWidth = radius / 30 * thickness;\n    ctx.beginPath();\n    radius -= Math.max(1, ctx.lineWidth);\n    var x1 = x + radius * Math.cos(start_angle * Math.PI);\n    var y1 = y + radius * Math.sin(start_angle * Math.PI);\n    var x2 = x + radius * Math.cos(end_angle * Math.PI);\n    var y2 = y + radius * Math.sin(end_angle * Math.PI);\n    var m, angle, x, diff_x, diff_y;\n\n    if (x2 > x1) {\n      m = (y2 - y1) / (x2 - x1);\n      angle = Math.atan(m);\n    } else if (x2 == x1) {\n      angle = Math.PI / 2;\n    } else {\n      m = (y2 - y1) / (x2 - x1);\n      angle = Math.atan(m) - Math.PI;\n    }\n\n    var c = factor * radius;\n    diff_x = Math.sin(angle) * c;\n    diff_y = Math.cos(angle) * c;\n    var bx1 = x1 + diff_x;\n    var by1 = y1 - diff_y;\n    var bx2 = x2 + diff_x;\n    var by2 = y2 - diff_y;\n    ctx.moveTo(x1, y1);\n    ctx.bezierCurveTo(bx1, by1, bx2, by2, x2, y2);\n    ctx.stroke();\n  };\n\n  var draw_shell = function draw_shell(arg) {\n    var from_angle = arg.angle;\n    var to_angle = arg.angle;\n\n    for (var i = 0; i < arg.lines.length; i++) {\n      from_angle += arg.lines[i];\n      to_angle -= arg.lines[i];\n      draw_shell_line(arg.ctx, arg.x, arg.y, arg.radius, from_angle, to_angle, arg.factor, arg.thickness);\n    }\n  }; // drawing handlers\n\n\n  Board.drawHandlers = {\n    // handler for normal stones\n    NORMAL: {\n      // draw handler for stone layer\n      stone: {\n        // drawing function - args object contain info about drawing object, board is main board object\n        // this function is called from canvas2D context\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius,\n              radgrad; // set stone texture\n\n          if (args.c == WGo.W) {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, sr / 3, xr - sr / 5, yr - sr / 5, 5 * sr / 5);\n            radgrad.addColorStop(0, '#fff');\n            radgrad.addColorStop(1, '#aaa');\n          } else {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 1, xr - sr / 5, yr - sr / 5, 4 * sr / 5);\n            radgrad.addColorStop(0, '#666');\n            radgrad.addColorStop(1, '#000');\n          } // paint stone\n\n\n          this.beginPath();\n          this.fillStyle = radgrad;\n          this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n          this.fill();\n        }\n      },\n      // adding shadow handler\n      shadow: shadow_handler\n    },\n    PAINTED: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius,\n              radgrad;\n\n          if (args.c == WGo.W) {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 2, xr - sr / 5, yr - sr / 5, 4 * sr / 5);\n            radgrad.addColorStop(0, '#fff');\n            radgrad.addColorStop(1, '#ddd');\n          } else {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 1, xr - sr / 5, yr - sr / 5, 4 * sr / 5);\n            radgrad.addColorStop(0, '#111');\n            radgrad.addColorStop(1, '#000');\n          }\n\n          this.beginPath();\n          this.fillStyle = radgrad;\n          this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n          this.fill();\n          this.beginPath();\n          this.lineWidth = sr / 6;\n\n          if (args.c == WGo.W) {\n            this.strokeStyle = '#999';\n            this.arc(xr + sr / 8, yr + sr / 8, sr / 2, 0, Math.PI / 2, false);\n          } else {\n            this.strokeStyle = '#ccc';\n            this.arc(xr - sr / 8, yr - sr / 8, sr / 2, Math.PI, 1.5 * Math.PI);\n          }\n\n          this.stroke();\n        }\n      },\n      shadow: shadow_handler\n    },\n    // handler for image based stones\n    REALISTIC: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          var whiteCount = board.whiteStoneGraphic.length;\n          var blackCount = board.blackStoneGraphic.length;\n\n          if (typeof this.randIndex === 'undefined') {\n            this.randIndex = Math.ceil(Math.random() * 1e5);\n          }\n\n          var redraw = function redraw() {\n            board.redraw();\n          }; // Check if image has been loaded properly\n          // see https://stereochro.me/ideas/detecting-broken-images-js\n\n\n          var isOkay = function isOkay(img) {\n            if (typeof img === 'string') {\n              return false;\n            }\n\n            if (!img.complete) {\n              return false;\n            }\n\n            if (typeof img.naturalWidth != \"undefined\" && img.naturalWidth == 0) {\n              return false;\n            }\n\n            return true;\n          };\n\n          if (args.c == WGo.W) {\n            var idx = this.randIndex % whiteCount;\n\n            if (typeof board.whiteStoneGraphic[idx] === 'string') {\n              // The image has not been loaded yet\n              var stoneGraphic = new Image(); // Redraw the whole board after the image has been loaded.\n              // This prevents 'missing stones' and similar graphical errors\n              // especially on slower internet connections.\n\n              stoneGraphic.onload = redraw;\n              stoneGraphic.src = board.whiteStoneGraphic[idx];\n              board.whiteStoneGraphic[idx] = stoneGraphic;\n            }\n\n            if (isOkay(board.whiteStoneGraphic[idx])) {\n              this.drawImage(board.whiteStoneGraphic[idx], xr - sr, yr - sr, 2 * sr, 2 * sr);\n            } else {\n              // Fall back to SHELL handler if there was a problem loading the image\n              Board.drawHandlers.SHELL.stone.draw.call(this, args, board);\n            }\n          } else {\n            // args.c == WGo.B\n            var idx = this.randIndex % blackCount;\n\n            if (typeof board.blackStoneGraphic[idx] === 'string') {\n              var stoneGraphic = new Image();\n              stoneGraphic.onload = redraw;\n              stoneGraphic.src = board.blackStoneGraphic[idx];\n              board.blackStoneGraphic[idx] = stoneGraphic;\n            }\n\n            if (isOkay(board.blackStoneGraphic[idx])) {\n              this.drawImage(board.blackStoneGraphic[idx], xr - sr, yr - sr, 2 * sr, 2 * sr);\n            } else {\n              Board.drawHandlers.SHELL.stone.draw.call(this, args, board);\n            }\n          }\n        }\n      },\n      shadow: shadow_handler_realistic\n    },\n    GLOW: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          var radgrad;\n\n          if (args.c == WGo.W) {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, sr / 3, xr - sr / 5, yr - sr / 5, 8 * sr / 5);\n            radgrad.addColorStop(0, '#fff');\n            radgrad.addColorStop(1, '#666');\n          } else {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 1, xr - sr / 5, yr - sr / 5, 3 * sr / 5);\n            radgrad.addColorStop(0, '#555');\n            radgrad.addColorStop(1, '#000');\n          }\n\n          this.beginPath();\n          this.fillStyle = radgrad;\n          this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n          this.fill();\n        }\n      },\n      shadow: shadow_handler\n    },\n    SHELL: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr,\n              yr,\n              sr = board.stoneRadius;\n          shell_seed = shell_seed || Math.ceil(Math.random() * 9999999);\n          xr = board.getX(args.x);\n          yr = board.getY(args.y);\n          var radgrad;\n\n          if (args.c == WGo.W) {\n            radgrad = \"#aaa\";\n          } else {\n            radgrad = \"#000\";\n          }\n\n          this.beginPath();\n          this.fillStyle = radgrad;\n          this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n          this.fill(); // do shell magic here\n\n          if (args.c == WGo.W) {\n            // do shell magic here\n            var type = shell_seed % (3 + args.x * board.size + args.y) % 3;\n            var z = board.size * board.size + args.x * board.size + args.y;\n            var angle = 2 / z * (shell_seed % z);\n\n            if (type == 0) {\n              draw_shell({\n                ctx: this,\n                x: xr,\n                y: yr,\n                radius: sr,\n                angle: angle,\n                lines: [0.10, 0.12, 0.11, 0.10, 0.09, 0.09, 0.09, 0.09],\n                factor: 0.25,\n                thickness: 1.75\n              });\n            } else if (type == 1) {\n              draw_shell({\n                ctx: this,\n                x: xr,\n                y: yr,\n                radius: sr,\n                angle: angle,\n                lines: [0.10, 0.09, 0.08, 0.07, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06],\n                factor: 0.2,\n                thickness: 1.5\n              });\n            } else {\n              draw_shell({\n                ctx: this,\n                x: xr,\n                y: yr,\n                radius: sr,\n                angle: angle,\n                lines: [0.12, 0.14, 0.13, 0.12, 0.12, 0.12],\n                factor: 0.3,\n                thickness: 2\n              });\n            }\n\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, sr / 3, xr - sr / 5, yr - sr / 5, 5 * sr / 5);\n            radgrad.addColorStop(0, 'rgba(255,255,255,0.9)');\n            radgrad.addColorStop(1, 'rgba(255,255,255,0)'); // add radial gradient //\n\n            this.beginPath();\n            this.fillStyle = radgrad;\n            this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n            this.fill();\n          } else {\n            radgrad = this.createRadialGradient(xr + 0.4 * sr, yr + 0.4 * sr, 0, xr + 0.5 * sr, yr + 0.5 * sr, sr);\n            radgrad.addColorStop(0, 'rgba(32,32,32,1)');\n            radgrad.addColorStop(1, 'rgba(0,0,0,0)');\n            this.beginPath();\n            this.fillStyle = radgrad;\n            this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n            this.fill();\n            radgrad = this.createRadialGradient(xr - 0.4 * sr, yr - 0.4 * sr, 1, xr - 0.5 * sr, yr - 0.5 * sr, 1.5 * sr);\n            radgrad.addColorStop(0, 'rgba(64,64,64,1)');\n            radgrad.addColorStop(1, 'rgba(0,0,0,0)');\n            this.beginPath();\n            this.fillStyle = radgrad;\n            this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n            this.fill();\n          }\n        }\n      },\n      shadow: shadow_handler\n    },\n    MONO: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius,\n              lw = theme_variable(\"markupLinesWidth\", board) || 1;\n          if (args.c == WGo.W) this.fillStyle = \"white\";else this.fillStyle = \"black\";\n          this.beginPath();\n          this.arc(xr, yr, Math.max(0, sr - lw), 0, 2 * Math.PI, true);\n          this.fill();\n          this.lineWidth = lw;\n          this.strokeStyle = \"black\";\n          this.stroke();\n        }\n      }\n    },\n    CR: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n          this.beginPath();\n          this.arc(xr - board.ls, yr - board.ls, sr / 2, 0, 2 * Math.PI, true);\n          this.stroke();\n        }\n      }\n    },\n    // Label drawing handler\n    LB: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius,\n              font = args.font || theme_variable(\"font\", board) || \"\";\n          this.fillStyle = args.c || get_markup_color(board, args.x, args.y);\n          if (args.text.length == 1) this.font = Math.round(sr * 1.5) + \"px \" + font;else if (args.text.length == 2) this.font = Math.round(sr * 1.2) + \"px \" + font;else this.font = Math.round(sr) + \"px \" + font;\n          this.beginPath();\n          this.textBaseline = \"middle\";\n          this.textAlign = \"center\";\n          this.fillText(args.text, xr, yr, 2 * sr);\n        }\n      },\n      // modifies grid layer too\n      grid: {\n        draw: function draw(args, board) {\n          if (!is_here_stone(board, args.x, args.y) && !args._nodraw) {\n            var xr = board.getX(args.x),\n                yr = board.getY(args.y),\n                sr = board.stoneRadius;\n            this.clearRect(xr - sr, yr - sr, 2 * sr, 2 * sr);\n          }\n        },\n        clear: function clear(args, board) {\n          if (!is_here_stone(board, args.x, args.y)) {\n            args._nodraw = true;\n            redraw_layer(board, \"grid\");\n            delete args._nodraw;\n          }\n        }\n      }\n    },\n    SQ: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = Math.round(board.stoneRadius);\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n          this.beginPath();\n          this.rect(Math.round(xr - sr / 2) - board.ls, Math.round(yr - sr / 2) - board.ls, sr, sr);\n          this.stroke();\n        }\n      }\n    },\n    TR: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n          this.beginPath();\n          this.moveTo(xr - board.ls, yr - board.ls - Math.round(sr / 2));\n          this.lineTo(Math.round(xr - sr / 2) - board.ls, Math.round(yr + sr / 3) + board.ls);\n          this.lineTo(Math.round(xr + sr / 2) + board.ls, Math.round(yr + sr / 3) + board.ls);\n          this.closePath();\n          this.stroke();\n        }\n      }\n    },\n    MA: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineCap = \"round\";\n          this.lineWidth = (args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1) * 2 - 1;\n          this.beginPath();\n          this.moveTo(Math.round(xr - sr / 2), Math.round(yr - sr / 2));\n          this.lineTo(Math.round(xr + sr / 2), Math.round(yr + sr / 2));\n          this.moveTo(Math.round(xr + sr / 2) - 1, Math.round(yr - sr / 2));\n          this.lineTo(Math.round(xr - sr / 2) - 1, Math.round(yr + sr / 2));\n          this.stroke();\n          this.lineCap = \"butt\";\n        }\n      }\n    },\n    SL: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.fillStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.beginPath();\n          this.rect(xr - sr / 2, yr - sr / 2, sr, sr);\n          this.fill();\n        }\n      }\n    },\n    SM: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineWidth = (args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1) * 2;\n          this.beginPath();\n          this.arc(xr - sr / 3, yr - sr / 3, sr / 6, 0, 2 * Math.PI, true);\n          this.stroke();\n          this.beginPath();\n          this.arc(xr + sr / 3, yr - sr / 3, sr / 6, 0, 2 * Math.PI, true);\n          this.stroke();\n          this.beginPath();\n          this.moveTo(xr - sr / 1.5, yr);\n          this.bezierCurveTo(xr - sr / 1.5, yr + sr / 2, xr + sr / 1.5, yr + sr / 2, xr + sr / 1.5, yr);\n          this.stroke();\n        }\n      }\n    },\n    outline: {\n      stone: {\n        draw: function draw(args, board) {\n          if (args.alpha) this.globalAlpha = args.alpha;else this.globalAlpha = 0.3;\n          if (args.stoneStyle) Board.drawHandlers[args.stoneStyle].stone.draw.call(this, args, board);else board.stoneHandler.stone.draw.call(this, args, board);\n          this.globalAlpha = 1;\n        }\n      }\n    },\n    mini: {\n      stone: {\n        draw: function draw(args, board) {\n          board.stoneRadius = board.stoneRadius / 2;\n          if (args.stoneStyle) Board.drawHandlers[args.stoneStyle].stone.draw.call(this, args, board);else board.stoneHandler.stone.draw.call(this, args, board);\n          board.stoneRadius = board.stoneRadius * 2;\n        }\n      }\n    }\n  };\n  Board.coordinates = {\n    grid: {\n      draw: function draw(args, board) {\n        var ch, t, xright, xleft, ytop, ybottom;\n        this.fillStyle = theme_variable(\"coordinatesColor\", board);\n        this.textBaseline = \"middle\";\n        this.textAlign = \"center\";\n        this.font = board.stoneRadius + \"px \" + (board.font || \"\");\n        xright = board.getX(-0.75);\n        xleft = board.getX(board.size - 0.25);\n        ytop = board.getY(-0.75);\n        ybottom = board.getY(board.size - 0.25);\n\n        for (var i = 0; i < board.size; i++) {\n          ch = i + \"A\".charCodeAt(0);\n          if (ch >= \"I\".charCodeAt(0)) ch++;\n          t = board.getY(i);\n          this.fillText(board.size - i, xright, t);\n          this.fillText(board.size - i, xleft, t);\n          t = board.getX(i);\n          this.fillText(String.fromCharCode(ch), t, ytop);\n          this.fillText(String.fromCharCode(ch), t, ybottom);\n        }\n\n        this.fillStyle = \"black\";\n      }\n    }\n  };\n\n  Board.CanvasLayer = function () {\n    this.element = document.createElement('canvas');\n    this.context = this.element.getContext('2d'); // Adjust pixel ratio for HDPI screens (e.g. Retina)\n\n    this.pixelRatio = window.devicePixelRatio || 1;\n\n    if (this.pixelRatio > 1) {\n      this.context.scale(this.pixelRatio, this.pixelRatio);\n    }\n  };\n\n  Board.CanvasLayer.prototype = {\n    constructor: Board.CanvasLayer,\n    setDimensions: function setDimensions(width, height) {\n      this.element.width = width;\n      this.element.style.width = width / this.pixelRatio + 'px';\n      this.element.height = height;\n      this.element.style.height = height / this.pixelRatio + 'px';\n    },\n    appendTo: function appendTo(element, weight) {\n      this.element.style.position = 'absolute';\n      this.element.style.zIndex = weight;\n      element.appendChild(this.element);\n    },\n    removeFrom: function removeFrom(element) {\n      element.removeChild(this.element);\n    },\n    getContext: function getContext() {\n      return this.context;\n    },\n    draw: function draw(board) {},\n    clear: function clear() {\n      this.context.clearRect(0, 0, this.element.width, this.element.height);\n    }\n  };\n  Board.GridLayer = WGo.extendClass(Board.CanvasLayer, function () {\n    this.super.call(this);\n  });\n\n  Board.GridLayer.prototype.draw = function (board) {\n    // draw grid\n    var tmp;\n    this.context.beginPath();\n    this.context.lineWidth = theme_variable(\"gridLinesWidth\", board);\n    this.context.strokeStyle = theme_variable(\"gridLinesColor\", board);\n    var tx = Math.round(board.left),\n        ty = Math.round(board.top),\n        bw = Math.round(board.fieldWidth * (board.size - 1)),\n        bh = Math.round(board.fieldHeight * (board.size - 1));\n    this.context.strokeRect(tx - board.ls, ty - board.ls, bw, bh);\n\n    for (var i = 1; i < board.size - 1; i++) {\n      tmp = Math.round(board.getX(i)) - board.ls;\n      this.context.moveTo(tmp, ty);\n      this.context.lineTo(tmp, ty + bh);\n      tmp = Math.round(board.getY(i)) - board.ls;\n      this.context.moveTo(tx, tmp);\n      this.context.lineTo(tx + bw, tmp);\n    }\n\n    this.context.stroke(); // draw stars\n\n    this.context.fillStyle = theme_variable(\"starColor\", board);\n\n    if (board.starPoints[board.size]) {\n      for (var key in board.starPoints[board.size]) {\n        this.context.beginPath();\n        this.context.arc(board.getX(board.starPoints[board.size][key].x) - board.ls, board.getY(board.starPoints[board.size][key].y) - board.ls, theme_variable(\"starSize\", board), 0, 2 * Math.PI, true);\n        this.context.fill();\n      }\n    }\n  };\n  /**\n   * Layer that is composed from more canvases. The proper canvas is selected according to drawn object.\n   * In default there are 4 canvases and they are used for board objects like stones. This allows overlapping of objects.\n   */\n\n\n  Board.MultipleCanvasLayer = WGo.extendClass(Board.CanvasLayer, function () {\n    this.init(4);\n  });\n\n  Board.MultipleCanvasLayer.prototype.init = function (n) {\n    var tmp, tmpContext;\n    this.layers = n;\n    this.elements = [];\n    this.contexts = []; // Adjust pixel ratio for HDPI screens (e.g. Retina)\n\n    this.pixelRatio = window.devicePixelRatio || 1;\n\n    for (var i = 0; i < n; i++) {\n      tmp = document.createElement('canvas');\n      tmpContext = tmp.getContext('2d');\n\n      if (this.pixelRatio > 1) {\n        tmpContext.scale(this.pixelRatio, this.pixelRatio);\n      }\n\n      this.elements.push(tmp);\n      this.contexts.push(tmpContext);\n    }\n  };\n\n  Board.MultipleCanvasLayer.prototype.appendTo = function (element, weight) {\n    for (var i = 0; i < this.layers; i++) {\n      this.elements[i].style.position = 'absolute';\n      this.elements[i].style.zIndex = weight;\n      element.appendChild(this.elements[i]);\n    }\n  };\n\n  Board.MultipleCanvasLayer.prototype.removeFrom = function (element) {\n    for (var i = 0; i < this.layers; i++) {\n      element.removeChild(this.elements[i]);\n    }\n  };\n\n  Board.MultipleCanvasLayer.prototype.getContext = function (args) {\n    if (args.x % 2) {\n      return args.y % 2 ? this.contexts[0] : this.contexts[1];\n    } else {\n      return args.y % 2 ? this.contexts[2] : this.contexts[3];\n    } //return ((args.x%2) && (args.y%2) || !(args.x%2) && !(args.y%2)) ? this.context_odd : this.context_even;\n\n  };\n\n  Board.MultipleCanvasLayer.prototype.clear = function (element, weight) {\n    for (var i = 0; i < this.layers; i++) {\n      this.contexts[i].clearRect(0, 0, this.elements[i].width, this.elements[i].height);\n    }\n  };\n\n  Board.MultipleCanvasLayer.prototype.setDimensions = function (width, height) {\n    for (var i = 0; i < this.layers; i++) {\n      this.elements[i].width = width;\n      this.elements[i].style.width = width / this.pixelRatio + 'px';\n      this.elements[i].height = height;\n      this.elements[i].style.height = height / this.pixelRatio + 'px';\n    }\n  };\n\n  Board.ShadowLayer = WGo.extendClass(Board.MultipleCanvasLayer, function (board, shadowSize, shadowBlur) {\n    this.init(2);\n    this.shadowSize = shadowSize === undefined ? 1 : shadowSize;\n    this.board = board;\n  });\n\n  Board.ShadowLayer.prototype.getContext = function (args) {\n    return args.x % 2 && args.y % 2 || !(args.x % 2) && !(args.y % 2) ? this.contexts[0] : this.contexts[1];\n  };\n\n  Board.ShadowLayer.prototype.setDimensions = function (width, height) {\n    this.super.prototype.setDimensions.call(this, width, height);\n\n    for (var i = 0; i < this.layers; i++) {\n      this.contexts[i].setTransform(1, 0, 0, 1, Math.round(this.shadowSize * this.board.stoneRadius / 7), Math.round(this.shadowSize * this.board.stoneRadius / 7));\n    }\n  };\n\n  var default_field_clear = function default_field_clear(args, board) {\n    var xr = board.getX(args.x),\n        yr = board.getY(args.y),\n        sr = board.stoneRadius;\n    this.clearRect(xr - 2 * sr - board.ls, yr - 2 * sr - board.ls, 4 * sr, 4 * sr);\n  }; // Private methods of WGo.Board\n\n\n  var calcLeftMargin = function calcLeftMargin() {\n    return 3 * this.width / (4 * (this.bx + 1 - this.tx) + 2) - this.fieldWidth * this.tx;\n  };\n\n  var calcTopMargin = function calcTopMargin() {\n    return 3 * this.height / (4 * (this.by + 1 - this.ty) + 2) - this.fieldHeight * this.ty;\n  };\n\n  var calcFieldWidth = function calcFieldWidth() {\n    return 4 * this.width / (4 * (this.bx + 1 - this.tx) + 2);\n  };\n\n  var calcFieldHeight = function calcFieldHeight() {\n    return 4 * this.height / (4 * (this.by + 1 - this.ty) + 2);\n  };\n\n  var clearField = function clearField(x, y) {\n    var handler;\n\n    for (var z = 0; z < this.obj_arr[x][y].length; z++) {\n      var obj = this.obj_arr[x][y][z];\n      if (!obj.type) handler = this.stoneHandler;else if (typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];else handler = obj.type;\n\n      for (var layer in handler) {\n        if (handler[layer].clear) handler[layer].clear.call(this[layer].getContext(obj), obj, this);else default_field_clear.call(this[layer].getContext(obj), obj, this);\n      }\n    }\n  };\n\n  var drawField = function drawField(x, y, k) {\n    var handler; // console.log(mouseEvt)\n\n    for (var z = 0; z < this.obj_arr[x][y].length; z++) {\n      var obj = this.obj_arr[x][y][z]; // console.log('obj',obj)\n      // console.log('k',k)\n\n      if (!obj.type) handler = this.stoneHandler;else if (typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];else handler = obj.type;\n\n      for (var layer in handler) {\n        handler[layer].draw.call(this[layer].getContext(obj), obj, this);\n      }\n    }\n  };\n\n  var getMousePos = function getMousePos(e) {\n    // new hopefully better translation of coordinates\n    var x, y, k;\n    k = e.clientX;\n    x = e.offsetX * this.pixelRatio;\n    x -= this.left;\n    x /= this.fieldWidth;\n    x = Math.round(x);\n    y = e.offsetY * this.pixelRatio;\n    y -= this.top;\n    y /= this.fieldHeight;\n    y = Math.round(y); // console.log('getmousePos',x,y)\n\n    return {\n      x: x >= this.size ? -1 : x,\n      y: y >= this.size ? -1 : y,\n      k: k\n    };\n  };\n\n  var updateDim = function updateDim() {\n    this.element.style.width = this.width / this.pixelRatio + \"px\";\n    this.element.style.height = this.height / this.pixelRatio + \"px\";\n    this.stoneRadius = theme_variable(\"stoneSize\", this); //if(this.autoLineWidth) this.lineWidth = this.stoneRadius/7; //< 15 ? 1 : 3;\n\n    this.ls = theme_variable(\"linesShift\", this);\n\n    for (var i = 0; i < this.layers.length; i++) {\n      this.layers[i].setDimensions(this.width, this.height);\n    }\n  }; // Public methods are in the prototype:\n\n\n  Board.prototype = {\n    constructor: Board,\n\n    /**\n     * Initialization method, it is called in constructor. You shouldn't call it, but you can alter it.\n     */\n    init: function init() {\n      // placement of objects (in 3D array)\n      this.obj_arr = [];\n\n      for (var i = 0; i < this.size; i++) {\n        this.obj_arr[i] = [];\n\n        for (var j = 0; j < this.size; j++) {\n          this.obj_arr[i][j] = [];\n        }\n      } // other objects, stored in list\n\n\n      this.obj_list = []; // layers\n\n      this.layers = []; // event listeners, binded to board\n\n      this.listeners = [];\n      this.element = document.createElement('div');\n      this.element.className = 'wgo-board';\n      this.element.style.position = 'relative';\n\n      if (this.background) {\n        if (this.background[0] == \"#\") this.element.style.backgroundColor = this.background;else {\n          this.element.style.backgroundImage = \"url('\" + this.background + \"')\";\n          /*this.element.style.backgroundRepeat = \"repeat\";*/\n\n          if (this.stoneHandler == Board.drawHandlers.REALISTIC) {\n            // The photographed wood images do not repeat and are the size of an actual\n            // Go-Board. Therefore scale to fit.\n            this.element.style.backgroundSize = \"100%\";\n          }\n        }\n      }\n\n      this.grid = new Board.GridLayer();\n      this.shadow = new Board.ShadowLayer(this, theme_variable(\"shadowSize\", this));\n      this.stone = new Board.MultipleCanvasLayer();\n      this.addLayer(this.grid, 100);\n      this.addLayer(this.shadow, 200);\n      this.addLayer(this.stone, 300);\n    },\n\n    /**\n     * Set new width of board, height is computed to keep aspect ratio.\n     *\n     * @param {number} width\n     */\n    setWidth: function setWidth(width) {\n      this.width = width;\n      this.width *= this.pixelRatio;\n      this.fieldHeight = this.fieldWidth = calcFieldWidth.call(this);\n      this.left = calcLeftMargin.call(this);\n      this.height = (this.by - this.ty + 1.5) * this.fieldHeight;\n      this.top = calcTopMargin.call(this);\n      updateDim.call(this);\n      this.redraw();\n    },\n\n    /**\n     * Set new height of board, width is computed to keep aspect ratio.\n     *\n     * @param {number} height\n     */\n    setHeight: function setHeight(height) {\n      this.height = height;\n      this.height *= this.pixelRatio;\n      this.fieldWidth = this.fieldHeight = calcFieldHeight.call(this);\n      this.top = calcTopMargin.call(this);\n      this.width = (this.bx - this.tx + 1.5) * this.fieldWidth;\n      this.left = calcLeftMargin.call(this);\n      updateDim.call(this);\n      this.redraw();\n    },\n\n    /**\n     * Set both dimensions.\n     *\n     * @param {number} width\n     * @param {number} height\n     */\n    setDimensions: function setDimensions(width, height) {\n      this.width = width || _parseInt(this.element.style.width, 10);\n      this.width *= this.pixelRatio;\n      this.height = height || _parseInt(this.element.style.height, 10);\n      this.height *= this.pixelRatio;\n      this.fieldWidth = calcFieldWidth.call(this);\n      this.fieldHeight = calcFieldHeight.call(this);\n      this.left = calcLeftMargin.call(this);\n      this.top = calcTopMargin.call(this);\n      updateDim.call(this);\n      this.redraw();\n    },\n\n    /**\n     * Get currently visible section of the board\n     */\n    getSection: function getSection() {\n      return this.section;\n    },\n\n    /**\n     * Set section of the board to be displayed\n     */\n    setSection: function setSection(section_or_top, right, bottom, left) {\n      if (_typeof(section_or_top) == \"object\") {\n        this.section = section_or_top;\n      } else {\n        this.section = {\n          top: section_or_top,\n          right: right,\n          bottom: bottom,\n          left: left\n        };\n      }\n\n      this.tx = this.section.left;\n      this.ty = this.section.top;\n      this.bx = this.size - 1 - this.section.right;\n      this.by = this.size - 1 - this.section.bottom;\n      this.setDimensions();\n    },\n\n    /**\n     * Set board size (eg: 9, 13 or 19), this will clear board's objects.\n     */\n    setSize: function setSize(size) {\n      var size = size || 19;\n\n      if (size != this.size) {\n        this.size = size;\n        this.obj_arr = [];\n\n        for (var i = 0; i < this.size; i++) {\n          this.obj_arr[i] = [];\n\n          for (var j = 0; j < this.size; j++) {\n            this.obj_arr[i][j] = [];\n          }\n        }\n\n        this.bx = this.size - 1 - this.section.right;\n        this.by = this.size - 1 - this.section.bottom;\n        this.setDimensions();\n      }\n    },\n\n    /**\n     * Redraw everything.\n     */\n    redraw: function redraw() {\n      try {\n        // redraw layers\n        for (var i = 0; i < this.layers.length; i++) {\n          this.layers[i].clear(this);\n          this.layers[i].draw(this);\n        } // redraw field objects\n\n\n        for (var i = 0; i < this.size; i++) {\n          for (var j = 0; j < this.size; j++) {\n            drawField.call(this, i, j);\n          }\n        } // redraw custom objects\n\n\n        for (var i = 0; i < this.obj_list.length; i++) {\n          var obj = this.obj_list[i];\n          var handler = obj.handler;\n\n          for (var layer in handler) {\n            handler[layer].draw.call(this[layer].getContext(obj.args), obj.args, this);\n          }\n        }\n      } catch (err) {\n        // If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n        console.log(\"WGo board failed to render. Error: \" + err.message);\n      }\n    },\n\n    /**\n     * Get absolute X coordinate\n     *\n     * @param {number} x relative coordinate\n     */\n    getX: function getX(x) {\n      return this.left + x * this.fieldWidth;\n    },\n\n    /**\n     * Get absolute Y coordinate\n     *\n     * @param {number} y relative coordinate\n     */\n    getY: function getY(y) {\n      return this.top + y * this.fieldHeight;\n    },\n\n    /**\n     * Add layer to the board. It is meant to be only for canvas layers.\n     *\n     * @param {Board.CanvasLayer} layer to add\n     * @param {number} weight layer with biggest weight is on the top\n     */\n    addLayer: function addLayer(layer, weight) {\n      layer.appendTo(this.element, weight);\n      layer.setDimensions(this.width, this.height);\n      this.layers.push(layer);\n    },\n\n    /**\n     * Remove layer from the board.\n     *\n     * @param {Board.CanvasLayer} layer to remove\n     */\n    removeLayer: function removeLayer(layer) {\n      var i = this.layers.indexOf(layer);\n\n      if (i >= 0) {\n        this.layers.splice(i, 1);\n        layer.removeFrom(this.element);\n      }\n    },\n    update: function update(changes) {\n      var i;\n      if (changes.remove && changes.remove == \"all\") this.removeAllObjects();else if (changes.remove) {\n        for (i = 0; i < changes.remove.length; i++) {\n          this.removeObject(changes.remove[i]);\n        }\n      }\n\n      if (changes.add) {\n        for (i = 0; i < changes.add.length; i++) {\n          this.addObject(changes.add[i]);\n        }\n      }\n    },\n    addObject: function addObject(obj) {\n      // handling multiple objects\n      if (obj.constructor == Array) {\n        for (var i = 0; i < obj.length; i++) {\n          this.addObject(obj[i]);\n        }\n\n        return;\n      }\n\n      try {\n        // clear all objects on object's coordinates\n        clearField.call(this, obj.x, obj.y); // if object of this type is on the board, replace it\n\n        var layers = this.obj_arr[obj.x][obj.y];\n\n        for (var z = 0; z < layers.length; z++) {\n          if (layers[z].type == obj.type) {\n            layers[z] = obj;\n            drawField.call(this, obj.x, obj.y);\n            return;\n          }\n        } // if object is a stone, add it at the beginning, otherwise at the end\n\n\n        if (!obj.type) layers.unshift(obj);else layers.push(obj); // draw all objects\n\n        drawField.call(this, obj.x, obj.y);\n      } catch (err) {\n        // If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n        console.log(\"WGo board failed to render. Error: \" + err.message);\n      }\n    },\n    removeObject: function removeObject(obj) {\n      // handling multiple objects\n      if (obj.constructor == Array) {\n        for (var n = 0; n < obj.length; n++) {\n          this.removeObject(obj[n]);\n        }\n\n        return;\n      }\n\n      try {\n        var i;\n\n        for (var j = 0; j < this.obj_arr[obj.x][obj.y].length; j++) {\n          if (this.obj_arr[obj.x][obj.y][j].type == obj.type) {\n            i = j;\n            break;\n          }\n        }\n\n        if (i === undefined) return; // clear all objects on object's coordinates\n\n        clearField.call(this, obj.x, obj.y);\n        this.obj_arr[obj.x][obj.y].splice(i, 1);\n        drawField.call(this, obj.x, obj.y);\n      } catch (err) {\n        // If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n        console.log(\"WGo board failed to render. Error: \" + err.message);\n      }\n    },\n    removeObjectsAt: function removeObjectsAt(x, y) {\n      if (!this.obj_arr[x][y].length) return;\n      clearField.call(this, x, y);\n      this.obj_arr[x][y] = [];\n    },\n    removeAllObjects: function removeAllObjects() {\n      this.obj_arr = [];\n\n      for (var i = 0; i < this.size; i++) {\n        this.obj_arr[i] = [];\n\n        for (var j = 0; j < this.size; j++) {\n          this.obj_arr[i][j] = [];\n        }\n      }\n\n      this.redraw();\n    },\n    addCustomObject: function addCustomObject(handler, args) {\n      this.obj_list.push({\n        handler: handler,\n        args: args\n      });\n      this.redraw();\n    },\n    removeCustomObject: function removeCustomObject(handler, args) {\n      for (var i = 0; i < this.obj_list.length; i++) {\n        var obj = this.obj_list[i];\n\n        if (obj.handler == handler && obj.args == args) {\n          this.obj_list.splice(i, 1);\n          this.redraw();\n          return true;\n        }\n      }\n\n      return false;\n    },\n    addEventListener: function addEventListener(type, callback) {\n      var _this = this,\n          evListener = {\n        type: type,\n        callback: callback,\n        handleEvent: function handleEvent(e) {\n          var coo = getMousePos.call(_this, e);\n          callback(coo.x, coo.y, e);\n        }\n      };\n\n      this.element.addEventListener(type, evListener, true);\n      this.listeners.push(evListener);\n    },\n    removeEventListener: function removeEventListener(type, callback) {\n      for (var i = 0; i < this.listeners.length; i++) {\n        var listener = this.listeners[i];\n\n        if (listener.type == type && listener.callback == callback) {\n          this.element.removeEventListener(listener.type, listener, true);\n          this.listeners.splice(i, 1);\n          return true;\n        }\n      }\n\n      return false;\n    },\n    getState: function getState() {\n      return {\n        objects: WGo.clone(this.obj_arr),\n        custom: WGo.clone(this.obj_list)\n      };\n    },\n    restoreState: function restoreState(state) {\n      this.obj_arr = state.objects || this.obj_arr;\n      this.obj_list = state.custom || this.obj_list;\n      this.redraw();\n    }\n  };\n  Board.default = {\n    size: 19,\n    width: 0,\n    height: 0,\n    font: \"Calibri\",\n    // deprecated\n    lineWidth: 1,\n    // deprecated\n    autoLineWidth: false,\n    // deprecated\n    starPoints: {\n      5: [{\n        x: 2,\n        y: 2\n      }],\n      7: [{\n        x: 3,\n        y: 3\n      }],\n      8: [{\n        x: 2,\n        y: 2\n      }, {\n        x: 5,\n        y: 2\n      }, {\n        x: 2,\n        y: 5\n      }, {\n        x: 5,\n        y: 5\n      }],\n      9: [{\n        x: 2,\n        y: 2\n      }, {\n        x: 6,\n        y: 2\n      }, {\n        x: 4,\n        y: 4\n      }, {\n        x: 2,\n        y: 6\n      }, {\n        x: 6,\n        y: 6\n      }],\n      10: [{\n        x: 2,\n        y: 2\n      }, {\n        x: 7,\n        y: 2\n      }, {\n        x: 2,\n        y: 7\n      }, {\n        x: 7,\n        y: 7\n      }],\n      11: [{\n        x: 2,\n        y: 2\n      }, {\n        x: 8,\n        y: 2\n      }, {\n        x: 5,\n        y: 5\n      }, {\n        x: 2,\n        y: 8\n      }, {\n        x: 8,\n        y: 8\n      }],\n      12: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 8,\n        y: 3\n      }, {\n        x: 3,\n        y: 8\n      }, {\n        x: 8,\n        y: 8\n      }],\n      13: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 9,\n        y: 3\n      }, {\n        x: 6,\n        y: 6\n      }, {\n        x: 3,\n        y: 9\n      }, {\n        x: 9,\n        y: 9\n      }],\n      14: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 10,\n        y: 3\n      }, {\n        x: 3,\n        y: 10\n      }, {\n        x: 10,\n        y: 10\n      }],\n      15: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 11,\n        y: 3\n      }, {\n        x: 7,\n        y: 7\n      }, {\n        x: 3,\n        y: 11\n      }, {\n        x: 11,\n        y: 11\n      }],\n      16: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 12,\n        y: 3\n      }, {\n        x: 3,\n        y: 12\n      }, {\n        x: 12,\n        y: 12\n      }],\n      17: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 8,\n        y: 3\n      }, {\n        x: 13,\n        y: 3\n      }, {\n        x: 3,\n        y: 8\n      }, {\n        x: 8,\n        y: 8\n      }, {\n        x: 13,\n        y: 8\n      }, {\n        x: 3,\n        y: 13\n      }, {\n        x: 8,\n        y: 13\n      }, {\n        x: 13,\n        y: 13\n      }],\n      18: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 14,\n        y: 3\n      }, {\n        x: 3,\n        y: 14\n      }, {\n        x: 14,\n        y: 14\n      }],\n      19: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 9,\n        y: 3\n      }, {\n        x: 15,\n        y: 3\n      }, {\n        x: 3,\n        y: 9\n      }, {\n        x: 9,\n        y: 9\n      }, {\n        x: 15,\n        y: 9\n      }, {\n        x: 3,\n        y: 15\n      }, {\n        x: 9,\n        y: 15\n      }, {\n        x: 15,\n        y: 15\n      }],\n      20: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 16,\n        y: 3\n      }, {\n        x: 3,\n        y: 16\n      }, {\n        x: 16,\n        y: 16\n      }],\n      21: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 10,\n        y: 3\n      }, {\n        x: 17,\n        y: 3\n      }, {\n        x: 3,\n        y: 10\n      }, {\n        x: 10,\n        y: 10\n      }, {\n        x: 17,\n        y: 10\n      }, {\n        x: 3,\n        y: 17\n      }, {\n        x: 10,\n        y: 17\n      }, {\n        x: 17,\n        y: 17\n      }]\n    },\n    //stoneHandler: Board.drawHandlers.SHELL,\n    stoneHandler: Board.drawHandlers.REALISTIC,\n    // New photograph based stones\n    starSize: 1,\n    // deprecated\n    shadowSize: 1,\n    // deprecated\n    stoneSize: 1,\n    // deprecated\n    section: {\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0\n    },\n    //background: WGo.DIR+\"wood1.jpg\",    // Original version, tileing\n    //background: WGo.DIR+\"wood_512.jpg\", // Mobile friendly, low resolution\n    background: WGo.DIR + \"wood_1024.jpg\",\n    // High resolution version, use with REALISTIC handler\n    //whiteStoneGraphic: [ WGo.DIR+\"white_128.png\" ], // Single image only, hires\n    //blackStoneGraphic: [ WGo.DIR+\"black_128.png\" ], // Single image only, hires\n    //whiteStoneGraphic: [ WGo.DIR+\"white_64.png\" ], // Single image only, lowres\n    //blackStoneGraphic: [ WGo.DIR+\"black_64.png\" ], // Single image only, lowres\n    whiteStoneGraphic: [WGo.DIR + \"stones/white00_128.png\", WGo.DIR + \"stones/white01_128.png\", WGo.DIR + \"stones/white02_128.png\", WGo.DIR + \"stones/white03_128.png\", WGo.DIR + \"stones/white04_128.png\", WGo.DIR + \"stones/white05_128.png\", WGo.DIR + \"stones/white06_128.png\", WGo.DIR + \"stones/white07_128.png\", WGo.DIR + \"stones/white08_128.png\", WGo.DIR + \"stones/white09_128.png\", WGo.DIR + \"stones/white10_128.png\"],\n    blackStoneGraphic: [WGo.DIR + \"stones/black00_128.png\", WGo.DIR + \"stones/black01_128.png\", WGo.DIR + \"stones/black02_128.png\", WGo.DIR + \"stones/black03_128.png\"],\n    theme: {} // save Board\n\n  };\n  WGo.Board = Board; //-------- WGo.Game ---------------------------------------------------------------------------\n\n  /**\n   * Creates instance of position object.\n   *\n   * @class\n   * <p>WGo.Position is simple object storing position of go game. It is implemented as matrix <em>size</em> x <em>size</em> with values WGo.BLACK, WGo.WHITE or 0. It can be used by any extension.</p>\n   *\n   * @param {number} size of the board\n   */\n\n  var Position = function Position(size) {\n    this.size = size || 19;\n    this.schema = [];\n\n    for (var i = 0; i < this.size * this.size; i++) {\n      this.schema[i] = 0;\n    }\n  };\n\n  Position.prototype = {\n    constructor: WGo.Position,\n\n    /**\n     * Returns value of given coordinates.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @return {(WGo.BLACK|WGo.WHITE|0)} color\n     */\n    get: function get(x, y) {\n      if (x < 0 || y < 0 || x >= this.size || y >= this.size) return undefined;\n      return this.schema[x * this.size + y];\n    },\n\n    /**\n     * Sets value of given coordinates.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W|0)} c color\n     */\n    set: function set(x, y, c) {\n      this.schema[x * this.size + y] = c;\n      return this;\n    },\n\n    /**\n     * Clears the whole position (every value is set to 0).\n     */\n    clear: function clear() {\n      for (var i = 0; i < this.size * this.size; i++) {\n        this.schema[i] = 0;\n      }\n\n      return this;\n    },\n\n    /**\n     * Clones the whole position.\n     *\n     * @return {WGo.Position} copy of position\n     */\n    clone: function clone() {\n      var clone = new Position(this.size);\n      clone.schema = this.schema.slice(0);\n      return clone;\n    },\n\n    /**\n     * Compares this position with another position and return change object\n     *\n     * @param {WGo.Position} position to compare to.\n     * @return {object} change object with structure: {add:[], remove:[]}\n     */\n    compare: function compare(position) {\n      var add = [],\n          remove = [];\n\n      for (var i = 0; i < this.size * this.size; i++) {\n        if (this.schema[i] && !position.schema[i]) remove.push({\n          x: Math.floor(i / this.size),\n          y: i % this.size\n        });else if (this.schema[i] != position.schema[i]) add.push({\n          x: Math.floor(i / this.size),\n          y: i % this.size,\n          c: position.schema[i]\n        });\n      }\n\n      return {\n        add: add,\n        remove: remove\n      };\n    }\n  };\n  WGo.Position = Position;\n  /**\n   * Creates instance of game class.\n   *\n   * @class\n   * This class implements game logic. It basically analyses given moves and returns capture stones.\n   * WGo.Game also stores every position from beginning, so it has ability to check repeating positions\n   * and it can effectively restore old positions.</p>\n   *\n   * @param {number} size of the board\n   * @param {\"KO\"|\"ALL\"|\"NONE\"} checkRepeat (optional, default is \"KO\") - how to handle repeated position:\n   * KO - ko is properly handled - position cannot be same like previous position\n   * ALL - position cannot be same like any previous position - e.g. it forbids triple ko\n   * NONE - position can be repeated\n   *\n   * @param {boolean} allowRewrite (optional, default is false) - allow to play moves, which were already played:\n   * @param {boolean} allowSuicide (optional, default is false) - allow to play suicides, stones are immediately captured\n   */\n\n  var Game = function Game(size, checkRepeat, allowRewrite, allowSuicide) {\n    this.size = size || 19;\n    this.repeating = checkRepeat === undefined ? \"KO\" : checkRepeat; // possible values: KO, ALL or nothing\n\n    this.allow_rewrite = allowRewrite || false;\n    this.allow_suicide = allowSuicide || false;\n    this.stack = [];\n    this.stack[0] = new Position(this.size);\n    this.stack[0].capCount = {\n      black: 0,\n      white: 0\n    };\n    this.turn = WGo.B;\n    Object.defineProperty(this, \"position\", {\n      get: function get() {\n        return this.stack[this.stack.length - 1];\n      },\n      set: function set(pos) {\n        this.stack[this.stack.length - 1] = pos;\n      }\n    });\n  }; // function for stone capturing\n\n\n  var do_capture = function do_capture(position, captured, x, y, c) {\n    if (x >= 0 && x < position.size && y >= 0 && y < position.size && position.get(x, y) == c) {\n      position.set(x, y, 0);\n      captured.push({\n        x: x,\n        y: y\n      });\n      do_capture(position, captured, x, y - 1, c);\n      do_capture(position, captured, x, y + 1, c);\n      do_capture(position, captured, x - 1, y, c);\n      do_capture(position, captured, x + 1, y, c);\n    } // console.log('doCapture',position,captured,x,y,c)\n    // return {x,y} //do_capture在哪裡可以使用此函式？ 回傳後的x y 可以反算回x y的client位置\n\n  }; // looking at liberties\n\n\n  var check_liberties = function check_liberties(position, testing, x, y, c) {\n    // out of the board there aren't liberties\n    if (x < 0 || x >= position.size || y < 0 || y >= position.size) return true; // however empty field means liberty\n\n    if (position.get(x, y) == 0) return false; // already tested field or stone of enemy isn't giving us a liberty.\n\n    if (testing.get(x, y) == true || position.get(x, y) == -c) return true; // set this field as tested\n\n    testing.set(x, y, true); // in this case we are checking our stone, if we get 4 trues, it has no liberty\n\n    return check_liberties(position, testing, x, y - 1, c) && check_liberties(position, testing, x, y + 1, c) && check_liberties(position, testing, x - 1, y, c) && check_liberties(position, testing, x + 1, y, c);\n  }; // analysing function - modifies original position, if there are some capturing, and returns array of captured stones\n\n\n  var check_capturing = function check_capturing(position, x, y, c) {\n    var captured = []; // is there a stone possible to capture?\n\n    if (x >= 0 && x < position.size && y >= 0 && y < position.size && position.get(x, y) == c) {\n      // create testing map\n      var testing = new Position(position.size); // if it has zero liberties capture it\n\n      if (check_liberties(position, testing, x, y, c)) {\n        // capture stones from game\n        do_capture(position, captured, x, y, c);\n      }\n    }\n\n    return captured;\n  }; // analysing history\n\n\n  var checkHistory = function checkHistory(position, x, y) {\n    var flag, stop;\n    if (this.repeating == \"KO\" && this.stack.length - 2 >= 0) stop = this.stack.length - 2;else if (this.repeating == \"ALL\") stop = 0;else return true;\n\n    for (var i = this.stack.length - 2; i >= stop; i--) {\n      if (this.stack[i].get(x, y) == position.get(x, y)) {\n        flag = true;\n\n        for (var j = 0; j < this.size * this.size; j++) {\n          if (this.stack[i].schema[j] != position.schema[j]) {\n            flag = false;\n            break;\n          }\n        }\n\n        if (flag) return false;\n      }\n    }\n\n    return true;\n  };\n\n  Game.prototype = {\n    constructor: Game,\n\n    /**\n     * Gets actual position.\n     *\n     * @return {WGo.Position} actual position\n     */\n    getPosition: function getPosition() {\n      return this.stack[this.stack.length - 1];\n    },\n\n    /**\n     * Play move.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W)} c color\n     * @param {boolean} noplay - if true, move isn't played. Used by WGo.Game.isValid.\n     * @return {number} code of error, if move isn't valid. If it is valid, function returns array of captured stones.\n     *\n     * Error codes:\n     * 1 - given coordinates are not on board\n     * 2 - on given coordinates already is a stone\n     * 3 - suicide (currently they are forbbiden)\n     * 4 - repeated position\n     */\n    play: function play(x, y, c, noplay) {\n      //check coordinates validity\n      if (!this.isOnBoard(x, y)) return 1;\n      if (!this.allow_rewrite && this.position.get(x, y) != 0) return 2; // clone position\n\n      if (!c) c = this.turn;\n      var new_pos = this.position.clone();\n      new_pos.set(x, y, c); // check capturing\n\n      var cap_color = c;\n      var captured = check_capturing(new_pos, x - 1, y, -c).concat(check_capturing(new_pos, x + 1, y, -c), check_capturing(new_pos, x, y - 1, -c), check_capturing(new_pos, x, y + 1, -c)); // check suicide\n\n      if (!captured.length) {\n        var testing = new Position(this.size);\n\n        if (check_liberties(new_pos, testing, x, y, c)) {\n          if (this.allow_suicide) {\n            cap_color = -c;\n            do_capture(new_pos, captured, x, y, c);\n          } else return 3;\n        }\n      } // check history\n\n\n      if (this.repeating && !checkHistory.call(this, new_pos, x, y)) {\n        return 4;\n      }\n\n      if (noplay) return false; // update position info\n\n      new_pos.color = c;\n      new_pos.capCount = {\n        black: this.position.capCount.black,\n        white: this.position.capCount.white\n      };\n      if (cap_color == WGo.B) new_pos.capCount.black += captured.length;else new_pos.capCount.white += captured.length; // save position\n\n      this.pushPosition(new_pos); // reverse turn\n\n      this.turn = -c;\n      console.log('capture in wgo.js', captured);\n      return captured;\n    },\n\n    /**\n     * Play pass.\n     *\n     * @param {(WGo.B|WGo.W)} c color\n     */\n    pass: function pass(c) {\n      this.pushPosition();\n\n      if (c) {\n        this.position.color = c;\n        this.turn = -c;\n      } else {\n        this.position.color = this.turn;\n        this.turn = -this.turn;\n      }\n    },\n\n    /**\n     * Finds out validity of the move.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W)} c color\n     * @return {boolean} true if move can be played.\n     */\n    isValid: function isValid(x, y, c) {\n      return typeof this.play(x, y, c, true) != \"number\";\n    },\n\n    /**\n     * Controls position of the move.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @return {boolean} true if move is on board.\n     */\n    isOnBoard: function isOnBoard(x, y) {\n      return x >= 0 && y >= 0 && x < this.size && y < this.size;\n    },\n\n    /**\n     * Inserts move into current position. Use for setting position, for example in handicap game. Field must be empty.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W)} c color\n     * @return {boolean} true if operation is successfull.\n     */\n    addStone: function addStone(x, y, c) {\n      if (this.isOnBoard(x, y) && this.position.get(x, y) == 0) {\n        this.position.set(x, y, c || 0);\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Removes move from current position.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @return {boolean} true if operation is successfull.\n     */\n    removeStone: function removeStone(x, y) {\n      if (this.isOnBoard(x, y) && this.position.get(x, y) != 0) {\n        this.position.set(x, y, 0);\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Set or insert move of current position.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W)} c color\n     * @return {boolean} true if operation is successfull.\n     */\n    setStone: function setStone(x, y, c) {\n      if (this.isOnBoard(x, y)) {\n        this.position.set(x, y, c || 0);\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Get stone on given position.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @return {(WGo.B|WGo.W|0)} color\n     */\n    getStone: function getStone(x, y) {\n      if (this.isOnBoard(x, y)) {\n        return this.position.get(x, y);\n      }\n\n      return 0;\n    },\n\n    /**\n     * Add position to stack. If position isn't specified current position is cloned and stacked.\n     * Pointer of actual position is moved to the new position.\n     *\n     * @param {WGo.Position} tmp position (optional)\n     */\n    pushPosition: function pushPosition(pos) {\n      if (!pos) {\n        var pos = this.position.clone();\n        pos.capCount = {\n          black: this.position.capCount.black,\n          white: this.position.capCount.white\n        };\n        pos.color = this.position.color;\n      }\n\n      this.stack.push(pos);\n      if (pos.color) this.turn = -pos.color;\n      return this;\n    },\n\n    /**\n     * Remove current position from stack. Pointer of actual position is moved to the previous position.\n     */\n    popPosition: function popPosition() {\n      var old = null;\n\n      if (this.stack.length > 0) {\n        old = this.stack.pop();\n        if (this.stack.length == 0) this.turn = WGo.B;else if (this.position.color) this.turn = -this.position.color;else this.turn = -this.turn;\n      }\n\n      return old;\n    },\n\n    /**\n     * Removes all positions.\n     */\n    firstPosition: function firstPosition() {\n      this.stack = [];\n      this.stack[0] = new Position(this.size);\n      this.stack[0].capCount = {\n        black: 0,\n        white: 0\n      };\n      this.turn = WGo.B;\n      return this;\n    },\n\n    /**\n     * Gets count of captured stones.\n     *\n     * @param {(WGo.BLACK|WGo.WHITE)} color\n     * @return {number} count\n     */\n    getCaptureCount: function getCaptureCount(color) {\n      return color == WGo.B ? this.position.capCount.black : this.position.capCount.white;\n    },\n\n    /**\n     * Validate postion. Position is tested from 0:0 to size:size, if there are some moves, that should be captured, they will be removed.\n     * You can use this, after insertion of more stones.\n     *\n     * @return array removed stones\n     */\n    validatePosition: function validatePosition() {\n      var c,\n          p,\n          white = 0,\n          black = 0,\n          captured = [],\n          new_pos = this.position.clone();\n\n      for (var x = 0; x < this.size; x++) {\n        for (var y = 0; y < this.size; y++) {\n          c = this.position.get(x, y);\n\n          if (c) {\n            p = captured.length;\n            captured = captured.concat(check_capturing(new_pos, x - 1, y, -c), check_capturing(new_pos, x + 1, y, -c), check_capturing(new_pos, x, y - 1, -c), check_capturing(new_pos, x, y + 1, -c));\n            if (c == WGo.B) black += captured - p;else white += captured - p;\n          }\n        }\n      }\n\n      this.position.capCount.black += black;\n      this.position.capCount.white += white;\n      this.position.schema = new_pos.schema;\n      return captured;\n    }\n  }; // save Game\n\n  WGo.Game = Game; // register WGo\n\n  window.WGo = WGo;\n})(window);",{"version":3,"sources":["/Users/linchengxun/Desktop/vuego-testfunc/src/assets/wgo.js"],"names":["window","undefined","scripts","document","getElementsByTagName","path","length","src","split","mydir","slice","join","WGo","version","B","W","ERROR_REPORT","DIR","lang","i18n","en","opera","navigator","userAgent","search","webkit","msie","mozilla","t","str","loc","i","arguments","replace","extendClass","parent","child","prototype","constructor","super","abstractMethod","Error","clone","obj","n_obj","Array","key","filterHTML","text","Board","elem","config","default","themes","theme","tx","section","left","ty","top","bx","size","right","by","bottom","init","appendChild","element","pixelRatio","devicePixelRatio","width","height","setDimensions","setWidth","setHeight","old","shadowColor","shadowTransparentColor","shadowBlur","shadowSize","board","markupBlackColor","markupWhiteColor","markupNoneColor","markupLinesWidth","autoLineWidth","stoneRadius","lineWidth","gridLinesWidth","gridLinesColor","Math","min","starColor","starSize","stoneSize","fieldWidth","fieldHeight","coordinatesColor","font","linesShift","variationColor","theme_variable","shadow_handler","draw","args","xr","getX","x","yr","getY","y","sr","beginPath","blur","radius","max","gradient","createRadialGradient","ls","addColorStop","fillStyle","arc","PI","fill","clear","clearRect","shadow_handler_realistic","lsX","lsY","get_markup_color","obj_arr","c","is_here_stone","redraw_layer","layer","handler","z","type","stoneHandler","drawHandlers","call","getContext","obj_list","shell_seed","draw_shell_line","ctx","start_angle","end_angle","factor","thickness","strokeStyle","x1","cos","y1","sin","x2","y2","m","angle","diff_x","diff_y","atan","bx1","by1","bx2","by2","moveTo","bezierCurveTo","stroke","draw_shell","arg","from_angle","to_angle","lines","NORMAL","stone","radgrad","shadow","PAINTED","REALISTIC","whiteCount","whiteStoneGraphic","blackCount","blackStoneGraphic","randIndex","ceil","random","redraw","isOkay","img","complete","naturalWidth","idx","stoneGraphic","Image","onload","drawImage","SHELL","GLOW","MONO","lw","CR","LB","round","textBaseline","textAlign","fillText","grid","_nodraw","SQ","rect","TR","lineTo","closePath","MA","lineCap","SL","SM","outline","alpha","globalAlpha","stoneStyle","mini","coordinates","ch","xright","xleft","ytop","ybottom","charCodeAt","String","fromCharCode","CanvasLayer","createElement","context","scale","style","appendTo","weight","position","zIndex","removeFrom","removeChild","GridLayer","tmp","bw","bh","strokeRect","starPoints","MultipleCanvasLayer","n","tmpContext","layers","elements","contexts","push","ShadowLayer","setTransform","default_field_clear","calcLeftMargin","calcTopMargin","calcFieldWidth","calcFieldHeight","clearField","drawField","k","getMousePos","e","clientX","offsetX","offsetY","updateDim","j","listeners","className","background","backgroundColor","backgroundImage","backgroundSize","addLayer","getSection","setSection","section_or_top","setSize","err","console","log","message","removeLayer","indexOf","splice","update","changes","remove","removeAllObjects","removeObject","add","addObject","unshift","removeObjectsAt","addCustomObject","removeCustomObject","addEventListener","callback","_this","evListener","handleEvent","coo","removeEventListener","listener","getState","objects","custom","restoreState","state","Position","schema","get","set","compare","floor","Game","checkRepeat","allowRewrite","allowSuicide","repeating","allow_rewrite","allow_suicide","stack","capCount","black","white","turn","Object","defineProperty","pos","do_capture","captured","check_liberties","testing","check_capturing","checkHistory","flag","stop","getPosition","play","noplay","isOnBoard","new_pos","cap_color","concat","color","pushPosition","pass","isValid","addStone","removeStone","setStone","getStone","popPosition","pop","firstPosition","getCaptureCount","validatePosition","p"],"mappings":"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","sourcesContent":["/* eslint-disable */\n/*!\n * Copyright (c) 2013 Jan Prokop\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this\n * software and associated documentation files (the \"Software\"), to deal in the Software\n * without restriction, including without limitation the rights to use, copy, modify, merge,\n * publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons\n * to whom the Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all copies or\n * substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n * BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/* WGo.js 2.3.1 */\n\n(function (window, undefined) {\n\n\t\"use strict\";\n\t\n\tvar scripts = document.getElementsByTagName('script');\n\tvar path = scripts[scripts.length - 1].src.split('?')[0]; // remove any ?query\n\tvar mydir = path.split('/').slice(0, -1).join('/') + '/';\n\n\t/**\n\t * Main namespace - it initializes WGo in first run and then execute main function.\n\t * You must call WGo.init() if you want to use library, without calling WGo.\n\t */\n\n\tvar WGo = {\n\t\t// basic information\n\t\tversion: \"2.3.1\",\n\n\t\t// constants for colors (rather use WGo.B or WGo.W)\n\t\tB: 1,\n\t\tW: -1,\n\n\t\t// if true errors will be shown in dialog window, otherwise they will be ignored\n\t\tERROR_REPORT: true,\n\t\tDIR: mydir,\n\n\t\t// Language of player, you can change this global variable any time. Object WGo.i18n.<your lang> must exist.\n\t\tlang: \"en\",\n\n\t\t// Add terms for each language here\n\t\ti18n: {\n\t\t\ten: {}\n\t\t}\n\t}\n\n\t// browser detection - can be handy\n\tWGo.opera = navigator.userAgent.search(/(opera)(?:.*version)?[ \\/]([\\w.]+)/i) != -1;\n\tWGo.webkit = navigator.userAgent.search(/(webkit)[ \\/]([\\w.]+)/i) != -1;\n\tWGo.msie = navigator.userAgent.search(/(msie) ([\\w.]+)/i) != -1;\n\tWGo.mozilla = navigator.userAgent.search(/(mozilla)(?:.*? rv:([\\w.]+))?/i) != -1 && !WGo.webkit && !WGo.msie;\n\n\t// translating function\n\tWGo.t = function (str) {\n\t\tvar loc = WGo.i18n[WGo.lang][str] || WGo.i18n.en[str];\n\t\tif (loc) {\n\t\t\tfor (var i = 1; i < arguments.length; i++) {\n\t\t\t\tloc = loc.replace(\"$\", arguments[i]);\n\t\t\t}\n\t\t\treturn loc;\n\t\t}\n\t\treturn str;\n\t}\n\n\t// helping function for class inheritance\n\tWGo.extendClass = function (parent, child) {\n\t\tchild.prototype = Object.create(parent.prototype);\n\t\tchild.prototype.constructor = child;\n\t\tchild.prototype.super = parent;\n\n\t\treturn child;\n\t};\n\n\t// helping function for class inheritance\n\tWGo.abstractMethod = function () {\n\t\tthrow Error('unimplemented abstract method');\n\t};\n\n\t// helping function for deep cloning of simple objects,\n\tWGo.clone = function (obj) {\n\t\tif (obj && typeof obj == \"object\") {\n\t\t\tvar n_obj = obj.constructor == Array ? [] : {};\n\n\t\t\tfor (var key in obj) {\n\t\t\t\tif (obj[key] == obj) n_obj[key] = obj;\n\t\t\t\telse n_obj[key] = WGo.clone(obj[key]);\n\t\t\t}\n\n\t\t\treturn n_obj;\n\t\t} else return obj;\n\t}\n\n\t// filter html to avoid XSS\n\tWGo.filterHTML = function (text) {\n\t\tif (!text || typeof text != \"string\") return text;\n\t\treturn text.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\t}\n\n\t//---------------------- WGo.Board -----------------------------------------------------------------------------\n\n\t/**\n\t * Board class constructor - it creates a canvas board\n\t *\n\t * @param elem DOM element to put in\n\t * @param config configuration object. It is object with \"key: value\" structure. Possible configurations are:\n\t *\n\t * - size: number - size of the board (default: 19)\n\t * - width: number - width of the board (default: 0)\n\t * - height: number - height of the board (default: 0)\n\t * - font: string - font of board writings (!deprecated)\n\t * - lineWidth: number - line width of board drawings (!deprecated)\n\t * - autoLineWidth: boolean - if set true, line width will be automatically computed accordingly to board size - this option rewrites 'lineWidth' /and it will keep markups sharp/ (!deprecated)\n\t * - starPoints: Object - star points coordinates, defined for various board sizes. Look at Board.default for more info.\n\t * - stoneHandler: Board.DrawHandler - stone drawing handler (default: Board.drawHandlers.SHELL)\n\t * - starSize: number - size of star points (default: 1). Radius of stars is dynamic, however you can modify it by given constant. (!deprecated)\n\t * - stoneSize: number - size of stone (default: 1). Radius of stone is dynamic, however you can modify it by given constant. (!deprecated)\n\t * - shadowSize: number - size of stone shadow (default: 1). Radius of shadow is dynamic, however you can modify it by given constant. (!deprecated)\n\t * - background: string - background of the board, it can be either color (#RRGGBB) or url. Empty string means no background. (default: WGo.DIR+\"wood1.jpg\")\n\t * - section: {\n\t *     top: number,\n\t *     right: number,\n\t *     bottom: number,\n\t *     left: number\n\t *   }\n\t *   It defines a section of board to be displayed. You can set a number of rows(or cols) to be skipped on each side.\n\t *   Numbers can be negative, in that case there will be more empty space. In default all values are zeros.\n\t * - theme: Object - theme object, which defines all graphical attributes of the board. Default theme object is \"WGo.Board.themes.default\". For old look you may use \"WGo.Board.themes.old\".\n\t *\n\t * Note: properties lineWidth, autoLineWidth, starPoints, starSize, stoneSize and shadowSize will be considered only if you set property 'theme' to 'WGo.Board.themes.old'.\n\t */\n\n\tvar Board = function (elem, config) {\n\t\tvar config = config || {};\n\n\t\t// set user configuration\n\t\tfor (var key in config) this[key] = config[key];\n\n\t\t// add default configuration\n\t\tfor (var key in WGo.Board.default)\n\t\t\tif (this[key] === undefined) this[key] = WGo.Board.default[key];\n\n\t\t// add default theme variables\n\t\tfor (var key in Board.themes.default)\n\t\t\tif (this.theme[key] === undefined) this.theme[key] = Board.themes.default[key];\n\n\t\t// set section if set\n\t\tthis.tx = this.section.left;\n\t\tthis.ty = this.section.top;\n\t\tthis.bx = this.size - 1 - this.section.right;\n\t\tthis.by = this.size - 1 - this.section.bottom;\n\n\t\t// init board\n\t\tthis.init();\n\n\t\t// append to element\n\t\telem.appendChild(this.element);\n\n\t\t// set initial dimensions\n\n\t\t// set the pixel ratio for HDPI (e.g. Retina) screens\n\t\tthis.pixelRatio = window.devicePixelRatio || 1;\n\n\t\tif (this.width && this.height) this.setDimensions(this.width, this.height);\n\t\telse if (this.width) this.setWidth(this.width);\n\t\telse if (this.height) this.setHeight(this.height);\n\t}\n\n\t// New experimental board theme system - it can be changed in future, if it will appear to be unsuitable.\n\tBoard.themes = {};\n\n\tBoard.themes.old = {\n\t\tshadowColor: \"rgba(32,32,32,0.5)\",\n\t\tshadowTransparentColor: \"rgba(32,32,32,0)\",\n\t\tshadowBlur: 0,\n\t\tshadowSize: function (board) {\n\t\t\treturn board.shadowSize;\n\t\t},\n\t\tmarkupBlackColor: \"rgba(255,255,255,0.8)\",\n\t\tmarkupWhiteColor: \"rgba(0,0,0,0.8)\",\n\t\tmarkupNoneColor: \"rgba(0,0,0,0.8)\",\n\t\tmarkupLinesWidth: function (board) {\n\t\t\treturn board.autoLineWidth ? board.stoneRadius / 7 : board.lineWidth;\n\t\t},\n\t\tgridLinesWidth: 1,\n\t\tgridLinesColor: function (board) {\n\t\t\treturn \"rgba(0,0,0,\" + Math.min(1, board.stoneRadius / 15) + \")\";\n\t\t},\n\t\tstarColor: \"#000\",\n\t\tstarSize: function (board) {\n\t\t\treturn board.starSize * ((board.width / 300) + 1);\n\t\t},\n\t\tstoneSize: function (board) {\n\t\t\treturn board.stoneSize * Math.min(board.fieldWidth, board.fieldHeight) / 2;\n\t\t},\n\t\tcoordinatesColor: \"rgba(0,0,0,0.7)\",\n\t\tfont: function (board) {\n\t\t\treturn board.font;\n\t\t},\n\t\tlinesShift: 0.5\n\t}\n\n\t/**\n\t * Object containing default graphical properties of a board.\n\t * A value of all properties can be even static value or function, returning final value.\n\t * Theme object doesn't set board and stone textures - they are set separately.\n\t */\n\n\tBoard.themes.default = {\n\t\tshadowColor: \"rgba(62,32,32,0.5)\",\n\t\tshadowTransparentColor: \"rgba(62,32,32,0)\",\n\t\tshadowBlur: function (board) {\n\t\t\treturn board.stoneRadius * 0.1;\n\t\t},\n\t\tshadowSize: 1,\n\t\tmarkupBlackColor: \"rgba(255,255,255,0.9)\",\n\t\tmarkupWhiteColor: \"rgba(0,0,0,0.7)\",\n\t\tmarkupNoneColor: \"rgba(0,0,0,0.7)\",\n\t\tmarkupLinesWidth: function (board) {\n\t\t\treturn board.stoneRadius / 8;\n\t\t},\n\t\tgridLinesWidth: function (board) {\n\t\t\treturn board.stoneRadius / 15;\n\t\t},\n\t\tgridLinesColor: \"#654525\",\n\t\tstarColor: \"#531\",\n\t\tstarSize: function (board) {\n\t\t\treturn (board.stoneRadius / 8) + 1;\n\t\t},\n\t\tstoneSize: function (board) {\n\t\t\treturn Math.min(board.fieldWidth, board.fieldHeight) / 2;\n\t\t},\n\t\tcoordinatesColor: \"#531\",\n\t\tvariationColor: \"rgba(0,32,128,0.8)\",\n\t\tfont: \"calibri\",\n\t\tlinesShift: 0.25\n\t}\n\n\tvar theme_variable = function (key, board) {\n\t\treturn typeof board.theme[key] == \"function\" ? board.theme[key](board) : board.theme[key];\n\t}\n\n\tvar shadow_handler = {\n\t\tdraw: function (args, board) {\n\t\t\tvar xr = board.getX(args.x),\n\t\t\t\tyr = board.getY(args.y),\n\t\t\t\tsr = board.stoneRadius;\n\n\t\t\tthis.beginPath();\n\n\t\t\tvar blur = theme_variable(\"shadowBlur\", board);\n\t\t\tvar radius = Math.max(0, sr - 0.5);\n\t\t\tvar gradient = this.createRadialGradient(xr - board.ls, yr - board.ls, radius - 1 - blur, xr - board.ls, yr - board.ls, radius + blur);\n\n\t\t\tgradient.addColorStop(0, theme_variable(\"shadowColor\", board));\n\t\t\tgradient.addColorStop(1, theme_variable(\"shadowTransparentColor\", board));\n\n\t\t\tthis.fillStyle = gradient;\n\n\t\t\tthis.arc(xr - board.ls, yr - board.ls, radius + blur, 0, 2 * Math.PI, true);\n\t\t\tthis.fill();\n\t\t},\n\t\tclear: function (args, board) {\n\t\t\tvar xr = board.getX(args.x),\n\t\t\t\tyr = board.getY(args.y),\n\t\t\t\tsr = board.stoneRadius;\n\t\t\tthis.clearRect(xr - 1.1 * sr - board.ls, yr - 1.1 * sr - board.ls, 2.2 * sr, 2.2 * sr);\n\t\t}\n\t}\n\n\t// Shadow handler for the 'REALISITC' rendering mode\n\tvar shadow_handler_realistic = {\n\t\tdraw: function (args, board) {\n\t\t\tvar xr = board.getX(args.x),\n\t\t\t\tyr = board.getY(args.y),\n\t\t\t\tsr = board.stoneRadius,\n\t\t\t\tlsX = 1.0,\n\t\t\t\tlsY = -5.0,\n\t\t\t\tblur = 5.0;\n\n\t\t\tthis.beginPath();\n\n\t\t\tvar radius = Math.max(0, (sr - 0.5) * 0.85);\n\t\t\tvar gradient = this.createRadialGradient(xr - lsX, yr - lsY, radius - 1 - blur, xr - lsX, yr - lsY, radius + blur);\n\n\t\t\tgradient.addColorStop(0, theme_variable(\"shadowColor\", board));\n\t\t\tgradient.addColorStop(1, theme_variable(\"shadowTransparentColor\", board));\n\n\t\t\tthis.fillStyle = gradient;\n\n\t\t\tthis.arc(xr - lsX, yr - lsY, radius + blur, 0, 2 * Math.PI, true);\n\t\t\tthis.fill();\n\t\t},\n\t\tclear: function (args, board) {\n\t\t\tvar xr = board.getX(args.x),\n\t\t\t\tyr = board.getY(args.y),\n\t\t\t\tsr = board.stoneRadius,\n\t\t\t\tlsX = 1.0,\n\t\t\t\tlsY = -5.0,\n\t\t\t\tblur = 5.0;\n\n\t\t\tthis.clearRect(xr - 1.1 * sr - lsX, yr - 1.1 * sr - lsY, 2.2 * sr, 2.2 * sr);\n\t\t}\n\t}\n\n\tvar get_markup_color = function (board, x, y) {\n\t\tif (board.obj_arr[x][y][0].c == WGo.B) return theme_variable(\"markupBlackColor\", board);\n\t\telse if (board.obj_arr[x][y][0].c == WGo.W) return theme_variable(\"markupWhiteColor\", board);\n\t\treturn theme_variable(\"markupNoneColor\", board);\n\t}\n\n\tvar is_here_stone = function (board, x, y) {\n\t\treturn (board.obj_arr[x][y][0] && board.obj_arr[x][y][0].c == WGo.W || board.obj_arr[x][y][0].c == WGo.B);\n\t}\n\n\tvar redraw_layer = function (board, layer) {\n\t\tvar handler;\n\n\t\tboard[layer].clear();\n\t\tboard[layer].draw(board);\n\t\t\n\t\tfor (var x = 0; x < board.size; x++) {\n\t\t\tfor (var y = 0; y < board.size; y++) {\n\t\t\t\tfor (var z = 0; z < board.obj_arr[x][y].length; z++) {\n\t\t\t\t\tvar obj = board.obj_arr[x][y][z];\n\t\t\t\t\tif (!obj.type) handler = board.stoneHandler;\n\t\t\t\t\telse if (typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];\n\t\t\t\t\telse handler = obj.type;\n\n\t\t\t\t\tif (handler[layer]) handler[layer].draw.call(board[layer].getContext(obj), obj, board);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0; i < board.obj_list.length; i++) {\n\t\t\tvar obj = board.obj_list[i];\n\t\t\tvar handler = obj.handler;\n\n\t\t\tif (handler[layer]) handler[layer].draw.call(board[layer].getContext(obj.args), obj.args, board);\n\t\t}\n\t}\n\n\t// shell stone helping functions\n\n\tvar shell_seed;\n\n\tvar draw_shell_line = function (ctx, x, y, radius, start_angle, end_angle, factor, thickness) {\n\t\tctx.strokeStyle = \"rgba(64,64,64,0.2)\";\n\n\t\tctx.lineWidth = (radius / 30) * thickness;\n\t\tctx.beginPath();\n\n\t\tradius -= Math.max(1, ctx.lineWidth);\n\n\t\tvar x1 = x + radius * Math.cos(start_angle * Math.PI);\n\t\tvar y1 = y + radius * Math.sin(start_angle * Math.PI);\n\t\tvar x2 = x + radius * Math.cos(end_angle * Math.PI);\n\t\tvar y2 = y + radius * Math.sin(end_angle * Math.PI);\n\n\t\tvar m, angle, x, diff_x, diff_y;\n\t\tif (x2 > x1) {\n\t\t\tm = (y2 - y1) / (x2 - x1);\n\t\t\tangle = Math.atan(m);\n\t\t} else if (x2 == x1) {\n\t\t\tangle = Math.PI / 2;\n\t\t} else {\n\t\t\tm = (y2 - y1) / (x2 - x1);\n\t\t\tangle = Math.atan(m) - Math.PI;\n\t\t}\n\n\t\tvar c = factor * radius;\n\t\tdiff_x = Math.sin(angle) * c;\n\t\tdiff_y = Math.cos(angle) * c;\n\n\t\tvar bx1 = x1 + diff_x;\n\t\tvar by1 = y1 - diff_y;\n\n\t\tvar bx2 = x2 + diff_x;\n\t\tvar by2 = y2 - diff_y;\n\n\t\tctx.moveTo(x1, y1);\n\t\tctx.bezierCurveTo(bx1, by1, bx2, by2, x2, y2);\n\t\tctx.stroke();\n\t}\n\n\tvar draw_shell = function (arg) {\n\t\tvar from_angle = arg.angle;\n\t\tvar to_angle = arg.angle;\n\n\t\tfor (var i = 0; i < arg.lines.length; i++) {\n\t\t\tfrom_angle += arg.lines[i];\n\t\t\tto_angle -= arg.lines[i];\n\t\t\tdraw_shell_line(arg.ctx, arg.x, arg.y, arg.radius, from_angle, to_angle, arg.factor, arg.thickness);\n\t\t}\n\t}\n\n\t// drawing handlers\n\n\tBoard.drawHandlers = {\n\t\t// handler for normal stones\n\t\tNORMAL: {\n\t\t\t// draw handler for stone layer\n\t\t\tstone: {\n\t\t\t\t// drawing function - args object contain info about drawing object, board is main board object\n\t\t\t\t// this function is called from canvas2D context\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius,\n\t\t\t\t\t\tradgrad;\n\t\t\t\t\t\t\n\n\t\t\t\t\t// set stone texture\n\t\t\t\t\tif (args.c == WGo.W) {\n\t\t\t\t\t\tradgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, sr / 3, xr - sr / 5, yr - sr / 5, 5 * sr / 5);\n\t\t\t\t\t\tradgrad.addColorStop(0, '#fff');\n\t\t\t\t\t\tradgrad.addColorStop(1, '#aaa');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tradgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 1, xr - sr / 5, yr - sr / 5, 4 * sr / 5);\n\t\t\t\t\t\tradgrad.addColorStop(0, '#666');\n\t\t\t\t\t\tradgrad.addColorStop(1, '#000');\n\t\t\t\t\t}\n\n\t\t\t\t\t// paint stone\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\tthis.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n\t\t\t\t\tthis.fill();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// adding shadow handler\n\t\t\tshadow: shadow_handler,\n\t\t},\n\n\t\tPAINTED: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius,\n\t\t\t\t\t\tradgrad;\n\n\t\t\t\t\tif (args.c == WGo.W) {\n\t\t\t\t\t\tradgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 2, xr - sr / 5, yr - sr / 5, 4 * sr / 5);\n\t\t\t\t\t\tradgrad.addColorStop(0, '#fff');\n\t\t\t\t\t\tradgrad.addColorStop(1, '#ddd');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tradgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 1, xr - sr / 5, yr - sr / 5, 4 * sr / 5);\n\t\t\t\t\t\tradgrad.addColorStop(0, '#111');\n\t\t\t\t\t\tradgrad.addColorStop(1, '#000');\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\tthis.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n\t\t\t\t\tthis.fill();\n\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.lineWidth = sr / 6;\n\n\t\t\t\t\tif (args.c == WGo.W) {\n\t\t\t\t\t\tthis.strokeStyle = '#999';\n\t\t\t\t\t\tthis.arc(xr + sr / 8, yr + sr / 8, sr / 2, 0, Math.PI / 2, false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.strokeStyle = '#ccc';\n\t\t\t\t\t\tthis.arc(xr - sr / 8, yr - sr / 8, sr / 2, Math.PI, 1.5 * Math.PI);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.stroke();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshadow: shadow_handler,\n\t\t},\n\n\t\t// handler for image based stones\n\t\tREALISTIC: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\t\tvar whiteCount = board.whiteStoneGraphic.length;\n\t\t\t\t\tvar blackCount = board.blackStoneGraphic.length;\n\n\t\t\t\t\tif (typeof this.randIndex === 'undefined') {\n\t\t\t\t\t\tthis.randIndex = Math.ceil(Math.random() * 1e5);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar redraw = function () {\n\t\t\t\t\t\tboard.redraw();\n\t\t\t\t\t};\n\n\t\t\t\t\t// Check if image has been loaded properly\n\t\t\t\t\t// see https://stereochro.me/ideas/detecting-broken-images-js\n\t\t\t\t\tvar isOkay = function (img) {\n\t\t\t\t\t\tif (typeof img === 'string') {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!img.complete) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (typeof img.naturalWidth != \"undefined\" && img.naturalWidth == 0) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\n\t\t\t\t\tif (args.c == WGo.W) {\n\t\t\t\t\t\tvar idx = this.randIndex % whiteCount;\n\t\t\t\t\t\tif (typeof board.whiteStoneGraphic[idx] === 'string') {\n\t\t\t\t\t\t\t// The image has not been loaded yet\n\t\t\t\t\t\t\tvar stoneGraphic = new Image();\n\t\t\t\t\t\t\t// Redraw the whole board after the image has been loaded.\n\t\t\t\t\t\t\t// This prevents 'missing stones' and similar graphical errors\n\t\t\t\t\t\t\t// especially on slower internet connections.\n\t\t\t\t\t\t\tstoneGraphic.onload = redraw;\n\t\t\t\t\t\t\tstoneGraphic.src = board.whiteStoneGraphic[idx];\n\t\t\t\t\t\t\tboard.whiteStoneGraphic[idx] = stoneGraphic;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isOkay(board.whiteStoneGraphic[idx])) {\n\t\t\t\t\t\t\tthis.drawImage(board.whiteStoneGraphic[idx], xr - sr, yr - sr, 2 * sr, 2 * sr);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Fall back to SHELL handler if there was a problem loading the image\n\t\t\t\t\t\t\tBoard.drawHandlers.SHELL.stone.draw.call(this, args, board);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else { // args.c == WGo.B\n\t\t\t\t\t\tvar idx = this.randIndex % blackCount;\n\t\t\t\t\t\tif (typeof board.blackStoneGraphic[idx] === 'string') {\n\t\t\t\t\t\t\tvar stoneGraphic = new Image();\n\t\t\t\t\t\t\tstoneGraphic.onload = redraw;\n\t\t\t\t\t\t\tstoneGraphic.src = board.blackStoneGraphic[idx];\n\t\t\t\t\t\t\tboard.blackStoneGraphic[idx] = stoneGraphic;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isOkay(board.blackStoneGraphic[idx])) {\n\t\t\t\t\t\t\tthis.drawImage(board.blackStoneGraphic[idx], xr - sr, yr - sr, 2 * sr, 2 * sr);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tBoard.drawHandlers.SHELL.stone.draw.call(this, args, board);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tshadow: shadow_handler_realistic,\n\t\t},\n\n\t\tGLOW: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\t\tvar radgrad;\n\t\t\t\t\tif (args.c == WGo.W) {\n\t\t\t\t\t\tradgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, sr / 3, xr - sr / 5, yr - sr / 5, 8 * sr / 5);\n\t\t\t\t\t\tradgrad.addColorStop(0, '#fff');\n\t\t\t\t\t\tradgrad.addColorStop(1, '#666');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tradgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 1, xr - sr / 5, yr - sr / 5, 3 * sr / 5);\n\t\t\t\t\t\tradgrad.addColorStop(0, '#555');\n\t\t\t\t\t\tradgrad.addColorStop(1, '#000');\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\tthis.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n\t\t\t\t\tthis.fill();\n\t\t\t\t},\n\t\t\t},\n\t\t\tshadow: shadow_handler,\n\t\t},\n\n\t\tSHELL: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr,\n\t\t\t\t\t\tyr,\n\t\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\t\tshell_seed = shell_seed || Math.ceil(Math.random() * 9999999);\n\n\t\t\t\t\txr = board.getX(args.x);\n\t\t\t\t\tyr = board.getY(args.y);\n\n\t\t\t\t\tvar radgrad;\n\n\t\t\t\t\tif (args.c == WGo.W) {\n\t\t\t\t\t\tradgrad = \"#aaa\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tradgrad = \"#000\";\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\tthis.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n\t\t\t\t\tthis.fill();\n\n\t\t\t\t\t// do shell magic here\n\t\t\t\t\tif (args.c == WGo.W) {\n\t\t\t\t\t\t// do shell magic here\n\t\t\t\t\t\tvar type = shell_seed % (3 + args.x * board.size + args.y) % 3;\n\t\t\t\t\t\tvar z = board.size * board.size + args.x * board.size + args.y;\n\t\t\t\t\t\tvar angle = (2 / z) * (shell_seed % z);\n\n\t\t\t\t\t\tif (type == 0) {\n\t\t\t\t\t\t\tdraw_shell({\n\t\t\t\t\t\t\t\tctx: this,\n\t\t\t\t\t\t\t\tx: xr,\n\t\t\t\t\t\t\t\ty: yr,\n\t\t\t\t\t\t\t\tradius: sr,\n\t\t\t\t\t\t\t\tangle: angle,\n\t\t\t\t\t\t\t\tlines: [0.10, 0.12, 0.11, 0.10, 0.09, 0.09, 0.09, 0.09],\n\t\t\t\t\t\t\t\tfactor: 0.25,\n\t\t\t\t\t\t\t\tthickness: 1.75\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (type == 1) {\n\t\t\t\t\t\t\tdraw_shell({\n\t\t\t\t\t\t\t\tctx: this,\n\t\t\t\t\t\t\t\tx: xr,\n\t\t\t\t\t\t\t\ty: yr,\n\t\t\t\t\t\t\t\tradius: sr,\n\t\t\t\t\t\t\t\tangle: angle,\n\t\t\t\t\t\t\t\tlines: [0.10, 0.09, 0.08, 0.07, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06],\n\t\t\t\t\t\t\t\tfactor: 0.2,\n\t\t\t\t\t\t\t\tthickness: 1.5\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdraw_shell({\n\t\t\t\t\t\t\t\tctx: this,\n\t\t\t\t\t\t\t\tx: xr,\n\t\t\t\t\t\t\t\ty: yr,\n\t\t\t\t\t\t\t\tradius: sr,\n\t\t\t\t\t\t\t\tangle: angle,\n\t\t\t\t\t\t\t\tlines: [0.12, 0.14, 0.13, 0.12, 0.12, 0.12],\n\t\t\t\t\t\t\t\tfactor: 0.3,\n\t\t\t\t\t\t\t\tthickness: 2\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tradgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, sr / 3, xr - sr / 5, yr - sr / 5, 5 * sr / 5);\n\t\t\t\t\t\tradgrad.addColorStop(0, 'rgba(255,255,255,0.9)');\n\t\t\t\t\t\tradgrad.addColorStop(1, 'rgba(255,255,255,0)');\n\n\t\t\t\t\t\t// add radial gradient //\n\t\t\t\t\t\tthis.beginPath();\n\t\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\t\tthis.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n\t\t\t\t\t\tthis.fill();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tradgrad = this.createRadialGradient(xr + 0.4 * sr, yr + 0.4 * sr, 0, xr + 0.5 * sr, yr + 0.5 * sr, sr);\n\t\t\t\t\t\tradgrad.addColorStop(0, 'rgba(32,32,32,1)');\n\t\t\t\t\t\tradgrad.addColorStop(1, 'rgba(0,0,0,0)');\n\n\t\t\t\t\t\tthis.beginPath();\n\t\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\t\tthis.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n\t\t\t\t\t\tthis.fill();\n\n\t\t\t\t\t\tradgrad = this.createRadialGradient(xr - 0.4 * sr, yr - 0.4 * sr, 1, xr - 0.5 * sr, yr - 0.5 * sr, 1.5 * sr);\n\t\t\t\t\t\tradgrad.addColorStop(0, 'rgba(64,64,64,1)');\n\t\t\t\t\t\tradgrad.addColorStop(1, 'rgba(0,0,0,0)');\n\n\t\t\t\t\t\tthis.beginPath();\n\t\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\t\tthis.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n\t\t\t\t\t\tthis.fill();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tshadow: shadow_handler,\n\t\t},\n\n\t\tMONO: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius,\n\t\t\t\t\t\tlw = theme_variable(\"markupLinesWidth\", board) || 1;\n\n\t\t\t\t\tif (args.c == WGo.W) this.fillStyle = \"white\";\n\t\t\t\t\telse this.fillStyle = \"black\";\n\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.arc(xr, yr, Math.max(0, sr - lw), 0, 2 * Math.PI, true);\n\t\t\t\t\tthis.fill();\n\n\t\t\t\t\tthis.lineWidth = lw;\n\t\t\t\t\tthis.strokeStyle = \"black\";\n\t\t\t\t\tthis.stroke();\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\t\tCR: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\t\tthis.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.arc(xr - board.ls, yr - board.ls, sr / 2, 0, 2 * Math.PI, true);\n\t\t\t\t\tthis.stroke();\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\n\t\t// Label drawing handler\n\t\tLB: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius,\n\t\t\t\t\t\tfont = args.font || theme_variable(\"font\", board) || \"\";\n\n\t\t\t\t\tthis.fillStyle = args.c || get_markup_color(board, args.x, args.y);\n\n\t\t\t\t\tif (args.text.length == 1) this.font = Math.round(sr * 1.5) + \"px \" + font;\n\t\t\t\t\telse if (args.text.length == 2) this.font = Math.round(sr * 1.2) + \"px \" + font;\n\t\t\t\t\telse this.font = Math.round(sr) + \"px \" + font;\n\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.textBaseline = \"middle\";\n\t\t\t\t\tthis.textAlign = \"center\";\n\t\t\t\t\tthis.fillText(args.text, xr, yr, 2 * sr);\n\n\t\t\t\t},\n\t\t\t},\n\n\t\t\t// modifies grid layer too\n\t\t\tgrid: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tif (!is_here_stone(board, args.x, args.y) && !args._nodraw) {\n\t\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\t\tsr = board.stoneRadius;\n\t\t\t\t\t\tthis.clearRect(xr - sr, yr - sr, 2 * sr, 2 * sr);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tclear: function (args, board) {\n\t\t\t\t\tif (!is_here_stone(board, args.x, args.y)) {\n\t\t\t\t\t\targs._nodraw = true;\n\t\t\t\t\t\tredraw_layer(board, \"grid\");\n\t\t\t\t\t\tdelete args._nodraw;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\t\tSQ: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = Math.round(board.stoneRadius);\n\n\t\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\t\tthis.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.rect(Math.round(xr - sr / 2) - board.ls, Math.round(yr - sr / 2) - board.ls, sr, sr);\n\t\t\t\t\tthis.stroke();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tTR: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\t\tthis.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.moveTo(xr - board.ls, yr - board.ls - Math.round(sr / 2));\n\t\t\t\t\tthis.lineTo(Math.round(xr - sr / 2) - board.ls, Math.round(yr + sr / 3) + board.ls);\n\t\t\t\t\tthis.lineTo(Math.round(xr + sr / 2) + board.ls, Math.round(yr + sr / 3) + board.ls);\n\t\t\t\t\tthis.closePath();\n\t\t\t\t\tthis.stroke();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tMA: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\t\tthis.lineCap = \"round\";\n\t\t\t\t\tthis.lineWidth = (args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1) * 2 - 1;\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.moveTo(Math.round(xr - sr / 2), Math.round(yr - sr / 2));\n\t\t\t\t\tthis.lineTo(Math.round(xr + sr / 2), Math.round(yr + sr / 2));\n\t\t\t\t\tthis.moveTo(Math.round(xr + sr / 2) - 1, Math.round(yr - sr / 2));\n\t\t\t\t\tthis.lineTo(Math.round(xr - sr / 2) - 1, Math.round(yr + sr / 2));\n\t\t\t\t\tthis.stroke();\n\t\t\t\t\tthis.lineCap = \"butt\";\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tSL: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\t\tthis.fillStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.rect(xr - sr / 2, yr - sr / 2, sr, sr);\n\t\t\t\t\tthis.fill();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tSM: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\t\tthis.lineWidth = (args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1) * 2;\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.arc(xr - sr / 3, yr - sr / 3, sr / 6, 0, 2 * Math.PI, true);\n\t\t\t\t\tthis.stroke();\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.arc(xr + sr / 3, yr - sr / 3, sr / 6, 0, 2 * Math.PI, true);\n\t\t\t\t\tthis.stroke();\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.moveTo(xr - sr / 1.5, yr);\n\t\t\t\t\tthis.bezierCurveTo(xr - sr / 1.5, yr + sr / 2, xr + sr / 1.5, yr + sr / 2, xr + sr / 1.5, yr);\n\t\t\t\t\tthis.stroke();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\toutline: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tif (args.alpha) this.globalAlpha = args.alpha;\n\t\t\t\t\telse this.globalAlpha = 0.3;\n\t\t\t\t\tif (args.stoneStyle) Board.drawHandlers[args.stoneStyle].stone.draw.call(this, args, board);\n\t\t\t\t\telse board.stoneHandler.stone.draw.call(this, args, board);\n\t\t\t\t\tthis.globalAlpha = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tmini: {\n\t\t\tstone: {\n\t\t\t\tdraw: function (args, board) {\n\t\t\t\t\tboard.stoneRadius = board.stoneRadius / 2;\n\t\t\t\t\tif (args.stoneStyle) Board.drawHandlers[args.stoneStyle].stone.draw.call(this, args, board);\n\t\t\t\t\telse board.stoneHandler.stone.draw.call(this, args, board);\n\t\t\t\t\tboard.stoneRadius = board.stoneRadius * 2;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t}\n\n\tBoard.coordinates = {\n\t\tgrid: {\n\t\t\tdraw: function (args, board) {\n\t\t\t\tvar ch, t, xright, xleft, ytop, ybottom;\n\n\t\t\t\tthis.fillStyle = theme_variable(\"coordinatesColor\", board);\n\t\t\t\tthis.textBaseline = \"middle\";\n\t\t\t\tthis.textAlign = \"center\";\n\t\t\t\tthis.font = board.stoneRadius + \"px \" + (board.font || \"\");\n\n\t\t\t\txright = board.getX(-0.75);\n\t\t\t\txleft = board.getX(board.size - 0.25);\n\t\t\t\tytop = board.getY(-0.75);\n\t\t\t\tybottom = board.getY(board.size - 0.25);\n\n\t\t\t\tfor (var i = 0; i < board.size; i++) {\n\t\t\t\t\tch = i + \"A\".charCodeAt(0);\n\t\t\t\t\tif (ch >= \"I\".charCodeAt(0)) ch++;\n\n\t\t\t\t\tt = board.getY(i);\n\t\t\t\t\tthis.fillText(board.size - i, xright, t);\n\t\t\t\t\tthis.fillText(board.size - i, xleft, t);\n\n\t\t\t\t\tt = board.getX(i);\n\t\t\t\t\tthis.fillText(String.fromCharCode(ch), t, ytop);\n\t\t\t\t\tthis.fillText(String.fromCharCode(ch), t, ybottom);\n\t\t\t\t}\n\n\t\t\t\tthis.fillStyle = \"black\";\n\t\t\t}\n\t\t}\n\t}\n\n\tBoard.CanvasLayer = function () {\n\t\tthis.element = document.createElement('canvas');\n\t\tthis.context = this.element.getContext('2d');\n\n\t\t// Adjust pixel ratio for HDPI screens (e.g. Retina)\n\t\tthis.pixelRatio = window.devicePixelRatio || 1;\n\t\tif (this.pixelRatio > 1) {\n\t\t\tthis.context.scale(this.pixelRatio, this.pixelRatio);\n\t\t}\n\t}\n\n\tBoard.CanvasLayer.prototype = {\n\t\tconstructor: Board.CanvasLayer,\n\n\t\tsetDimensions: function (width, height) {\n\t\t\tthis.element.width = width;\n\t\t\tthis.element.style.width = (width / this.pixelRatio) + 'px';\n\t\t\tthis.element.height = height;\n\t\t\tthis.element.style.height = (height / this.pixelRatio) + 'px';\n\t\t},\n\n\t\tappendTo: function (element, weight) {\n\t\t\tthis.element.style.position = 'absolute';\n\t\t\tthis.element.style.zIndex = weight;\n\t\t\telement.appendChild(this.element);\n\t\t},\n\n\t\tremoveFrom: function (element) {\n\t\t\telement.removeChild(this.element);\n\t\t},\n\n\t\tgetContext: function () {\n\t\t\treturn this.context;\n\t\t},\n\n\t\tdraw: function (board) {},\n\n\t\tclear: function () {\n\t\t\tthis.context.clearRect(0, 0, this.element.width, this.element.height);\n\t\t}\n\t}\n\n\tBoard.GridLayer = WGo.extendClass(Board.CanvasLayer, function () {\n\t\tthis.super.call(this);\n\t});\n\n\tBoard.GridLayer.prototype.draw = function (board) {\n\t\t// draw grid\n\t\tvar tmp;\n\n\t\tthis.context.beginPath();\n\t\tthis.context.lineWidth = theme_variable(\"gridLinesWidth\", board);\n\t\tthis.context.strokeStyle = theme_variable(\"gridLinesColor\", board);\n\n\t\tvar tx = Math.round(board.left),\n\t\t\tty = Math.round(board.top),\n\t\t\tbw = Math.round(board.fieldWidth * (board.size - 1)),\n\t\t\tbh = Math.round(board.fieldHeight * (board.size - 1));\n\n\t\tthis.context.strokeRect(tx - board.ls, ty - board.ls, bw, bh);\n\n\t\tfor (var i = 1; i < board.size - 1; i++) {\n\t\t\ttmp = Math.round(board.getX(i)) - board.ls;\n\t\t\tthis.context.moveTo(tmp, ty);\n\t\t\tthis.context.lineTo(tmp, ty + bh);\n\n\t\t\ttmp = Math.round(board.getY(i)) - board.ls;\n\t\t\tthis.context.moveTo(tx, tmp);\n\t\t\tthis.context.lineTo(tx + bw, tmp);\n\t\t}\n\n\t\tthis.context.stroke();\n\n\t\t// draw stars\n\t\tthis.context.fillStyle = theme_variable(\"starColor\", board);\n\n\t\tif (board.starPoints[board.size]) {\n\t\t\tfor (var key in board.starPoints[board.size]) {\n\t\t\t\tthis.context.beginPath();\n\t\t\t\tthis.context.arc(board.getX(board.starPoints[board.size][key].x) - board.ls, board.getY(board.starPoints[board.size][key].y) - board.ls, theme_variable(\"starSize\", board), 0, 2 * Math.PI, true);\n\t\t\t\tthis.context.fill();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Layer that is composed from more canvases. The proper canvas is selected according to drawn object.\n\t * In default there are 4 canvases and they are used for board objects like stones. This allows overlapping of objects.\n\t */\n\tBoard.MultipleCanvasLayer = WGo.extendClass(Board.CanvasLayer, function () {\n\t\tthis.init(4);\n\t});\n\n\tBoard.MultipleCanvasLayer.prototype.init = function (n) {\n\t\tvar tmp, tmpContext;\n\n\t\tthis.layers = n;\n\n\t\tthis.elements = [];\n\t\tthis.contexts = [];\n\n\t\t// Adjust pixel ratio for HDPI screens (e.g. Retina)\n\t\tthis.pixelRatio = window.devicePixelRatio || 1;\n\n\t\tfor (var i = 0; i < n; i++) {\n\t\t\ttmp = document.createElement('canvas');\n\t\t\ttmpContext = tmp.getContext('2d');\n\n\t\t\tif (this.pixelRatio > 1) {\n\t\t\t\ttmpContext.scale(this.pixelRatio, this.pixelRatio);\n\t\t\t}\n\n\t\t\tthis.elements.push(tmp);\n\t\t\tthis.contexts.push(tmpContext);\n\t\t}\n\t}\n\n\tBoard.MultipleCanvasLayer.prototype.appendTo = function (element, weight) {\n\t\tfor (var i = 0; i < this.layers; i++) {\n\t\t\tthis.elements[i].style.position = 'absolute';\n\t\t\tthis.elements[i].style.zIndex = weight;\n\t\t\telement.appendChild(this.elements[i]);\n\t\t}\n\t}\n\n\tBoard.MultipleCanvasLayer.prototype.removeFrom = function (element) {\n\t\tfor (var i = 0; i < this.layers; i++) {\n\t\t\telement.removeChild(this.elements[i]);\n\t\t}\n\t}\n\n\tBoard.MultipleCanvasLayer.prototype.getContext = function (args) {\n\t\tif (args.x % 2) {\n\t\t\treturn (args.y % 2) ? this.contexts[0] : this.contexts[1];\n\t\t} else {\n\t\t\treturn (args.y % 2) ? this.contexts[2] : this.contexts[3];\n\t\t}\n\t\t//return ((args.x%2) && (args.y%2) || !(args.x%2) && !(args.y%2)) ? this.context_odd : this.context_even;\n\t}\n\n\tBoard.MultipleCanvasLayer.prototype.clear = function (element, weight) {\n\t\tfor (var i = 0; i < this.layers; i++) {\n\t\t\tthis.contexts[i].clearRect(0, 0, this.elements[i].width, this.elements[i].height);\n\t\t}\n\t}\n\n\tBoard.MultipleCanvasLayer.prototype.setDimensions = function (width, height) {\n\t\tfor (var i = 0; i < this.layers; i++) {\n\t\t\tthis.elements[i].width = width;\n\t\t\tthis.elements[i].style.width = (width / this.pixelRatio) + 'px';\n\t\t\tthis.elements[i].height = height;\n\t\t\tthis.elements[i].style.height = (height / this.pixelRatio) + 'px';\n\t\t}\n\t}\n\n\tBoard.ShadowLayer = WGo.extendClass(Board.MultipleCanvasLayer, function (board, shadowSize, shadowBlur) {\n\t\tthis.init(2);\n\t\tthis.shadowSize = shadowSize === undefined ? 1 : shadowSize;\n\t\tthis.board = board;\n\t});\n\n\tBoard.ShadowLayer.prototype.getContext = function (args) {\n\t\treturn ((args.x % 2) && (args.y % 2) || !(args.x % 2) && !(args.y % 2)) ? this.contexts[0] : this.contexts[1];\n\t}\n\n\tBoard.ShadowLayer.prototype.setDimensions = function (width, height) {\n\t\tthis.super.prototype.setDimensions.call(this, width, height);\n\n\t\tfor (var i = 0; i < this.layers; i++) {\n\t\t\tthis.contexts[i].setTransform(1, 0, 0, 1, Math.round(this.shadowSize * this.board.stoneRadius / 7), Math.round(this.shadowSize * this.board.stoneRadius / 7));\n\t\t}\n\t}\n\n\tvar default_field_clear = function (args, board) {\n\t\tvar xr = board.getX(args.x),\n\t\t\tyr = board.getY(args.y),\n\t\t\tsr = board.stoneRadius;\n\t\tthis.clearRect(xr - 2 * sr - board.ls, yr - 2 * sr - board.ls, 4 * sr, 4 * sr);\n\t}\n\n\t// Private methods of WGo.Board\n\n\tvar calcLeftMargin = function () {\n\t\treturn (3 * this.width) / (4 * (this.bx + 1 - this.tx) + 2) - this.fieldWidth * this.tx;\n\t}\n\n\tvar calcTopMargin = function () {\n\t\treturn (3 * this.height) / (4 * (this.by + 1 - this.ty) + 2) - this.fieldHeight * this.ty;\n\t}\n\n\tvar calcFieldWidth = function () {\n\t\treturn (4 * this.width) / (4 * (this.bx + 1 - this.tx) + 2);\n\t}\n\n\tvar calcFieldHeight = function () {\n\t\treturn (4 * this.height) / (4 * (this.by + 1 - this.ty) + 2);\n\t}\n\n\tvar clearField = function (x, y) {\n\t\tvar handler;\n\t\tfor (var z = 0; z < this.obj_arr[x][y].length; z++) {\n\t\t\tvar obj = this.obj_arr[x][y][z];\n\t\t\tif (!obj.type) handler = this.stoneHandler;\n\t\t\telse if (typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];\n\t\t\telse handler = obj.type;\n\n\t\t\tfor (var layer in handler) {\n\t\t\t\tif (handler[layer].clear) handler[layer].clear.call(this[layer].getContext(obj), obj, this);\n\t\t\t\telse default_field_clear.call(this[layer].getContext(obj), obj, this);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tvar drawField = function (x, y, k) {\n\t\tvar handler;\n\t\t\n\t\t// console.log(mouseEvt)\n\t\tfor (var z = 0; z < this.obj_arr[x][y].length; z++) {\n\t\t\tvar obj = this.obj_arr[x][y][z];\n\t\t\t// console.log('obj',obj)\n\t\t\t// console.log('k',k)\n\t\t\tif (!obj.type) handler = this.stoneHandler;\n\t\t\telse if (typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];\n\t\t\telse handler = obj.type;\n\t\t\t\n\n\t\t\tfor (var layer in handler) {\n\t\t\t\thandler[layer].draw.call(this[layer].getContext(obj), obj, this);\n\t\t\t\t\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t}\n\t}\n\n\tvar getMousePos = function (e) {\n\t\t// new hopefully better translation of coordinates\n\t\tvar x, y, k;\n\t\t\n\t\tk = e.clientX\n\n\t\tx = e.offsetX * this.pixelRatio;\n\t\tx -= this.left;\n\t\tx /= this.fieldWidth;\n\t\tx = Math.round(x);\n\t\t\n\n\t\ty = e.offsetY * this.pixelRatio;\n\t\ty -= this.top;\n\t\ty /= this.fieldHeight;\n\t\ty = Math.round(y);\n\t\t// console.log('getmousePos',x,y)\n\t\treturn {\n\t\t\tx: x >= this.size ? -1 : x,\n\t\t\ty: y >= this.size ? -1 : y,\n\t\t\tk: k\n\t\t\t\n\t\t};\n\t}\n\n\tvar updateDim = function () {\n\t\tthis.element.style.width = (this.width / this.pixelRatio) + \"px\";\n\t\tthis.element.style.height = (this.height / this.pixelRatio) + \"px\";\n\n\t\tthis.stoneRadius = theme_variable(\"stoneSize\", this);\n\t\t//if(this.autoLineWidth) this.lineWidth = this.stoneRadius/7; //< 15 ? 1 : 3;\n\t\tthis.ls = theme_variable(\"linesShift\", this);\n\n\t\tfor (var i = 0; i < this.layers.length; i++) {\n\t\t\tthis.layers[i].setDimensions(this.width, this.height);\n\t\t}\n\t}\n\n\t// Public methods are in the prototype:\n\n\tBoard.prototype = {\n\t\tconstructor: Board,\n\n\t\t/**\n\t\t * Initialization method, it is called in constructor. You shouldn't call it, but you can alter it.\n\t\t */\n\n\t\tinit: function () {\n\n\t\t\t// placement of objects (in 3D array)\n\t\t\tthis.obj_arr = [];\n\t\t\tfor (var i = 0; i < this.size; i++) {\n\t\t\t\tthis.obj_arr[i] = [];\n\t\t\t\tfor (var j = 0; j < this.size; j++) this.obj_arr[i][j] = [];\n\t\t\t}\n\n\t\t\t// other objects, stored in list\n\t\t\tthis.obj_list = [];\n\n\t\t\t// layers\n\t\t\tthis.layers = [];\n\n\t\t\t// event listeners, binded to board\n\t\t\tthis.listeners = [];\n\n\t\t\tthis.element = document.createElement('div');\n\t\t\tthis.element.className = 'wgo-board';\n\t\t\tthis.element.style.position = 'relative';\n\n\t\t\tif (this.background) {\n\t\t\t\tif (this.background[0] == \"#\") this.element.style.backgroundColor = this.background;\n\t\t\t\telse {\n\t\t\t\t\tthis.element.style.backgroundImage = \"url('\" + this.background + \"')\";\n\t\t\t\t\t/*this.element.style.backgroundRepeat = \"repeat\";*/\n\t\t\t\t\tif (this.stoneHandler == Board.drawHandlers.REALISTIC) {\n\t\t\t\t\t\t// The photographed wood images do not repeat and are the size of an actual\n\t\t\t\t\t\t// Go-Board. Therefore scale to fit.\n\t\t\t\t\t\tthis.element.style.backgroundSize = \"100%\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.grid = new Board.GridLayer();\n\t\t\tthis.shadow = new Board.ShadowLayer(this, theme_variable(\"shadowSize\", this));\n\t\t\tthis.stone = new Board.MultipleCanvasLayer();\n\n\t\t\tthis.addLayer(this.grid, 100);\n\t\t\tthis.addLayer(this.shadow, 200);\n\t\t\tthis.addLayer(this.stone, 300);\n\t\t},\n\n\t\t/**\n\t\t * Set new width of board, height is computed to keep aspect ratio.\n\t\t *\n\t\t * @param {number} width\n\t\t */\n\n\t\tsetWidth: function (width) {\n\t\t\tthis.width = width;\n\t\t\tthis.width *= this.pixelRatio;\n\t\t\tthis.fieldHeight = this.fieldWidth = calcFieldWidth.call(this);\n\t\t\tthis.left = calcLeftMargin.call(this);\n\n\t\t\tthis.height = (this.by - this.ty + 1.5) * this.fieldHeight;\n\t\t\tthis.top = calcTopMargin.call(this);\n\n\t\t\tupdateDim.call(this);\n\t\t\tthis.redraw();\n\t\t},\n\n\t\t/**\n\t\t * Set new height of board, width is computed to keep aspect ratio.\n\t\t *\n\t\t * @param {number} height\n\t\t */\n\n\t\tsetHeight: function (height) {\n\t\t\tthis.height = height;\n\t\t\tthis.height *= this.pixelRatio;\n\t\t\tthis.fieldWidth = this.fieldHeight = calcFieldHeight.call(this);\n\t\t\tthis.top = calcTopMargin.call(this);\n\n\t\t\tthis.width = (this.bx - this.tx + 1.5) * this.fieldWidth;\n\t\t\tthis.left = calcLeftMargin.call(this);\n\n\t\t\tupdateDim.call(this);\n\t\t\tthis.redraw();\n\t\t},\n\n\t\t/**\n\t\t * Set both dimensions.\n\t\t *\n\t\t * @param {number} width\n\t\t * @param {number} height\n\t\t */\n\n\t\tsetDimensions: function (width, height) {\n\t\t\tthis.width = width || parseInt(this.element.style.width, 10);\n\t\t\tthis.width *= this.pixelRatio;\n\t\t\tthis.height = height || parseInt(this.element.style.height, 10);\n\t\t\tthis.height *= this.pixelRatio;\n\n\t\t\tthis.fieldWidth = calcFieldWidth.call(this);\n\t\t\tthis.fieldHeight = calcFieldHeight.call(this);\n\t\t\tthis.left = calcLeftMargin.call(this);\n\t\t\tthis.top = calcTopMargin.call(this);\n\n\t\t\tupdateDim.call(this);\n\t\t\tthis.redraw();\n\t\t},\n\n\t\t/**\n\t\t * Get currently visible section of the board\n\t\t */\n\n\t\tgetSection: function () {\n\t\t\treturn this.section;\n\t\t},\n\n\t\t/**\n\t\t * Set section of the board to be displayed\n\t\t */\n\n\t\tsetSection: function (section_or_top, right, bottom, left) {\n\t\t\tif (typeof section_or_top == \"object\") {\n\t\t\t\tthis.section = section_or_top;\n\t\t\t} else {\n\t\t\t\tthis.section = {\n\t\t\t\t\ttop: section_or_top,\n\t\t\t\t\tright: right,\n\t\t\t\t\tbottom: bottom,\n\t\t\t\t\tleft: left,\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.tx = this.section.left;\n\t\t\tthis.ty = this.section.top;\n\t\t\tthis.bx = this.size - 1 - this.section.right;\n\t\t\tthis.by = this.size - 1 - this.section.bottom;\n\n\t\t\tthis.setDimensions();\n\t\t},\n\n\t\t/**\n\t\t * Set board size (eg: 9, 13 or 19), this will clear board's objects.\n\t\t */\n\n\t\tsetSize: function (size) {\n\t\t\tvar size = size || 19;\n\n\t\t\tif (size != this.size) {\n\t\t\t\tthis.size = size;\n\n\t\t\t\tthis.obj_arr = [];\n\t\t\t\tfor (var i = 0; i < this.size; i++) {\n\t\t\t\t\tthis.obj_arr[i] = [];\n\t\t\t\t\tfor (var j = 0; j < this.size; j++) this.obj_arr[i][j] = [];\n\t\t\t\t}\n\n\t\t\t\tthis.bx = this.size - 1 - this.section.right;\n\t\t\t\tthis.by = this.size - 1 - this.section.bottom;\n\t\t\t\tthis.setDimensions();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Redraw everything.\n\t\t */\n\n\t\tredraw: function () {\n\t\t\ttry {\n\t\t\t\t// redraw layers\n\t\t\t\tfor (var i = 0; i < this.layers.length; i++) {\n\t\t\t\t\tthis.layers[i].clear(this);\n\t\t\t\t\tthis.layers[i].draw(this);\n\t\t\t\t}\n\n\t\t\t\t// redraw field objects\n\t\t\t\tfor (var i = 0; i < this.size; i++) {\n\t\t\t\t\tfor (var j = 0; j < this.size; j++) {\n\t\t\t\t\t\tdrawField.call(this, i, j);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// redraw custom objects\n\t\t\t\tfor (var i = 0; i < this.obj_list.length; i++) {\n\t\t\t\t\tvar obj = this.obj_list[i];\n\t\t\t\t\tvar handler = obj.handler;\n\n\t\t\t\t\tfor (var layer in handler) {\n\t\t\t\t\t\thandler[layer].draw.call(this[layer].getContext(obj.args), obj.args, this);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t// If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n\t\t\t\tconsole.log(\"WGo board failed to render. Error: \" + err.message);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Get absolute X coordinate\n\t\t *\n\t\t * @param {number} x relative coordinate\n\t\t */\n\n\t\tgetX: function (x) {\n\t\t\treturn this.left + x * this.fieldWidth;\n\t\t},\n\n\t\t/**\n\t\t * Get absolute Y coordinate\n\t\t *\n\t\t * @param {number} y relative coordinate\n\t\t */\n\n\t\tgetY: function (y) {\n\t\t\treturn this.top + y * this.fieldHeight;\n\t\t},\n\n\t\t/**\n\t\t * Add layer to the board. It is meant to be only for canvas layers.\n\t\t *\n\t\t * @param {Board.CanvasLayer} layer to add\n\t\t * @param {number} weight layer with biggest weight is on the top\n\t\t */\n\n\t\taddLayer: function (layer, weight) {\n\t\t\tlayer.appendTo(this.element, weight);\n\t\t\tlayer.setDimensions(this.width, this.height);\n\t\t\tthis.layers.push(layer);\n\t\t},\n\n\t\t/**\n\t\t * Remove layer from the board.\n\t\t *\n\t\t * @param {Board.CanvasLayer} layer to remove\n\t\t */\n\n\t\tremoveLayer: function (layer) {\n\t\t\tvar i = this.layers.indexOf(layer);\n\t\t\tif (i >= 0) {\n\t\t\t\tthis.layers.splice(i, 1);\n\t\t\t\tlayer.removeFrom(this.element);\n\t\t\t}\n\t\t},\n\n\t\tupdate: function (changes) {\n\t\t\tvar i;\n\t\t\tif (changes.remove && changes.remove == \"all\") this.removeAllObjects();\n\t\t\telse if (changes.remove) {\n\t\t\t\tfor (i = 0; i < changes.remove.length; i++) this.removeObject(changes.remove[i]);\n\t\t\t}\n\n\t\t\tif (changes.add) {\n\t\t\t\tfor (i = 0; i < changes.add.length; i++) this.addObject(changes.add[i]);\n\t\t\t}\n\t\t},\n\n\t\taddObject: function (obj) {\n\t\t\t// handling multiple objects\n\t\t\tif (obj.constructor == Array) {\n\t\t\t\tfor (var i = 0; i < obj.length; i++) this.addObject(obj[i]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// clear all objects on object's coordinates\n\t\t\t\tclearField.call(this, obj.x, obj.y);\n\n\t\t\t\t// if object of this type is on the board, replace it\n\t\t\t\tvar layers = this.obj_arr[obj.x][obj.y];\n\t\t\t\tfor (var z = 0; z < layers.length; z++) {\n\t\t\t\t\tif (layers[z].type == obj.type) {\n\t\t\t\t\t\tlayers[z] = obj;\n\t\t\t\t\t\tdrawField.call(this, obj.x, obj.y);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// if object is a stone, add it at the beginning, otherwise at the end\n\t\t\t\tif (!obj.type) layers.unshift(obj);\n\t\t\t\telse layers.push(obj);\n\n\t\t\t\t// draw all objects\n\t\t\t\tdrawField.call(this, obj.x, obj.y);\n\t\t\t} catch (err) {\n\t\t\t\t// If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n\t\t\t\tconsole.log(\"WGo board failed to render. Error: \" + err.message);\n\t\t\t}\n\t\t},\n\n\t\tremoveObject: function (obj) {\n\t\t\t// handling multiple objects\n\t\t\tif (obj.constructor == Array) {\n\t\t\t\tfor (var n = 0; n < obj.length; n++) this.removeObject(obj[n]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tvar i;\n\t\t\t\tfor (var j = 0; j < this.obj_arr[obj.x][obj.y].length; j++) {\n\t\t\t\t\tif (this.obj_arr[obj.x][obj.y][j].type == obj.type) {\n\t\t\t\t\t\ti = j;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (i === undefined) return;\n\n\t\t\t\t// clear all objects on object's coordinates\n\t\t\t\tclearField.call(this, obj.x, obj.y);\n\n\t\t\t\tthis.obj_arr[obj.x][obj.y].splice(i, 1);\n\n\t\t\t\tdrawField.call(this, obj.x, obj.y);\n\t\t\t} catch (err) {\n\t\t\t\t// If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n\t\t\t\tconsole.log(\"WGo board failed to render. Error: \" + err.message);\n\t\t\t}\n\t\t},\n\n\t\tremoveObjectsAt: function (x, y) {\n\t\t\tif (!this.obj_arr[x][y].length) return;\n\n\t\t\tclearField.call(this, x, y);\n\t\t\tthis.obj_arr[x][y] = [];\n\t\t},\n\n\t\tremoveAllObjects: function () {\n\t\t\tthis.obj_arr = [];\n\t\t\tfor (var i = 0; i < this.size; i++) {\n\t\t\t\tthis.obj_arr[i] = [];\n\t\t\t\tfor (var j = 0; j < this.size; j++) this.obj_arr[i][j] = [];\n\t\t\t}\n\t\t\tthis.redraw();\n\t\t},\n\n\t\taddCustomObject: function (handler, args) {\n\t\t\tthis.obj_list.push({\n\t\t\t\thandler: handler,\n\t\t\t\targs: args\n\t\t\t});\n\t\t\tthis.redraw();\n\t\t},\n\n\t\tremoveCustomObject: function (handler, args) {\n\t\t\tfor (var i = 0; i < this.obj_list.length; i++) {\n\t\t\t\tvar obj = this.obj_list[i];\n\t\t\t\tif (obj.handler == handler && obj.args == args) {\n\t\t\t\t\tthis.obj_list.splice(i, 1);\n\t\t\t\t\tthis.redraw();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\taddEventListener: function (type, callback) {\n\t\t\tvar _this = this,\n\t\t\t\tevListener = {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tcallback: callback,\n\t\t\t\t\thandleEvent: function (e) {\n\t\t\t\t\t\tvar coo = getMousePos.call(_this, e);\n\t\t\t\t\t\tcallback(coo.x, coo.y, e);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\tthis.element.addEventListener(type, evListener, true);\n\t\t\tthis.listeners.push(evListener);\n\t\t},\n\n\t\tremoveEventListener: function (type, callback) {\n\t\t\tfor (var i = 0; i < this.listeners.length; i++) {\n\t\t\t\tvar listener = this.listeners[i];\n\t\t\t\tif (listener.type == type && listener.callback == callback) {\n\t\t\t\t\tthis.element.removeEventListener(listener.type, listener, true);\n\t\t\t\t\tthis.listeners.splice(i, 1);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tgetState: function () {\n\t\t\treturn {\n\t\t\t\tobjects: WGo.clone(this.obj_arr),\n\t\t\t\tcustom: WGo.clone(this.obj_list)\n\t\t\t};\n\t\t},\n\n\t\trestoreState: function (state) {\n\t\t\tthis.obj_arr = state.objects || this.obj_arr;\n\t\t\tthis.obj_list = state.custom || this.obj_list;\n\n\t\t\tthis.redraw();\n\t\t}\n\t}\n\n\tBoard.default = {\n\t\tsize: 19,\n\t\twidth: 0,\n\t\theight: 0,\n\t\tfont: \"Calibri\", // deprecated\n\t\tlineWidth: 1, // deprecated\n\t\tautoLineWidth: false, // deprecated\n\t\tstarPoints: {\n\t\t\t5: [{\n\t\t\t\tx: 2,\n\t\t\t\ty: 2\n\t\t\t}],\n\t\t\t7: [{\n\t\t\t\tx: 3,\n\t\t\t\ty: 3\n\t\t\t}],\n\t\t\t8: [{\n\t\t\t\tx: 2,\n\t\t\t\ty: 2\n\t\t\t}, {\n\t\t\t\tx: 5,\n\t\t\t\ty: 2\n\t\t\t}, {\n\t\t\t\tx: 2,\n\t\t\t\ty: 5\n\t\t\t}, {\n\t\t\t\tx: 5,\n\t\t\t\ty: 5\n\t\t\t}],\n\t\t\t9: [{\n\t\t\t\tx: 2,\n\t\t\t\ty: 2\n\t\t\t}, {\n\t\t\t\tx: 6,\n\t\t\t\ty: 2\n\t\t\t}, {\n\t\t\t\tx: 4,\n\t\t\t\ty: 4\n\t\t\t}, {\n\t\t\t\tx: 2,\n\t\t\t\ty: 6\n\t\t\t}, {\n\t\t\t\tx: 6,\n\t\t\t\ty: 6\n\t\t\t}],\n\t\t\t10: [{\n\t\t\t\tx: 2,\n\t\t\t\ty: 2\n\t\t\t}, {\n\t\t\t\tx: 7,\n\t\t\t\ty: 2\n\t\t\t}, {\n\t\t\t\tx: 2,\n\t\t\t\ty: 7\n\t\t\t}, {\n\t\t\t\tx: 7,\n\t\t\t\ty: 7\n\t\t\t}],\n\t\t\t11: [{\n\t\t\t\tx: 2,\n\t\t\t\ty: 2\n\t\t\t}, {\n\t\t\t\tx: 8,\n\t\t\t\ty: 2\n\t\t\t}, {\n\t\t\t\tx: 5,\n\t\t\t\ty: 5\n\t\t\t}, {\n\t\t\t\tx: 2,\n\t\t\t\ty: 8\n\t\t\t}, {\n\t\t\t\tx: 8,\n\t\t\t\ty: 8\n\t\t\t}],\n\t\t\t12: [{\n\t\t\t\tx: 3,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 8,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 3,\n\t\t\t\ty: 8\n\t\t\t}, {\n\t\t\t\tx: 8,\n\t\t\t\ty: 8\n\t\t\t}],\n\t\t\t13: [{\n\t\t\t\tx: 3,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 9,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 6,\n\t\t\t\ty: 6\n\t\t\t}, {\n\t\t\t\tx: 3,\n\t\t\t\ty: 9\n\t\t\t}, {\n\t\t\t\tx: 9,\n\t\t\t\ty: 9\n\t\t\t}],\n\t\t\t14: [{\n\t\t\t\tx: 3,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 10,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 3,\n\t\t\t\ty: 10\n\t\t\t}, {\n\t\t\t\tx: 10,\n\t\t\t\ty: 10\n\t\t\t}],\n\t\t\t15: [{\n\t\t\t\tx: 3,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 11,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 7,\n\t\t\t\ty: 7\n\t\t\t}, {\n\t\t\t\tx: 3,\n\t\t\t\ty: 11\n\t\t\t}, {\n\t\t\t\tx: 11,\n\t\t\t\ty: 11\n\t\t\t}],\n\t\t\t16: [{\n\t\t\t\tx: 3,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 12,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 3,\n\t\t\t\ty: 12\n\t\t\t}, {\n\t\t\t\tx: 12,\n\t\t\t\ty: 12\n\t\t\t}],\n\t\t\t17: [{\n\t\t\t\t\tx: 3,\n\t\t\t\t\ty: 3\n\t\t\t\t}, {\n\t\t\t\t\tx: 8,\n\t\t\t\t\ty: 3\n\t\t\t\t}, {\n\t\t\t\t\tx: 13,\n\t\t\t\t\ty: 3\n\t\t\t\t}, {\n\t\t\t\t\tx: 3,\n\t\t\t\t\ty: 8\n\t\t\t\t}, {\n\t\t\t\t\tx: 8,\n\t\t\t\t\ty: 8\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tx: 13,\n\t\t\t\t\ty: 8\n\t\t\t\t}, {\n\t\t\t\t\tx: 3,\n\t\t\t\t\ty: 13\n\t\t\t\t}, {\n\t\t\t\t\tx: 8,\n\t\t\t\t\ty: 13\n\t\t\t\t}, {\n\t\t\t\t\tx: 13,\n\t\t\t\t\ty: 13\n\t\t\t\t}\n\t\t\t],\n\t\t\t18: [{\n\t\t\t\tx: 3,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 14,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 3,\n\t\t\t\ty: 14\n\t\t\t}, {\n\t\t\t\tx: 14,\n\t\t\t\ty: 14\n\t\t\t}],\n\t\t\t19: [{\n\t\t\t\t\tx: 3,\n\t\t\t\t\ty: 3\n\t\t\t\t}, {\n\t\t\t\t\tx: 9,\n\t\t\t\t\ty: 3\n\t\t\t\t}, {\n\t\t\t\t\tx: 15,\n\t\t\t\t\ty: 3\n\t\t\t\t}, {\n\t\t\t\t\tx: 3,\n\t\t\t\t\ty: 9\n\t\t\t\t}, {\n\t\t\t\t\tx: 9,\n\t\t\t\t\ty: 9\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tx: 15,\n\t\t\t\t\ty: 9\n\t\t\t\t}, {\n\t\t\t\t\tx: 3,\n\t\t\t\t\ty: 15\n\t\t\t\t}, {\n\t\t\t\t\tx: 9,\n\t\t\t\t\ty: 15\n\t\t\t\t}, {\n\t\t\t\t\tx: 15,\n\t\t\t\t\ty: 15\n\t\t\t\t}\n\t\t\t],\n\t\t\t20: [{\n\t\t\t\tx: 3,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 16,\n\t\t\t\ty: 3\n\t\t\t}, {\n\t\t\t\tx: 3,\n\t\t\t\ty: 16\n\t\t\t}, {\n\t\t\t\tx: 16,\n\t\t\t\ty: 16\n\t\t\t}],\n\t\t\t21: [{\n\t\t\t\t\tx: 3,\n\t\t\t\t\ty: 3\n\t\t\t\t}, {\n\t\t\t\t\tx: 10,\n\t\t\t\t\ty: 3\n\t\t\t\t}, {\n\t\t\t\t\tx: 17,\n\t\t\t\t\ty: 3\n\t\t\t\t}, {\n\t\t\t\t\tx: 3,\n\t\t\t\t\ty: 10\n\t\t\t\t}, {\n\t\t\t\t\tx: 10,\n\t\t\t\t\ty: 10\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tx: 17,\n\t\t\t\t\ty: 10\n\t\t\t\t}, {\n\t\t\t\t\tx: 3,\n\t\t\t\t\ty: 17\n\t\t\t\t}, {\n\t\t\t\t\tx: 10,\n\t\t\t\t\ty: 17\n\t\t\t\t}, {\n\t\t\t\t\tx: 17,\n\t\t\t\t\ty: 17\n\t\t\t\t}\n\t\t\t],\n\t\t},\n\t\t//stoneHandler: Board.drawHandlers.SHELL,\n\t\tstoneHandler: Board.drawHandlers.REALISTIC, // New photograph based stones\n\t\tstarSize: 1, // deprecated\n\t\tshadowSize: 1, // deprecated\n\t\tstoneSize: 1, // deprecated\n\t\tsection: {\n\t\t\ttop: 0,\n\t\t\tright: 0,\n\t\t\tbottom: 0,\n\t\t\tleft: 0,\n\t\t},\n\n\t\t//background: WGo.DIR+\"wood1.jpg\",    // Original version, tileing\n\t\t//background: WGo.DIR+\"wood_512.jpg\", // Mobile friendly, low resolution\n\t\tbackground: WGo.DIR + \"wood_1024.jpg\", // High resolution version, use with REALISTIC handler\n\n\t\t//whiteStoneGraphic: [ WGo.DIR+\"white_128.png\" ], // Single image only, hires\n\t\t//blackStoneGraphic: [ WGo.DIR+\"black_128.png\" ], // Single image only, hires\n\n\t\t//whiteStoneGraphic: [ WGo.DIR+\"white_64.png\" ], // Single image only, lowres\n\t\t//blackStoneGraphic: [ WGo.DIR+\"black_64.png\" ], // Single image only, lowres\n\n\t\twhiteStoneGraphic: [WGo.DIR + \"stones/white00_128.png\",\n\t\t\tWGo.DIR + \"stones/white01_128.png\",\n\t\t\tWGo.DIR + \"stones/white02_128.png\",\n\t\t\tWGo.DIR + \"stones/white03_128.png\",\n\t\t\tWGo.DIR + \"stones/white04_128.png\",\n\t\t\tWGo.DIR + \"stones/white05_128.png\",\n\t\t\tWGo.DIR + \"stones/white06_128.png\",\n\t\t\tWGo.DIR + \"stones/white07_128.png\",\n\t\t\tWGo.DIR + \"stones/white08_128.png\",\n\t\t\tWGo.DIR + \"stones/white09_128.png\",\n\t\t\tWGo.DIR + \"stones/white10_128.png\"\n\t\t],\n\t\tblackStoneGraphic: [WGo.DIR + \"stones/black00_128.png\",\n\t\t\tWGo.DIR + \"stones/black01_128.png\",\n\t\t\tWGo.DIR + \"stones/black02_128.png\",\n\t\t\tWGo.DIR + \"stones/black03_128.png\"\n\t\t],\n\n\t\ttheme: {}\n\t}\n\n\t// save Board\n\tWGo.Board = Board;\n\n\t//-------- WGo.Game ---------------------------------------------------------------------------\n\n\t/**\n\t * Creates instance of position object.\n\t *\n\t * @class\n\t * <p>WGo.Position is simple object storing position of go game. It is implemented as matrix <em>size</em> x <em>size</em> with values WGo.BLACK, WGo.WHITE or 0. It can be used by any extension.</p>\n\t *\n\t * @param {number} size of the board\n\t */\n\n\tvar Position = function (size) {\n\t\tthis.size = size || 19;\n\t\tthis.schema = [];\n\t\tfor (var i = 0; i < this.size * this.size; i++) {\n\t\t\tthis.schema[i] = 0;\n\t\t}\n\t}\n\n\tPosition.prototype = {\n\t\tconstructor: WGo.Position,\n\n\t\t/**\n\t\t * Returns value of given coordinates.\n\t\t *\n\t\t * @param {number} x coordinate\n\t\t * @param {number} y coordinate\n\t\t * @return {(WGo.BLACK|WGo.WHITE|0)} color\n\t\t */\n\n\t\tget: function (x, y) {\n\t\t\tif (x < 0 || y < 0 || x >= this.size || y >= this.size) return undefined;\n\t\t\treturn this.schema[x * this.size + y];\n\t\t},\n\n\t\t/**\n\t\t * Sets value of given coordinates.\n\t\t *\n\t\t * @param {number} x coordinate\n\t\t * @param {number} y coordinate\n\t\t * @param {(WGo.B|WGo.W|0)} c color\n\t\t */\n\n\t\tset: function (x, y, c) {\n\t\t\tthis.schema[x * this.size + y] = c;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Clears the whole position (every value is set to 0).\n\t\t */\n\n\t\tclear: function () {\n\t\t\tfor (var i = 0; i < this.size * this.size; i++) this.schema[i] = 0;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Clones the whole position.\n\t\t *\n\t\t * @return {WGo.Position} copy of position\n\t\t */\n\n\t\tclone: function () {\n\t\t\tvar clone = new Position(this.size);\n\t\t\tclone.schema = this.schema.slice(0);\n\t\t\treturn clone;\n\t\t},\n\n\t\t/**\n\t\t * Compares this position with another position and return change object\n\t\t *\n\t\t * @param {WGo.Position} position to compare to.\n\t\t * @return {object} change object with structure: {add:[], remove:[]}\n\t\t */\n\n\t\tcompare: function (position) {\n\t\t\tvar add = [],\n\t\t\t\tremove = [];\n\n\t\t\tfor (var i = 0; i < this.size * this.size; i++) {\n\t\t\t\tif (this.schema[i] && !position.schema[i]) remove.push({\n\t\t\t\t\tx: Math.floor(i / this.size),\n\t\t\t\t\ty: i % this.size\n\t\t\t\t});\n\t\t\t\telse if (this.schema[i] != position.schema[i]) add.push({\n\t\t\t\t\tx: Math.floor(i / this.size),\n\t\t\t\t\ty: i % this.size,\n\t\t\t\t\tc: position.schema[i]\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tadd: add,\n\t\t\t\tremove: remove\n\t\t\t}\n\t\t}\n\t}\n\n\tWGo.Position = Position;\n\n\t/**\n\t * Creates instance of game class.\n\t *\n\t * @class\n\t * This class implements game logic. It basically analyses given moves and returns capture stones.\n\t * WGo.Game also stores every position from beginning, so it has ability to check repeating positions\n\t * and it can effectively restore old positions.</p>\n\t *\n\t * @param {number} size of the board\n\t * @param {\"KO\"|\"ALL\"|\"NONE\"} checkRepeat (optional, default is \"KO\") - how to handle repeated position:\n\t * KO - ko is properly handled - position cannot be same like previous position\n\t * ALL - position cannot be same like any previous position - e.g. it forbids triple ko\n\t * NONE - position can be repeated\n\t *\n\t * @param {boolean} allowRewrite (optional, default is false) - allow to play moves, which were already played:\n\t * @param {boolean} allowSuicide (optional, default is false) - allow to play suicides, stones are immediately captured\n\t */\n\n\tvar Game = function (size, checkRepeat, allowRewrite, allowSuicide) {\n\t\tthis.size = size || 19;\n\t\tthis.repeating = checkRepeat === undefined ? \"KO\" : checkRepeat; // possible values: KO, ALL or nothing\n\t\tthis.allow_rewrite = allowRewrite || false;\n\t\tthis.allow_suicide = allowSuicide || false;\n\n\t\tthis.stack = [];\n\t\tthis.stack[0] = new Position(this.size);\n\t\tthis.stack[0].capCount = {\n\t\t\tblack: 0,\n\t\t\twhite: 0\n\t\t};\n\t\tthis.turn = WGo.B;\n\n\t\tObject.defineProperty(this, \"position\", {\n\t\t\tget: function () {\n\t\t\t\treturn this.stack[this.stack.length - 1];\n\t\t\t},\n\t\t\tset: function (pos) {\n\t\t\t\tthis.stack[this.stack.length - 1] = pos;\n\t\t\t}\n\t\t});\n\t}\n\n\t// function for stone capturing\n\tvar do_capture = function (position, captured, x, y, c) {\n\t\tif (x >= 0 && x < position.size && y >= 0 && y < position.size && position.get(x, y) == c) {\n\t\t\tposition.set(x, y, 0);\n\t\t\tcaptured.push({\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t});\n\n\t\t\tdo_capture(position, captured, x, y - 1, c);\n\t\t\tdo_capture(position, captured, x, y + 1, c);\n\t\t\tdo_capture(position, captured, x - 1, y, c);\n\t\t\tdo_capture(position, captured, x + 1, y, c);\n\t\t}\n\t\t// console.log('doCapture',position,captured,x,y,c)\n\t\t// return {x,y} //do_capture在哪裡可以使用此函式？ 回傳後的x y 可以反算回x y的client位置\n\t}\n\t// looking at liberties\n\tvar check_liberties = function (position, testing, x, y, c) {\n\t\t// out of the board there aren't liberties\n\t\tif (x < 0 || x >= position.size || y < 0 || y >= position.size) return true;\n\t\t// however empty field means liberty\n\t\tif (position.get(x, y) == 0) return false;\n\t\t// already tested field or stone of enemy isn't giving us a liberty.\n\t\tif (testing.get(x, y) == true || position.get(x, y) == -c) return true;\n\n\t\t// set this field as tested\n\t\ttesting.set(x, y, true);\n\n\t\t// in this case we are checking our stone, if we get 4 trues, it has no liberty\n\t\treturn check_liberties(position, testing, x, y - 1, c) &&\n\t\t\tcheck_liberties(position, testing, x, y + 1, c) &&\n\t\t\tcheck_liberties(position, testing, x - 1, y, c) &&\n\t\t\tcheck_liberties(position, testing, x + 1, y, c);\n\t}\n\n\n\t// analysing function - modifies original position, if there are some capturing, and returns array of captured stones\n\tvar check_capturing = function (position, x, y, c) {\n\t\tvar captured = [];\n\t\t// is there a stone possible to capture?\n\t\tif (x >= 0 && x < position.size && y >= 0 && y < position.size && position.get(x, y) == c) {\n\t\t\t// create testing map\n\t\t\tvar testing = new Position(position.size);\n\t\t\t// if it has zero liberties capture it\n\t\t\tif (check_liberties(position, testing, x, y, c)) {\n\t\t\t\t// capture stones from game\n\t\t\t\tdo_capture(position, captured, x, y, c);\n\t\t\t}\n\t\t}\n\n\t\treturn captured;\n\n\t}\n\n\t// analysing history\n\tvar checkHistory = function (position, x, y) {\n\t\tvar flag, stop;\n\n\t\tif (this.repeating == \"KO\" && this.stack.length - 2 >= 0) stop = this.stack.length - 2;\n\t\telse if (this.repeating == \"ALL\") stop = 0;\n\t\telse return true;\n\n\t\tfor (var i = this.stack.length - 2; i >= stop; i--) {\n\t\t\tif (this.stack[i].get(x, y) == position.get(x, y)) {\n\t\t\t\tflag = true;\n\t\t\t\tfor (var j = 0; j < this.size * this.size; j++) {\n\t\t\t\t\tif (this.stack[i].schema[j] != position.schema[j]) {\n\t\t\t\t\t\tflag = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (flag) return false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\tGame.prototype = {\n\n\t\tconstructor: Game,\n\n\t\t/**\n\t\t * Gets actual position.\n\t\t *\n\t\t * @return {WGo.Position} actual position\n\t\t */\n\n\t\tgetPosition: function () {\n\t\t\treturn this.stack[this.stack.length - 1];\n\t\t},\n\n\t\t/**\n\t\t * Play move.\n\t\t *\n\t\t * @param {number} x coordinate\n\t\t * @param {number} y coordinate\n\t\t * @param {(WGo.B|WGo.W)} c color\n\t\t * @param {boolean} noplay - if true, move isn't played. Used by WGo.Game.isValid.\n\t\t * @return {number} code of error, if move isn't valid. If it is valid, function returns array of captured stones.\n\t\t *\n\t\t * Error codes:\n\t\t * 1 - given coordinates are not on board\n\t\t * 2 - on given coordinates already is a stone\n\t\t * 3 - suicide (currently they are forbbiden)\n\t\t * 4 - repeated position\n\t\t */\n\n\t\tplay: function (x, y, c, noplay) {\n\t\t\t//check coordinates validity\n\t\t\tif (!this.isOnBoard(x, y)) return 1;\n\t\t\tif (!this.allow_rewrite && this.position.get(x, y) != 0) return 2;\n\n\t\t\t// clone position\n\t\t\tif (!c) c = this.turn;\n\n\t\t\tvar new_pos = this.position.clone();\n\t\t\tnew_pos.set(x, y, c);\n\n\t\t\t// check capturing\n\t\t\tvar cap_color = c;\n\t\t\tvar captured = check_capturing(new_pos, x - 1, y, -c).concat(check_capturing(new_pos, x + 1, y, -c), check_capturing(new_pos, x, y - 1, -c), check_capturing(new_pos, x, y + 1, -c));\n\n\t\t\t// check suicide\n\t\t\tif (!captured.length) {\n\t\t\t\tvar testing = new Position(this.size);\n\t\t\t\tif (check_liberties(new_pos, testing, x, y, c)) {\n\t\t\t\t\tif (this.allow_suicide) {\n\t\t\t\t\t\tcap_color = -c;\n\t\t\t\t\t\tdo_capture(new_pos, captured, x, y, c);\n\t\t\t\t\t} else return 3;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// check history\n\t\t\tif (this.repeating && !checkHistory.call(this, new_pos, x, y)) {\n\t\t\t\treturn 4;\n\t\t\t}\n\n\t\t\tif (noplay) return false;\n\n\t\t\t// update position info\n\t\t\tnew_pos.color = c;\n\t\t\tnew_pos.capCount = {\n\t\t\t\tblack: this.position.capCount.black,\n\t\t\t\twhite: this.position.capCount.white\n\t\t\t};\n\t\t\tif (cap_color == WGo.B) new_pos.capCount.black += captured.length;\n\t\t\telse new_pos.capCount.white += captured.length;\n\n\t\t\t// save position\n\t\t\tthis.pushPosition(new_pos);\n\n\t\t\t// reverse turn\n\t\t\tthis.turn = -c;\n\n\t\t\tconsole.log('capture in wgo.js', captured)\n\t\t\treturn captured;\n\t\t},\n\n\t\t/**\n\t\t * Play pass.\n\t\t *\n\t\t * @param {(WGo.B|WGo.W)} c color\n\t\t */\n\n\t\tpass: function (c) {\n\t\t\tthis.pushPosition();\n\t\t\tif (c) {\n\t\t\t\tthis.position.color = c;\n\t\t\t\tthis.turn = -c;\n\t\t\t} else {\n\t\t\t\tthis.position.color = this.turn;\n\t\t\t\tthis.turn = -this.turn;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Finds out validity of the move.\n\t\t *\n\t\t * @param {number} x coordinate\n\t\t * @param {number} y coordinate\n\t\t * @param {(WGo.B|WGo.W)} c color\n\t\t * @return {boolean} true if move can be played.\n\t\t */\n\n\t\tisValid: function (x, y, c) {\n\t\t\treturn typeof this.play(x, y, c, true) != \"number\";\n\t\t},\n\n\t\t/**\n\t\t * Controls position of the move.\n\t\t *\n\t\t * @param {number} x coordinate\n\t\t * @param {number} y coordinate\n\t\t * @return {boolean} true if move is on board.\n\t\t */\n\n\t\tisOnBoard: function (x, y) {\n\t\t\treturn x >= 0 && y >= 0 && x < this.size && y < this.size;\n\t\t},\n\n\t\t/**\n\t\t * Inserts move into current position. Use for setting position, for example in handicap game. Field must be empty.\n\t\t *\n\t\t * @param {number} x coordinate\n\t\t * @param {number} y coordinate\n\t\t * @param {(WGo.B|WGo.W)} c color\n\t\t * @return {boolean} true if operation is successfull.\n\t\t */\n\n\t\taddStone: function (x, y, c) {\n\t\t\tif (this.isOnBoard(x, y) && this.position.get(x, y) == 0) {\n\t\t\t\tthis.position.set(x, y, c || 0);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Removes move from current position.\n\t\t *\n\t\t * @param {number} x coordinate\n\t\t * @param {number} y coordinate\n\t\t * @return {boolean} true if operation is successfull.\n\t\t */\n\n\t\tremoveStone: function (x, y) {\n\t\t\tif (this.isOnBoard(x, y) && this.position.get(x, y) != 0) {\n\t\t\t\tthis.position.set(x, y, 0);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Set or insert move of current position.\n\t\t *\n\t\t * @param {number} x coordinate\n\t\t * @param {number} y coordinate\n\t\t * @param {(WGo.B|WGo.W)} c color\n\t\t * @return {boolean} true if operation is successfull.\n\t\t */\n\n\t\tsetStone: function (x, y, c) {\n\t\t\tif (this.isOnBoard(x, y)) {\n\t\t\t\tthis.position.set(x, y, c || 0);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Get stone on given position.\n\t\t *\n\t\t * @param {number} x coordinate\n\t\t * @param {number} y coordinate\n\t\t * @return {(WGo.B|WGo.W|0)} color\n\t\t */\n\n\t\tgetStone: function (x, y) {\n\t\t\tif (this.isOnBoard(x, y)) {\n\t\t\t\treturn this.position.get(x, y);\n\t\t\t}\n\t\t\treturn 0;\n\t\t},\n\n\t\t/**\n\t\t * Add position to stack. If position isn't specified current position is cloned and stacked.\n\t\t * Pointer of actual position is moved to the new position.\n\t\t *\n\t\t * @param {WGo.Position} tmp position (optional)\n\t\t */\n\n\t\tpushPosition: function (pos) {\n\t\t\tif (!pos) {\n\t\t\t\tvar pos = this.position.clone();\n\t\t\t\tpos.capCount = {\n\t\t\t\t\tblack: this.position.capCount.black,\n\t\t\t\t\twhite: this.position.capCount.white\n\t\t\t\t};\n\t\t\t\tpos.color = this.position.color;\n\t\t\t}\n\t\t\tthis.stack.push(pos);\n\t\t\tif (pos.color) this.turn = -pos.color;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Remove current position from stack. Pointer of actual position is moved to the previous position.\n\t\t */\n\n\t\tpopPosition: function () {\n\t\t\tvar old = null;\n\t\t\tif (this.stack.length > 0) {\n\t\t\t\told = this.stack.pop();\n\n\t\t\t\tif (this.stack.length == 0) this.turn = WGo.B;\n\t\t\t\telse if (this.position.color) this.turn = -this.position.color;\n\t\t\t\telse this.turn = -this.turn;\n\t\t\t}\n\t\t\treturn old;\n\t\t},\n\n\t\t/**\n\t\t * Removes all positions.\n\t\t */\n\n\t\tfirstPosition: function () {\n\t\t\tthis.stack = [];\n\t\t\tthis.stack[0] = new Position(this.size);\n\t\t\tthis.stack[0].capCount = {\n\t\t\t\tblack: 0,\n\t\t\t\twhite: 0\n\t\t\t};\n\t\t\tthis.turn = WGo.B;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Gets count of captured stones.\n\t\t *\n\t\t * @param {(WGo.BLACK|WGo.WHITE)} color\n\t\t * @return {number} count\n\t\t */\n\n\t\tgetCaptureCount: function (color) {\n\t\t\treturn color == WGo.B ? this.position.capCount.black : this.position.capCount.white;\n\t\t},\n\n\t\t/**\n\t\t * Validate postion. Position is tested from 0:0 to size:size, if there are some moves, that should be captured, they will be removed.\n\t\t * You can use this, after insertion of more stones.\n\t\t *\n\t\t * @return array removed stones\n\t\t */\n\n\t\tvalidatePosition: function () {\n\t\t\tvar c, p,\n\t\t\t\twhite = 0,\n\t\t\t\tblack = 0,\n\t\t\t\tcaptured = [],\n\t\t\t\tnew_pos = this.position.clone();\n\n\t\t\tfor (var x = 0; x < this.size; x++) {\n\t\t\t\tfor (var y = 0; y < this.size; y++) {\n\t\t\t\t\tc = this.position.get(x, y);\n\t\t\t\t\tif (c) {\n\t\t\t\t\t\tp = captured.length;\n\t\t\t\t\t\tcaptured = captured.concat(check_capturing(new_pos, x - 1, y, -c),\n\t\t\t\t\t\t\tcheck_capturing(new_pos, x + 1, y, -c),\n\t\t\t\t\t\t\tcheck_capturing(new_pos, x, y - 1, -c),\n\t\t\t\t\t\t\tcheck_capturing(new_pos, x, y + 1, -c));\n\n\t\t\t\t\t\tif (c == WGo.B) black += captured - p;\n\t\t\t\t\t\telse white += captured - p;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.position.capCount.black += black;\n\t\t\tthis.position.capCount.white += white;\n\t\t\tthis.position.schema = new_pos.schema;\n\t\t\treturn captured;\n\n\t\t},\n\t};\n\n\t// save Game\n\tWGo.Game = Game;\n\n\t// register WGo\n\twindow.WGo = WGo;\n\n})(window);"]}]}