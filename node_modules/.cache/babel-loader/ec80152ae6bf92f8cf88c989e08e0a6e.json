{"remainingRequest":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/babel-loader/lib/index.js!/Users/linchengxun/Desktop/vuego-testfunc/node_modules/eslint-loader/index.js??ref--13-0!/Users/linchengxun/Desktop/vuego-testfunc/wgo.js-master/wgo/wgo.js","dependencies":[{"path":"/Users/linchengxun/Desktop/vuego-testfunc/wgo.js-master/wgo/wgo.js","mtime":1552534440057},{"path":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _parseInt from \"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/@babel/runtime-corejs2/core-js/parse-int\";\nimport \"core-js/modules/es6.array.fill\";\nimport _typeof from \"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\nimport _Object$create from \"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/@babel/runtime-corejs2/core-js/object/create\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.regexp.search\";\nimport \"core-js/modules/es6.regexp.split\";\n\n/* eslint-disable */\n\n/*!\n * Copyright (c) 2013 Jan Prokop\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this\n * software and associated documentation files (the \"Software\"), to deal in the Software\n * without restriction, including without limitation the rights to use, copy, modify, merge,\n * publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons\n * to whom the Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all copies or\n * substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n * BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/* WGo.js 2.3.1 */\n(function (window, undefined) {\n  \"use strict\";\n\n  var scripts = document.getElementsByTagName('script');\n  var path = scripts[scripts.length - 1].src.split('?')[0]; // remove any ?query\n\n  var mydir = path.split('/').slice(0, -1).join('/') + '/';\n  /**\n   * Main namespace - it initializes WGo in first run and then execute main function.\n   * You must call WGo.init() if you want to use library, without calling WGo.\n   */\n\n  var WGo = {\n    // basic information\n    version: \"2.3.1\",\n    // constants for colors (rather use WGo.B or WGo.W)\n    B: 1,\n    W: -1,\n    // if true errors will be shown in dialog window, otherwise they will be ignored\n    ERROR_REPORT: true,\n    DIR: mydir,\n    // Language of player, you can change this global variable any time. Object WGo.i18n.<your lang> must exist.\n    lang: \"en\",\n    // Add terms for each language here\n    i18n: {\n      en: {}\n    } // browser detection - can be handy\n\n  };\n  WGo.opera = navigator.userAgent.search(/(opera)(?:.*version)?[ \\/]([\\w.]+)/i) != -1;\n  WGo.webkit = navigator.userAgent.search(/(webkit)[ \\/]([\\w.]+)/i) != -1;\n  WGo.msie = navigator.userAgent.search(/(msie) ([\\w.]+)/i) != -1;\n  WGo.mozilla = navigator.userAgent.search(/(mozilla)(?:.*? rv:([\\w.]+))?/i) != -1 && !WGo.webkit && !WGo.msie; // translating function\n\n  WGo.t = function (str) {\n    var loc = WGo.i18n[WGo.lang][str] || WGo.i18n.en[str];\n\n    if (loc) {\n      for (var i = 1; i < arguments.length; i++) {\n        loc = loc.replace(\"$\", arguments[i]);\n      }\n\n      return loc;\n    }\n\n    return str;\n  }; // helping function for class inheritance\n\n\n  WGo.extendClass = function (parent, child) {\n    child.prototype = _Object$create(parent.prototype);\n    child.prototype.constructor = child;\n    child.prototype.super = parent;\n    return child;\n  }; // helping function for class inheritance\n\n\n  WGo.abstractMethod = function () {\n    throw Error('unimplemented abstract method');\n  }; // helping function for deep cloning of simple objects,\n\n\n  WGo.clone = function (obj) {\n    if (obj && _typeof(obj) == \"object\") {\n      var n_obj = obj.constructor == Array ? [] : {};\n\n      for (var key in obj) {\n        if (obj[key] == obj) n_obj[key] = obj;else n_obj[key] = WGo.clone(obj[key]);\n      }\n\n      return n_obj;\n    } else return obj;\n  }; // filter html to avoid XSS\n\n\n  WGo.filterHTML = function (text) {\n    if (!text || typeof text != \"string\") return text;\n    return text.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n  }; //---------------------- WGo.Board -----------------------------------------------------------------------------\n\n  /**\n   * Board class constructor - it creates a canvas board\n   *\n   * @param elem DOM element to put in\n   * @param config configuration object. It is object with \"key: value\" structure. Possible configurations are:\n   *\n   * - size: number - size of the board (default: 19)\n   * - width: number - width of the board (default: 0)\n   * - height: number - height of the board (default: 0)\n   * - font: string - font of board writings (!deprecated)\n   * - lineWidth: number - line width of board drawings (!deprecated)\n   * - autoLineWidth: boolean - if set true, line width will be automatically computed accordingly to board size - this option rewrites 'lineWidth' /and it will keep markups sharp/ (!deprecated)\n   * - starPoints: Object - star points coordinates, defined for various board sizes. Look at Board.default for more info.\n   * - stoneHandler: Board.DrawHandler - stone drawing handler (default: Board.drawHandlers.SHELL)\n   * - starSize: number - size of star points (default: 1). Radius of stars is dynamic, however you can modify it by given constant. (!deprecated)\n   * - stoneSize: number - size of stone (default: 1). Radius of stone is dynamic, however you can modify it by given constant. (!deprecated)\n   * - shadowSize: number - size of stone shadow (default: 1). Radius of shadow is dynamic, however you can modify it by given constant. (!deprecated)\n   * - background: string - background of the board, it can be either color (#RRGGBB) or url. Empty string means no background. (default: WGo.DIR+\"wood1.jpg\")\n   * - section: {\n   *     top: number,\n   *     right: number,\n   *     bottom: number,\n   *     left: number\n   *   }\n   *   It defines a section of board to be displayed. You can set a number of rows(or cols) to be skipped on each side.\n   *   Numbers can be negative, in that case there will be more empty space. In default all values are zeros.\n   * - theme: Object - theme object, which defines all graphical attributes of the board. Default theme object is \"WGo.Board.themes.default\". For old look you may use \"WGo.Board.themes.old\".\n   *\n   * Note: properties lineWidth, autoLineWidth, starPoints, starSize, stoneSize and shadowSize will be considered only if you set property 'theme' to 'WGo.Board.themes.old'.\n   */\n\n\n  var Board = function Board(elem, config) {\n    var config = config || {}; // set user configuration\n\n    for (var key in config) {\n      this[key] = config[key];\n    } // add default configuration\n\n\n    for (var key in WGo.Board.default) {\n      if (this[key] === undefined) this[key] = WGo.Board.default[key];\n    } // add default theme variables\n\n\n    for (var key in Board.themes.default) {\n      if (this.theme[key] === undefined) this.theme[key] = Board.themes.default[key];\n    } // set section if set\n\n\n    this.tx = this.section.left;\n    this.ty = this.section.top;\n    this.bx = this.size - 1 - this.section.right;\n    this.by = this.size - 1 - this.section.bottom; // init board\n\n    this.init(); // append to element\n\n    elem.appendChild(this.element); // set initial dimensions\n    // set the pixel ratio for HDPI (e.g. Retina) screens\n\n    this.pixelRatio = window.devicePixelRatio || 1;\n    if (this.width && this.height) this.setDimensions(this.width, this.height);else if (this.width) this.setWidth(this.width);else if (this.height) this.setHeight(this.height);\n  }; // New experimental board theme system - it can be changed in future, if it will appear to be unsuitable.\n\n\n  Board.themes = {};\n  Board.themes.old = {\n    shadowColor: \"rgba(32,32,32,0.5)\",\n    shadowTransparentColor: \"rgba(32,32,32,0)\",\n    shadowBlur: 0,\n    shadowSize: function shadowSize(board) {\n      return board.shadowSize;\n    },\n    markupBlackColor: \"rgba(255,255,255,0.8)\",\n    markupWhiteColor: \"rgba(0,0,0,0.8)\",\n    markupNoneColor: \"rgba(0,0,0,0.8)\",\n    markupLinesWidth: function markupLinesWidth(board) {\n      return board.autoLineWidth ? board.stoneRadius / 7 : board.lineWidth;\n    },\n    gridLinesWidth: 1,\n    gridLinesColor: function gridLinesColor(board) {\n      return \"rgba(0,0,0,\" + Math.min(1, board.stoneRadius / 15) + \")\";\n    },\n    starColor: \"#000\",\n    starSize: function starSize(board) {\n      return board.starSize * (board.width / 300 + 1);\n    },\n    stoneSize: function stoneSize(board) {\n      return board.stoneSize * Math.min(board.fieldWidth, board.fieldHeight) / 2;\n    },\n    coordinatesColor: \"rgba(0,0,0,0.7)\",\n    font: function font(board) {\n      return board.font;\n    },\n    linesShift: 0.5\n    /**\n     * Object containing default graphical properties of a board.\n     * A value of all properties can be even static value or function, returning final value.\n     * Theme object doesn't set board and stone textures - they are set separately.\n     */\n\n  };\n  Board.themes.default = {\n    shadowColor: \"rgba(62,32,32,0.5)\",\n    shadowTransparentColor: \"rgba(62,32,32,0)\",\n    shadowBlur: function shadowBlur(board) {\n      return board.stoneRadius * 0.1;\n    },\n    shadowSize: 1,\n    markupBlackColor: \"rgba(255,255,255,0.9)\",\n    markupWhiteColor: \"rgba(0,0,0,0.7)\",\n    markupNoneColor: \"rgba(0,0,0,0.7)\",\n    markupLinesWidth: function markupLinesWidth(board) {\n      return board.stoneRadius / 8;\n    },\n    gridLinesWidth: function gridLinesWidth(board) {\n      return board.stoneRadius / 15;\n    },\n    gridLinesColor: \"#654525\",\n    starColor: \"#531\",\n    starSize: function starSize(board) {\n      return board.stoneRadius / 8 + 1;\n    },\n    stoneSize: function stoneSize(board) {\n      return Math.min(board.fieldWidth, board.fieldHeight) / 2;\n    },\n    coordinatesColor: \"#531\",\n    variationColor: \"rgba(0,32,128,0.8)\",\n    font: \"calibri\",\n    linesShift: 0.25\n  };\n\n  var theme_variable = function theme_variable(key, board) {\n    return typeof board.theme[key] == \"function\" ? board.theme[key](board) : board.theme[key];\n  };\n\n  var shadow_handler = {\n    draw: function draw(args, board) {\n      var xr = board.getX(args.x),\n          yr = board.getY(args.y),\n          sr = board.stoneRadius;\n      this.beginPath();\n      var blur = theme_variable(\"shadowBlur\", board);\n      var radius = Math.max(0, sr - 0.5);\n      var gradient = this.createRadialGradient(xr - board.ls, yr - board.ls, radius - 1 - blur, xr - board.ls, yr - board.ls, radius + blur);\n      gradient.addColorStop(0, theme_variable(\"shadowColor\", board));\n      gradient.addColorStop(1, theme_variable(\"shadowTransparentColor\", board));\n      this.fillStyle = gradient;\n      this.arc(xr - board.ls, yr - board.ls, radius + blur, 0, 2 * Math.PI, true);\n      this.fill();\n    },\n    clear: function clear(args, board) {\n      var xr = board.getX(args.x),\n          yr = board.getY(args.y),\n          sr = board.stoneRadius;\n      this.clearRect(xr - 1.1 * sr - board.ls, yr - 1.1 * sr - board.ls, 2.2 * sr, 2.2 * sr);\n    } // Shadow handler for the 'REALISITC' rendering mode\n\n  };\n  var shadow_handler_realistic = {\n    draw: function draw(args, board) {\n      var xr = board.getX(args.x),\n          yr = board.getY(args.y),\n          sr = board.stoneRadius,\n          lsX = 1.0,\n          lsY = -5.0,\n          blur = 5.0;\n      this.beginPath();\n      var radius = Math.max(0, (sr - 0.5) * 0.85);\n      var gradient = this.createRadialGradient(xr - lsX, yr - lsY, radius - 1 - blur, xr - lsX, yr - lsY, radius + blur);\n      gradient.addColorStop(0, theme_variable(\"shadowColor\", board));\n      gradient.addColorStop(1, theme_variable(\"shadowTransparentColor\", board));\n      this.fillStyle = gradient;\n      this.arc(xr - lsX, yr - lsY, radius + blur, 0, 2 * Math.PI, true);\n      this.fill();\n    },\n    clear: function clear(args, board) {\n      var xr = board.getX(args.x),\n          yr = board.getY(args.y),\n          sr = board.stoneRadius,\n          lsX = 1.0,\n          lsY = -5.0,\n          blur = 5.0;\n      this.clearRect(xr - 1.1 * sr - lsX, yr - 1.1 * sr - lsY, 2.2 * sr, 2.2 * sr);\n    }\n  };\n\n  var get_markup_color = function get_markup_color(board, x, y) {\n    if (board.obj_arr[x][y][0].c == WGo.B) return theme_variable(\"markupBlackColor\", board);else if (board.obj_arr[x][y][0].c == WGo.W) return theme_variable(\"markupWhiteColor\", board);\n    return theme_variable(\"markupNoneColor\", board);\n  };\n\n  var is_here_stone = function is_here_stone(board, x, y) {\n    return board.obj_arr[x][y][0] && board.obj_arr[x][y][0].c == WGo.W || board.obj_arr[x][y][0].c == WGo.B;\n  };\n\n  var redraw_layer = function redraw_layer(board, layer) {\n    var handler;\n    board[layer].clear();\n    board[layer].draw(board);\n\n    for (var x = 0; x < board.size; x++) {\n      for (var y = 0; y < board.size; y++) {\n        for (var z = 0; z < board.obj_arr[x][y].length; z++) {\n          var obj = board.obj_arr[x][y][z];\n          if (!obj.type) handler = board.stoneHandler;else if (typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];else handler = obj.type;\n          if (handler[layer]) handler[layer].draw.call(board[layer].getContext(obj), obj, board);\n        }\n      }\n    }\n\n    for (var i = 0; i < board.obj_list.length; i++) {\n      var obj = board.obj_list[i];\n      var handler = obj.handler;\n      if (handler[layer]) handler[layer].draw.call(board[layer].getContext(obj.args), obj.args, board);\n    }\n  }; // shell stone helping functions\n\n\n  var shell_seed;\n\n  var draw_shell_line = function draw_shell_line(ctx, x, y, radius, start_angle, end_angle, factor, thickness) {\n    ctx.strokeStyle = \"rgba(64,64,64,0.2)\";\n    ctx.lineWidth = radius / 30 * thickness;\n    ctx.beginPath();\n    radius -= Math.max(1, ctx.lineWidth);\n    var x1 = x + radius * Math.cos(start_angle * Math.PI);\n    var y1 = y + radius * Math.sin(start_angle * Math.PI);\n    var x2 = x + radius * Math.cos(end_angle * Math.PI);\n    var y2 = y + radius * Math.sin(end_angle * Math.PI);\n    var m, angle, x, diff_x, diff_y;\n\n    if (x2 > x1) {\n      m = (y2 - y1) / (x2 - x1);\n      angle = Math.atan(m);\n    } else if (x2 == x1) {\n      angle = Math.PI / 2;\n    } else {\n      m = (y2 - y1) / (x2 - x1);\n      angle = Math.atan(m) - Math.PI;\n    }\n\n    var c = factor * radius;\n    diff_x = Math.sin(angle) * c;\n    diff_y = Math.cos(angle) * c;\n    var bx1 = x1 + diff_x;\n    var by1 = y1 - diff_y;\n    var bx2 = x2 + diff_x;\n    var by2 = y2 - diff_y;\n    ctx.moveTo(x1, y1);\n    ctx.bezierCurveTo(bx1, by1, bx2, by2, x2, y2);\n    ctx.stroke();\n  };\n\n  var draw_shell = function draw_shell(arg) {\n    var from_angle = arg.angle;\n    var to_angle = arg.angle;\n\n    for (var i = 0; i < arg.lines.length; i++) {\n      from_angle += arg.lines[i];\n      to_angle -= arg.lines[i];\n      draw_shell_line(arg.ctx, arg.x, arg.y, arg.radius, from_angle, to_angle, arg.factor, arg.thickness);\n    }\n  }; // drawing handlers\n\n\n  Board.drawHandlers = {\n    // handler for normal stones\n    NORMAL: {\n      // draw handler for stone layer\n      stone: {\n        // drawing function - args object contain info about drawing object, board is main board object\n        // this function is called from canvas2D context\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius,\n              radgrad; // set stone texture\n\n          if (args.c == WGo.W) {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, sr / 3, xr - sr / 5, yr - sr / 5, 5 * sr / 5);\n            radgrad.addColorStop(0, '#fff');\n            radgrad.addColorStop(1, '#aaa');\n          } else {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 1, xr - sr / 5, yr - sr / 5, 4 * sr / 5);\n            radgrad.addColorStop(0, '#666');\n            radgrad.addColorStop(1, '#000');\n          } // paint stone\n\n\n          this.beginPath();\n          this.fillStyle = radgrad;\n          this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n          this.fill();\n        }\n      },\n      // adding shadow handler\n      shadow: shadow_handler\n    },\n    PAINTED: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius,\n              radgrad;\n\n          if (args.c == WGo.W) {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 2, xr - sr / 5, yr - sr / 5, 4 * sr / 5);\n            radgrad.addColorStop(0, '#fff');\n            radgrad.addColorStop(1, '#ddd');\n          } else {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 1, xr - sr / 5, yr - sr / 5, 4 * sr / 5);\n            radgrad.addColorStop(0, '#111');\n            radgrad.addColorStop(1, '#000');\n          }\n\n          this.beginPath();\n          this.fillStyle = radgrad;\n          this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n          this.fill();\n          this.beginPath();\n          this.lineWidth = sr / 6;\n\n          if (args.c == WGo.W) {\n            this.strokeStyle = '#999';\n            this.arc(xr + sr / 8, yr + sr / 8, sr / 2, 0, Math.PI / 2, false);\n          } else {\n            this.strokeStyle = '#ccc';\n            this.arc(xr - sr / 8, yr - sr / 8, sr / 2, Math.PI, 1.5 * Math.PI);\n          }\n\n          this.stroke();\n        }\n      },\n      shadow: shadow_handler\n    },\n    // handler for image based stones\n    REALISTIC: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          var whiteCount = board.whiteStoneGraphic.length;\n          var blackCount = board.blackStoneGraphic.length;\n\n          if (typeof this.randIndex === 'undefined') {\n            this.randIndex = Math.ceil(Math.random() * 1e5);\n          }\n\n          var redraw = function redraw() {\n            board.redraw();\n          }; // Check if image has been loaded properly\n          // see https://stereochro.me/ideas/detecting-broken-images-js\n\n\n          var isOkay = function isOkay(img) {\n            if (typeof img === 'string') {\n              return false;\n            }\n\n            if (!img.complete) {\n              return false;\n            }\n\n            if (typeof img.naturalWidth != \"undefined\" && img.naturalWidth == 0) {\n              return false;\n            }\n\n            return true;\n          };\n\n          if (args.c == WGo.W) {\n            var idx = this.randIndex % whiteCount;\n\n            if (typeof board.whiteStoneGraphic[idx] === 'string') {\n              // The image has not been loaded yet\n              var stoneGraphic = new Image(); // Redraw the whole board after the image has been loaded.\n              // This prevents 'missing stones' and similar graphical errors\n              // especially on slower internet connections.\n\n              stoneGraphic.onload = redraw;\n              stoneGraphic.src = board.whiteStoneGraphic[idx];\n              board.whiteStoneGraphic[idx] = stoneGraphic;\n            }\n\n            if (isOkay(board.whiteStoneGraphic[idx])) {\n              this.drawImage(board.whiteStoneGraphic[idx], xr - sr, yr - sr, 2 * sr, 2 * sr);\n            } else {\n              // Fall back to SHELL handler if there was a problem loading the image\n              Board.drawHandlers.SHELL.stone.draw.call(this, args, board);\n            }\n          } else {\n            // args.c == WGo.B\n            var idx = this.randIndex % blackCount;\n\n            if (typeof board.blackStoneGraphic[idx] === 'string') {\n              var stoneGraphic = new Image();\n              stoneGraphic.onload = redraw;\n              stoneGraphic.src = board.blackStoneGraphic[idx];\n              board.blackStoneGraphic[idx] = stoneGraphic;\n            }\n\n            if (isOkay(board.blackStoneGraphic[idx])) {\n              this.drawImage(board.blackStoneGraphic[idx], xr - sr, yr - sr, 2 * sr, 2 * sr);\n            } else {\n              Board.drawHandlers.SHELL.stone.draw.call(this, args, board);\n            }\n          }\n        }\n      },\n      shadow: shadow_handler_realistic\n    },\n    GLOW: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          var radgrad;\n\n          if (args.c == WGo.W) {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, sr / 3, xr - sr / 5, yr - sr / 5, 8 * sr / 5);\n            radgrad.addColorStop(0, '#fff');\n            radgrad.addColorStop(1, '#666');\n          } else {\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, 1, xr - sr / 5, yr - sr / 5, 3 * sr / 5);\n            radgrad.addColorStop(0, '#555');\n            radgrad.addColorStop(1, '#000');\n          }\n\n          this.beginPath();\n          this.fillStyle = radgrad;\n          this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n          this.fill();\n        }\n      },\n      shadow: shadow_handler\n    },\n    SHELL: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr,\n              yr,\n              sr = board.stoneRadius;\n          shell_seed = shell_seed || Math.ceil(Math.random() * 9999999);\n          xr = board.getX(args.x);\n          yr = board.getY(args.y);\n          var radgrad;\n\n          if (args.c == WGo.W) {\n            radgrad = \"#aaa\";\n          } else {\n            radgrad = \"#000\";\n          }\n\n          this.beginPath();\n          this.fillStyle = radgrad;\n          this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n          this.fill(); // do shell magic here\n\n          if (args.c == WGo.W) {\n            // do shell magic here\n            var type = shell_seed % (3 + args.x * board.size + args.y) % 3;\n            var z = board.size * board.size + args.x * board.size + args.y;\n            var angle = 2 / z * (shell_seed % z);\n\n            if (type == 0) {\n              draw_shell({\n                ctx: this,\n                x: xr,\n                y: yr,\n                radius: sr,\n                angle: angle,\n                lines: [0.10, 0.12, 0.11, 0.10, 0.09, 0.09, 0.09, 0.09],\n                factor: 0.25,\n                thickness: 1.75\n              });\n            } else if (type == 1) {\n              draw_shell({\n                ctx: this,\n                x: xr,\n                y: yr,\n                radius: sr,\n                angle: angle,\n                lines: [0.10, 0.09, 0.08, 0.07, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06],\n                factor: 0.2,\n                thickness: 1.5\n              });\n            } else {\n              draw_shell({\n                ctx: this,\n                x: xr,\n                y: yr,\n                radius: sr,\n                angle: angle,\n                lines: [0.12, 0.14, 0.13, 0.12, 0.12, 0.12],\n                factor: 0.3,\n                thickness: 2\n              });\n            }\n\n            radgrad = this.createRadialGradient(xr - 2 * sr / 5, yr - 2 * sr / 5, sr / 3, xr - sr / 5, yr - sr / 5, 5 * sr / 5);\n            radgrad.addColorStop(0, 'rgba(255,255,255,0.9)');\n            radgrad.addColorStop(1, 'rgba(255,255,255,0)'); // add radial gradient //\n\n            this.beginPath();\n            this.fillStyle = radgrad;\n            this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n            this.fill();\n          } else {\n            radgrad = this.createRadialGradient(xr + 0.4 * sr, yr + 0.4 * sr, 0, xr + 0.5 * sr, yr + 0.5 * sr, sr);\n            radgrad.addColorStop(0, 'rgba(32,32,32,1)');\n            radgrad.addColorStop(1, 'rgba(0,0,0,0)');\n            this.beginPath();\n            this.fillStyle = radgrad;\n            this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n            this.fill();\n            radgrad = this.createRadialGradient(xr - 0.4 * sr, yr - 0.4 * sr, 1, xr - 0.5 * sr, yr - 0.5 * sr, 1.5 * sr);\n            radgrad.addColorStop(0, 'rgba(64,64,64,1)');\n            radgrad.addColorStop(1, 'rgba(0,0,0,0)');\n            this.beginPath();\n            this.fillStyle = radgrad;\n            this.arc(xr - board.ls, yr - board.ls, Math.max(0, sr - 0.5), 0, 2 * Math.PI, true);\n            this.fill();\n          }\n        }\n      },\n      shadow: shadow_handler\n    },\n    MONO: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius,\n              lw = theme_variable(\"markupLinesWidth\", board) || 1;\n          if (args.c == WGo.W) this.fillStyle = \"white\";else this.fillStyle = \"black\";\n          this.beginPath();\n          this.arc(xr, yr, Math.max(0, sr - lw), 0, 2 * Math.PI, true);\n          this.fill();\n          this.lineWidth = lw;\n          this.strokeStyle = \"black\";\n          this.stroke();\n        }\n      }\n    },\n    CR: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n          this.beginPath();\n          this.arc(xr - board.ls, yr - board.ls, sr / 2, 0, 2 * Math.PI, true);\n          this.stroke();\n        }\n      }\n    },\n    // Label drawing handler\n    LB: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius,\n              font = args.font || theme_variable(\"font\", board) || \"\";\n          this.fillStyle = args.c || get_markup_color(board, args.x, args.y);\n          if (args.text.length == 1) this.font = Math.round(sr * 1.5) + \"px \" + font;else if (args.text.length == 2) this.font = Math.round(sr * 1.2) + \"px \" + font;else this.font = Math.round(sr) + \"px \" + font;\n          this.beginPath();\n          this.textBaseline = \"middle\";\n          this.textAlign = \"center\";\n          this.fillText(args.text, xr, yr, 2 * sr);\n        }\n      },\n      // modifies grid layer too\n      grid: {\n        draw: function draw(args, board) {\n          if (!is_here_stone(board, args.x, args.y) && !args._nodraw) {\n            var xr = board.getX(args.x),\n                yr = board.getY(args.y),\n                sr = board.stoneRadius;\n            this.clearRect(xr - sr, yr - sr, 2 * sr, 2 * sr);\n          }\n        },\n        clear: function clear(args, board) {\n          if (!is_here_stone(board, args.x, args.y)) {\n            args._nodraw = true;\n            redraw_layer(board, \"grid\");\n            delete args._nodraw;\n          }\n        }\n      }\n    },\n    SQ: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = Math.round(board.stoneRadius);\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n          this.beginPath();\n          this.rect(Math.round(xr - sr / 2) - board.ls, Math.round(yr - sr / 2) - board.ls, sr, sr);\n          this.stroke();\n        }\n      }\n    },\n    TR: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n          this.beginPath();\n          this.moveTo(xr - board.ls, yr - board.ls - Math.round(sr / 2));\n          this.lineTo(Math.round(xr - sr / 2) - board.ls, Math.round(yr + sr / 3) + board.ls);\n          this.lineTo(Math.round(xr + sr / 2) + board.ls, Math.round(yr + sr / 3) + board.ls);\n          this.closePath();\n          this.stroke();\n        }\n      }\n    },\n    MA: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineCap = \"round\";\n          this.lineWidth = (args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1) * 2 - 1;\n          this.beginPath();\n          this.moveTo(Math.round(xr - sr / 2), Math.round(yr - sr / 2));\n          this.lineTo(Math.round(xr + sr / 2), Math.round(yr + sr / 2));\n          this.moveTo(Math.round(xr + sr / 2) - 1, Math.round(yr - sr / 2));\n          this.lineTo(Math.round(xr - sr / 2) - 1, Math.round(yr + sr / 2));\n          this.stroke();\n          this.lineCap = \"butt\";\n        }\n      }\n    },\n    SL: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.fillStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.beginPath();\n          this.rect(xr - sr / 2, yr - sr / 2, sr, sr);\n          this.fill();\n        }\n      }\n    },\n    SM: {\n      stone: {\n        draw: function draw(args, board) {\n          var xr = board.getX(args.x),\n              yr = board.getY(args.y),\n              sr = board.stoneRadius;\n          this.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n          this.lineWidth = (args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1) * 2;\n          this.beginPath();\n          this.arc(xr - sr / 3, yr - sr / 3, sr / 6, 0, 2 * Math.PI, true);\n          this.stroke();\n          this.beginPath();\n          this.arc(xr + sr / 3, yr - sr / 3, sr / 6, 0, 2 * Math.PI, true);\n          this.stroke();\n          this.beginPath();\n          this.moveTo(xr - sr / 1.5, yr);\n          this.bezierCurveTo(xr - sr / 1.5, yr + sr / 2, xr + sr / 1.5, yr + sr / 2, xr + sr / 1.5, yr);\n          this.stroke();\n        }\n      }\n    },\n    outline: {\n      stone: {\n        draw: function draw(args, board) {\n          if (args.alpha) this.globalAlpha = args.alpha;else this.globalAlpha = 0.3;\n          if (args.stoneStyle) Board.drawHandlers[args.stoneStyle].stone.draw.call(this, args, board);else board.stoneHandler.stone.draw.call(this, args, board);\n          this.globalAlpha = 1;\n        }\n      }\n    },\n    mini: {\n      stone: {\n        draw: function draw(args, board) {\n          board.stoneRadius = board.stoneRadius / 2;\n          if (args.stoneStyle) Board.drawHandlers[args.stoneStyle].stone.draw.call(this, args, board);else board.stoneHandler.stone.draw.call(this, args, board);\n          board.stoneRadius = board.stoneRadius * 2;\n        }\n      }\n    }\n  };\n  Board.coordinates = {\n    grid: {\n      draw: function draw(args, board) {\n        var ch, t, xright, xleft, ytop, ybottom;\n        this.fillStyle = theme_variable(\"coordinatesColor\", board);\n        this.textBaseline = \"middle\";\n        this.textAlign = \"center\";\n        this.font = board.stoneRadius + \"px \" + (board.font || \"\");\n        xright = board.getX(-0.75);\n        xleft = board.getX(board.size - 0.25);\n        ytop = board.getY(-0.75);\n        ybottom = board.getY(board.size - 0.25);\n\n        for (var i = 0; i < board.size; i++) {\n          ch = i + \"A\".charCodeAt(0);\n          if (ch >= \"I\".charCodeAt(0)) ch++;\n          t = board.getY(i);\n          this.fillText(board.size - i, xright, t);\n          this.fillText(board.size - i, xleft, t);\n          t = board.getX(i);\n          this.fillText(String.fromCharCode(ch), t, ytop);\n          this.fillText(String.fromCharCode(ch), t, ybottom);\n        }\n\n        this.fillStyle = \"black\";\n      }\n    }\n  };\n\n  Board.CanvasLayer = function () {\n    this.element = document.createElement('canvas');\n    this.context = this.element.getContext('2d'); // Adjust pixel ratio for HDPI screens (e.g. Retina)\n\n    this.pixelRatio = window.devicePixelRatio || 1;\n\n    if (this.pixelRatio > 1) {\n      this.context.scale(this.pixelRatio, this.pixelRatio);\n    }\n  };\n\n  Board.CanvasLayer.prototype = {\n    constructor: Board.CanvasLayer,\n    setDimensions: function setDimensions(width, height) {\n      this.element.width = width;\n      this.element.style.width = width / this.pixelRatio + 'px';\n      this.element.height = height;\n      this.element.style.height = height / this.pixelRatio + 'px';\n    },\n    appendTo: function appendTo(element, weight) {\n      this.element.style.position = 'absolute';\n      this.element.style.zIndex = weight;\n      element.appendChild(this.element);\n    },\n    removeFrom: function removeFrom(element) {\n      element.removeChild(this.element);\n    },\n    getContext: function getContext() {\n      return this.context;\n    },\n    draw: function draw(board) {},\n    clear: function clear() {\n      this.context.clearRect(0, 0, this.element.width, this.element.height);\n    }\n  };\n  Board.GridLayer = WGo.extendClass(Board.CanvasLayer, function () {\n    this.super.call(this);\n  });\n\n  Board.GridLayer.prototype.draw = function (board) {\n    // draw grid\n    var tmp;\n    this.context.beginPath();\n    this.context.lineWidth = theme_variable(\"gridLinesWidth\", board);\n    this.context.strokeStyle = theme_variable(\"gridLinesColor\", board);\n    var tx = Math.round(board.left),\n        ty = Math.round(board.top),\n        bw = Math.round(board.fieldWidth * (board.size - 1)),\n        bh = Math.round(board.fieldHeight * (board.size - 1));\n    this.context.strokeRect(tx - board.ls, ty - board.ls, bw, bh);\n\n    for (var i = 1; i < board.size - 1; i++) {\n      tmp = Math.round(board.getX(i)) - board.ls;\n      this.context.moveTo(tmp, ty);\n      this.context.lineTo(tmp, ty + bh);\n      tmp = Math.round(board.getY(i)) - board.ls;\n      this.context.moveTo(tx, tmp);\n      this.context.lineTo(tx + bw, tmp);\n    }\n\n    this.context.stroke(); // draw stars\n\n    this.context.fillStyle = theme_variable(\"starColor\", board);\n\n    if (board.starPoints[board.size]) {\n      for (var key in board.starPoints[board.size]) {\n        this.context.beginPath();\n        this.context.arc(board.getX(board.starPoints[board.size][key].x) - board.ls, board.getY(board.starPoints[board.size][key].y) - board.ls, theme_variable(\"starSize\", board), 0, 2 * Math.PI, true);\n        this.context.fill();\n      }\n    }\n  };\n  /**\n   * Layer that is composed from more canvases. The proper canvas is selected according to drawn object.\n   * In default there are 4 canvases and they are used for board objects like stones. This allows overlapping of objects.\n   */\n\n\n  Board.MultipleCanvasLayer = WGo.extendClass(Board.CanvasLayer, function () {\n    this.init(4);\n  });\n\n  Board.MultipleCanvasLayer.prototype.init = function (n) {\n    var tmp, tmpContext;\n    this.layers = n;\n    this.elements = [];\n    this.contexts = []; // Adjust pixel ratio for HDPI screens (e.g. Retina)\n\n    this.pixelRatio = window.devicePixelRatio || 1;\n\n    for (var i = 0; i < n; i++) {\n      tmp = document.createElement('canvas');\n      tmpContext = tmp.getContext('2d');\n\n      if (this.pixelRatio > 1) {\n        tmpContext.scale(this.pixelRatio, this.pixelRatio);\n      }\n\n      this.elements.push(tmp);\n      this.contexts.push(tmpContext);\n    }\n  };\n\n  Board.MultipleCanvasLayer.prototype.appendTo = function (element, weight) {\n    for (var i = 0; i < this.layers; i++) {\n      this.elements[i].style.position = 'absolute';\n      this.elements[i].style.zIndex = weight;\n      element.appendChild(this.elements[i]);\n    }\n  };\n\n  Board.MultipleCanvasLayer.prototype.removeFrom = function (element) {\n    for (var i = 0; i < this.layers; i++) {\n      element.removeChild(this.elements[i]);\n    }\n  };\n\n  Board.MultipleCanvasLayer.prototype.getContext = function (args) {\n    if (args.x % 2) {\n      return args.y % 2 ? this.contexts[0] : this.contexts[1];\n    } else {\n      return args.y % 2 ? this.contexts[2] : this.contexts[3];\n    } //return ((args.x%2) && (args.y%2) || !(args.x%2) && !(args.y%2)) ? this.context_odd : this.context_even;\n\n  };\n\n  Board.MultipleCanvasLayer.prototype.clear = function (element, weight) {\n    for (var i = 0; i < this.layers; i++) {\n      this.contexts[i].clearRect(0, 0, this.elements[i].width, this.elements[i].height);\n    }\n  };\n\n  Board.MultipleCanvasLayer.prototype.setDimensions = function (width, height) {\n    for (var i = 0; i < this.layers; i++) {\n      this.elements[i].width = width;\n      this.elements[i].style.width = width / this.pixelRatio + 'px';\n      this.elements[i].height = height;\n      this.elements[i].style.height = height / this.pixelRatio + 'px';\n    }\n  };\n\n  Board.ShadowLayer = WGo.extendClass(Board.MultipleCanvasLayer, function (board, shadowSize, shadowBlur) {\n    this.init(2);\n    this.shadowSize = shadowSize === undefined ? 1 : shadowSize;\n    this.board = board;\n  });\n\n  Board.ShadowLayer.prototype.getContext = function (args) {\n    return args.x % 2 && args.y % 2 || !(args.x % 2) && !(args.y % 2) ? this.contexts[0] : this.contexts[1];\n  };\n\n  Board.ShadowLayer.prototype.setDimensions = function (width, height) {\n    this.super.prototype.setDimensions.call(this, width, height);\n\n    for (var i = 0; i < this.layers; i++) {\n      this.contexts[i].setTransform(1, 0, 0, 1, Math.round(this.shadowSize * this.board.stoneRadius / 7), Math.round(this.shadowSize * this.board.stoneRadius / 7));\n    }\n  };\n\n  var default_field_clear = function default_field_clear(args, board) {\n    var xr = board.getX(args.x),\n        yr = board.getY(args.y),\n        sr = board.stoneRadius;\n    this.clearRect(xr - 2 * sr - board.ls, yr - 2 * sr - board.ls, 4 * sr, 4 * sr);\n  }; // Private methods of WGo.Board\n\n\n  var calcLeftMargin = function calcLeftMargin() {\n    return 3 * this.width / (4 * (this.bx + 1 - this.tx) + 2) - this.fieldWidth * this.tx;\n  };\n\n  var calcTopMargin = function calcTopMargin() {\n    return 3 * this.height / (4 * (this.by + 1 - this.ty) + 2) - this.fieldHeight * this.ty;\n  };\n\n  var calcFieldWidth = function calcFieldWidth() {\n    return 4 * this.width / (4 * (this.bx + 1 - this.tx) + 2);\n  };\n\n  var calcFieldHeight = function calcFieldHeight() {\n    return 4 * this.height / (4 * (this.by + 1 - this.ty) + 2);\n  };\n\n  var clearField = function clearField(x, y) {\n    var handler;\n\n    for (var z = 0; z < this.obj_arr[x][y].length; z++) {\n      var obj = this.obj_arr[x][y][z];\n      if (!obj.type) handler = this.stoneHandler;else if (typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];else handler = obj.type;\n\n      for (var layer in handler) {\n        if (handler[layer].clear) handler[layer].clear.call(this[layer].getContext(obj), obj, this);else default_field_clear.call(this[layer].getContext(obj), obj, this);\n      }\n    }\n  };\n\n  var drawField = function drawField(x, y) {\n    var handler;\n\n    for (var z = 0; z < this.obj_arr[x][y].length; z++) {\n      var obj = this.obj_arr[x][y][z];\n      if (!obj.type) handler = this.stoneHandler;else if (typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];else handler = obj.type;\n\n      for (var layer in handler) {\n        handler[layer].draw.call(this[layer].getContext(obj), obj, this);\n      }\n    }\n  };\n\n  var getMousePos = function getMousePos(e) {\n    // new hopefully better translation of coordinates\n    var x, y;\n    x = e.offsetX * this.pixelRatio;\n    x -= this.left;\n    x /= this.fieldWidth;\n    x = Math.round(x);\n    y = e.offsetY * this.pixelRatio;\n    y -= this.top;\n    y /= this.fieldHeight;\n    y = Math.round(y);\n    return {\n      x: x >= this.size ? -1 : x,\n      y: y >= this.size ? -1 : y\n    };\n  };\n\n  var updateDim = function updateDim() {\n    this.element.style.width = this.width / this.pixelRatio + \"px\";\n    this.element.style.height = this.height / this.pixelRatio + \"px\";\n    this.stoneRadius = theme_variable(\"stoneSize\", this); //if(this.autoLineWidth) this.lineWidth = this.stoneRadius/7; //< 15 ? 1 : 3;\n\n    this.ls = theme_variable(\"linesShift\", this);\n\n    for (var i = 0; i < this.layers.length; i++) {\n      this.layers[i].setDimensions(this.width, this.height);\n    }\n  }; // Public methods are in the prototype:\n\n\n  Board.prototype = {\n    constructor: Board,\n\n    /**\n        * Initialization method, it is called in constructor. You shouldn't call it, but you can alter it.\n     */\n    init: function init() {\n      // placement of objects (in 3D array)\n      this.obj_arr = [];\n\n      for (var i = 0; i < this.size; i++) {\n        this.obj_arr[i] = [];\n\n        for (var j = 0; j < this.size; j++) {\n          this.obj_arr[i][j] = [];\n        }\n      } // other objects, stored in list\n\n\n      this.obj_list = []; // layers\n\n      this.layers = []; // event listeners, binded to board\n\n      this.listeners = [];\n      this.element = document.createElement('div');\n      this.element.className = 'wgo-board';\n      this.element.style.position = 'relative';\n\n      if (this.background) {\n        if (this.background[0] == \"#\") this.element.style.backgroundColor = this.background;else {\n          this.element.style.backgroundImage = \"url('\" + this.background + \"')\";\n          /*this.element.style.backgroundRepeat = \"repeat\";*/\n\n          if (this.stoneHandler == Board.drawHandlers.REALISTIC) {\n            // The photographed wood images do not repeat and are the size of an actual\n            // Go-Board. Therefore scale to fit.\n            this.element.style.backgroundSize = \"100%\";\n          }\n        }\n      }\n\n      this.grid = new Board.GridLayer();\n      this.shadow = new Board.ShadowLayer(this, theme_variable(\"shadowSize\", this));\n      this.stone = new Board.MultipleCanvasLayer();\n      this.addLayer(this.grid, 100);\n      this.addLayer(this.shadow, 200);\n      this.addLayer(this.stone, 300);\n    },\n\n    /**\n     * Set new width of board, height is computed to keep aspect ratio.\n     *\n     * @param {number} width\n     */\n    setWidth: function setWidth(width) {\n      this.width = width;\n      this.width *= this.pixelRatio;\n      this.fieldHeight = this.fieldWidth = calcFieldWidth.call(this);\n      this.left = calcLeftMargin.call(this);\n      this.height = (this.by - this.ty + 1.5) * this.fieldHeight;\n      this.top = calcTopMargin.call(this);\n      updateDim.call(this);\n      this.redraw();\n    },\n\n    /**\n     * Set new height of board, width is computed to keep aspect ratio.\n     *\n     * @param {number} height\n     */\n    setHeight: function setHeight(height) {\n      this.height = height;\n      this.height *= this.pixelRatio;\n      this.fieldWidth = this.fieldHeight = calcFieldHeight.call(this);\n      this.top = calcTopMargin.call(this);\n      this.width = (this.bx - this.tx + 1.5) * this.fieldWidth;\n      this.left = calcLeftMargin.call(this);\n      updateDim.call(this);\n      this.redraw();\n    },\n\n    /**\n     * Set both dimensions.\n     *\n     * @param {number} width\n     * @param {number} height\n     */\n    setDimensions: function setDimensions(width, height) {\n      this.width = width || _parseInt(this.element.style.width, 10);\n      this.width *= this.pixelRatio;\n      this.height = height || _parseInt(this.element.style.height, 10);\n      this.height *= this.pixelRatio;\n      this.fieldWidth = calcFieldWidth.call(this);\n      this.fieldHeight = calcFieldHeight.call(this);\n      this.left = calcLeftMargin.call(this);\n      this.top = calcTopMargin.call(this);\n      updateDim.call(this);\n      this.redraw();\n    },\n\n    /**\n     * Get currently visible section of the board\n     */\n    getSection: function getSection() {\n      return this.section;\n    },\n\n    /**\n     * Set section of the board to be displayed\n     */\n    setSection: function setSection(section_or_top, right, bottom, left) {\n      if (_typeof(section_or_top) == \"object\") {\n        this.section = section_or_top;\n      } else {\n        this.section = {\n          top: section_or_top,\n          right: right,\n          bottom: bottom,\n          left: left\n        };\n      }\n\n      this.tx = this.section.left;\n      this.ty = this.section.top;\n      this.bx = this.size - 1 - this.section.right;\n      this.by = this.size - 1 - this.section.bottom;\n      this.setDimensions();\n    },\n\n    /**\n     * Set board size (eg: 9, 13 or 19), this will clear board's objects.\n     */\n    setSize: function setSize(size) {\n      var size = size || 19;\n\n      if (size != this.size) {\n        this.size = size;\n        this.obj_arr = [];\n\n        for (var i = 0; i < this.size; i++) {\n          this.obj_arr[i] = [];\n\n          for (var j = 0; j < this.size; j++) {\n            this.obj_arr[i][j] = [];\n          }\n        }\n\n        this.bx = this.size - 1 - this.section.right;\n        this.by = this.size - 1 - this.section.bottom;\n        this.setDimensions();\n      }\n    },\n\n    /**\n     * Redraw everything.\n     */\n    redraw: function redraw() {\n      try {\n        // redraw layers\n        for (var i = 0; i < this.layers.length; i++) {\n          this.layers[i].clear(this);\n          this.layers[i].draw(this);\n        } // redraw field objects\n\n\n        for (var i = 0; i < this.size; i++) {\n          for (var j = 0; j < this.size; j++) {\n            drawField.call(this, i, j);\n          }\n        } // redraw custom objects\n\n\n        for (var i = 0; i < this.obj_list.length; i++) {\n          var obj = this.obj_list[i];\n          var handler = obj.handler;\n\n          for (var layer in handler) {\n            handler[layer].draw.call(this[layer].getContext(obj.args), obj.args, this);\n          }\n        }\n      } catch (err) {\n        // If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n        console.log(\"WGo board failed to render. Error: \" + err.message);\n      }\n    },\n\n    /**\n     * Get absolute X coordinate\n     *\n     * @param {number} x relative coordinate\n     */\n    getX: function getX(x) {\n      return this.left + x * this.fieldWidth;\n    },\n\n    /**\n     * Get absolute Y coordinate\n     *\n     * @param {number} y relative coordinate\n     */\n    getY: function getY(y) {\n      return this.top + y * this.fieldHeight;\n    },\n\n    /**\n     * Add layer to the board. It is meant to be only for canvas layers.\n     *\n     * @param {Board.CanvasLayer} layer to add\n     * @param {number} weight layer with biggest weight is on the top\n     */\n    addLayer: function addLayer(layer, weight) {\n      layer.appendTo(this.element, weight);\n      layer.setDimensions(this.width, this.height);\n      this.layers.push(layer);\n    },\n\n    /**\n     * Remove layer from the board.\n     *\n     * @param {Board.CanvasLayer} layer to remove\n     */\n    removeLayer: function removeLayer(layer) {\n      var i = this.layers.indexOf(layer);\n\n      if (i >= 0) {\n        this.layers.splice(i, 1);\n        layer.removeFrom(this.element);\n      }\n    },\n    update: function update(changes) {\n      var i;\n      if (changes.remove && changes.remove == \"all\") this.removeAllObjects();else if (changes.remove) {\n        for (i = 0; i < changes.remove.length; i++) {\n          this.removeObject(changes.remove[i]);\n        }\n      }\n\n      if (changes.add) {\n        for (i = 0; i < changes.add.length; i++) {\n          this.addObject(changes.add[i]);\n        }\n      }\n    },\n    addObject: function addObject(obj) {\n      // handling multiple objects\n      if (obj.constructor == Array) {\n        for (var i = 0; i < obj.length; i++) {\n          this.addObject(obj[i]);\n        }\n\n        return;\n      }\n\n      try {\n        // clear all objects on object's coordinates\n        clearField.call(this, obj.x, obj.y); // if object of this type is on the board, replace it\n\n        var layers = this.obj_arr[obj.x][obj.y];\n\n        for (var z = 0; z < layers.length; z++) {\n          if (layers[z].type == obj.type) {\n            layers[z] = obj;\n            drawField.call(this, obj.x, obj.y);\n            return;\n          }\n        } // if object is a stone, add it at the beginning, otherwise at the end\n\n\n        if (!obj.type) layers.unshift(obj);else layers.push(obj); // draw all objects\n\n        drawField.call(this, obj.x, obj.y);\n      } catch (err) {\n        // If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n        console.log(\"WGo board failed to render. Error: \" + err.message);\n      }\n    },\n    removeObject: function removeObject(obj) {\n      // handling multiple objects\n      if (obj.constructor == Array) {\n        for (var n = 0; n < obj.length; n++) {\n          this.removeObject(obj[n]);\n        }\n\n        return;\n      }\n\n      try {\n        var i;\n\n        for (var j = 0; j < this.obj_arr[obj.x][obj.y].length; j++) {\n          if (this.obj_arr[obj.x][obj.y][j].type == obj.type) {\n            i = j;\n            break;\n          }\n        }\n\n        if (i === undefined) return; // clear all objects on object's coordinates\n\n        clearField.call(this, obj.x, obj.y);\n        this.obj_arr[obj.x][obj.y].splice(i, 1);\n        drawField.call(this, obj.x, obj.y);\n      } catch (err) {\n        // If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n        console.log(\"WGo board failed to render. Error: \" + err.message);\n      }\n    },\n    removeObjectsAt: function removeObjectsAt(x, y) {\n      if (!this.obj_arr[x][y].length) return;\n      clearField.call(this, x, y);\n      this.obj_arr[x][y] = [];\n    },\n    removeAllObjects: function removeAllObjects() {\n      this.obj_arr = [];\n\n      for (var i = 0; i < this.size; i++) {\n        this.obj_arr[i] = [];\n\n        for (var j = 0; j < this.size; j++) {\n          this.obj_arr[i][j] = [];\n        }\n      }\n\n      this.redraw();\n    },\n    addCustomObject: function addCustomObject(handler, args) {\n      this.obj_list.push({\n        handler: handler,\n        args: args\n      });\n      this.redraw();\n    },\n    removeCustomObject: function removeCustomObject(handler, args) {\n      for (var i = 0; i < this.obj_list.length; i++) {\n        var obj = this.obj_list[i];\n\n        if (obj.handler == handler && obj.args == args) {\n          this.obj_list.splice(i, 1);\n          this.redraw();\n          return true;\n        }\n      }\n\n      return false;\n    },\n    addEventListener: function addEventListener(type, callback) {\n      var _this = this,\n          evListener = {\n        type: type,\n        callback: callback,\n        handleEvent: function handleEvent(e) {\n          var coo = getMousePos.call(_this, e);\n          callback(coo.x, coo.y, e);\n        }\n      };\n\n      this.element.addEventListener(type, evListener, true);\n      this.listeners.push(evListener);\n    },\n    removeEventListener: function removeEventListener(type, callback) {\n      for (var i = 0; i < this.listeners.length; i++) {\n        var listener = this.listeners[i];\n\n        if (listener.type == type && listener.callback == callback) {\n          this.element.removeEventListener(listener.type, listener, true);\n          this.listeners.splice(i, 1);\n          return true;\n        }\n      }\n\n      return false;\n    },\n    getState: function getState() {\n      return {\n        objects: WGo.clone(this.obj_arr),\n        custom: WGo.clone(this.obj_list)\n      };\n    },\n    restoreState: function restoreState(state) {\n      this.obj_arr = state.objects || this.obj_arr;\n      this.obj_list = state.custom || this.obj_list;\n      this.redraw();\n    }\n  };\n  Board.default = {\n    size: 19,\n    width: 0,\n    height: 0,\n    font: \"Calibri\",\n    // deprecated\n    lineWidth: 1,\n    // deprecated\n    autoLineWidth: false,\n    // deprecated\n    starPoints: {\n      5: [{\n        x: 2,\n        y: 2\n      }],\n      7: [{\n        x: 3,\n        y: 3\n      }],\n      8: [{\n        x: 2,\n        y: 2\n      }, {\n        x: 5,\n        y: 2\n      }, {\n        x: 2,\n        y: 5\n      }, {\n        x: 5,\n        y: 5\n      }],\n      9: [{\n        x: 2,\n        y: 2\n      }, {\n        x: 6,\n        y: 2\n      }, {\n        x: 4,\n        y: 4\n      }, {\n        x: 2,\n        y: 6\n      }, {\n        x: 6,\n        y: 6\n      }],\n      10: [{\n        x: 2,\n        y: 2\n      }, {\n        x: 7,\n        y: 2\n      }, {\n        x: 2,\n        y: 7\n      }, {\n        x: 7,\n        y: 7\n      }],\n      11: [{\n        x: 2,\n        y: 2\n      }, {\n        x: 8,\n        y: 2\n      }, {\n        x: 5,\n        y: 5\n      }, {\n        x: 2,\n        y: 8\n      }, {\n        x: 8,\n        y: 8\n      }],\n      12: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 8,\n        y: 3\n      }, {\n        x: 3,\n        y: 8\n      }, {\n        x: 8,\n        y: 8\n      }],\n      13: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 9,\n        y: 3\n      }, {\n        x: 6,\n        y: 6\n      }, {\n        x: 3,\n        y: 9\n      }, {\n        x: 9,\n        y: 9\n      }],\n      14: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 10,\n        y: 3\n      }, {\n        x: 3,\n        y: 10\n      }, {\n        x: 10,\n        y: 10\n      }],\n      15: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 11,\n        y: 3\n      }, {\n        x: 7,\n        y: 7\n      }, {\n        x: 3,\n        y: 11\n      }, {\n        x: 11,\n        y: 11\n      }],\n      16: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 12,\n        y: 3\n      }, {\n        x: 3,\n        y: 12\n      }, {\n        x: 12,\n        y: 12\n      }],\n      17: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 8,\n        y: 3\n      }, {\n        x: 13,\n        y: 3\n      }, {\n        x: 3,\n        y: 8\n      }, {\n        x: 8,\n        y: 8\n      }, {\n        x: 13,\n        y: 8\n      }, {\n        x: 3,\n        y: 13\n      }, {\n        x: 8,\n        y: 13\n      }, {\n        x: 13,\n        y: 13\n      }],\n      18: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 14,\n        y: 3\n      }, {\n        x: 3,\n        y: 14\n      }, {\n        x: 14,\n        y: 14\n      }],\n      19: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 9,\n        y: 3\n      }, {\n        x: 15,\n        y: 3\n      }, {\n        x: 3,\n        y: 9\n      }, {\n        x: 9,\n        y: 9\n      }, {\n        x: 15,\n        y: 9\n      }, {\n        x: 3,\n        y: 15\n      }, {\n        x: 9,\n        y: 15\n      }, {\n        x: 15,\n        y: 15\n      }],\n      20: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 16,\n        y: 3\n      }, {\n        x: 3,\n        y: 16\n      }, {\n        x: 16,\n        y: 16\n      }],\n      21: [{\n        x: 3,\n        y: 3\n      }, {\n        x: 10,\n        y: 3\n      }, {\n        x: 17,\n        y: 3\n      }, {\n        x: 3,\n        y: 10\n      }, {\n        x: 10,\n        y: 10\n      }, {\n        x: 17,\n        y: 10\n      }, {\n        x: 3,\n        y: 17\n      }, {\n        x: 10,\n        y: 17\n      }, {\n        x: 17,\n        y: 17\n      }]\n    },\n    //stoneHandler: Board.drawHandlers.SHELL,\n    stoneHandler: Board.drawHandlers.REALISTIC,\n    // New photograph based stones\n    starSize: 1,\n    // deprecated\n    shadowSize: 1,\n    // deprecated\n    stoneSize: 1,\n    // deprecated\n    section: {\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0\n    },\n    //background: WGo.DIR+\"wood1.jpg\",    // Original version, tileing\n    //background: WGo.DIR+\"wood_512.jpg\", // Mobile friendly, low resolution\n    background: WGo.DIR + \"wood_1024.jpg\",\n    // High resolution version, use with REALISTIC handler\n    //whiteStoneGraphic: [ WGo.DIR+\"white_128.png\" ], // Single image only, hires\n    //blackStoneGraphic: [ WGo.DIR+\"black_128.png\" ], // Single image only, hires\n    //whiteStoneGraphic: [ WGo.DIR+\"white_64.png\" ], // Single image only, lowres\n    //blackStoneGraphic: [ WGo.DIR+\"black_64.png\" ], // Single image only, lowres\n    whiteStoneGraphic: [WGo.DIR + \"stones/white00_128.png\", WGo.DIR + \"stones/white01_128.png\", WGo.DIR + \"stones/white02_128.png\", WGo.DIR + \"stones/white03_128.png\", WGo.DIR + \"stones/white04_128.png\", WGo.DIR + \"stones/white05_128.png\", WGo.DIR + \"stones/white06_128.png\", WGo.DIR + \"stones/white07_128.png\", WGo.DIR + \"stones/white08_128.png\", WGo.DIR + \"stones/white09_128.png\", WGo.DIR + \"stones/white10_128.png\"],\n    blackStoneGraphic: [WGo.DIR + \"stones/black00_128.png\", WGo.DIR + \"stones/black01_128.png\", WGo.DIR + \"stones/black02_128.png\", WGo.DIR + \"stones/black03_128.png\"],\n    theme: {} // save Board\n\n  };\n  WGo.Board = Board; //-------- WGo.Game ---------------------------------------------------------------------------\n\n  /**\n   * Creates instance of position object.\n   *\n   * @class\n   * <p>WGo.Position is simple object storing position of go game. It is implemented as matrix <em>size</em> x <em>size</em> with values WGo.BLACK, WGo.WHITE or 0. It can be used by any extension.</p>\n   *\n   * @param {number} size of the board\n   */\n\n  var Position = function Position(size) {\n    this.size = size || 19;\n    this.schema = [];\n\n    for (var i = 0; i < this.size * this.size; i++) {\n      this.schema[i] = 0;\n    }\n  };\n\n  Position.prototype = {\n    constructor: WGo.Position,\n\n    /**\n     * Returns value of given coordinates.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @return {(WGo.BLACK|WGo.WHITE|0)} color\n     */\n    get: function get(x, y) {\n      if (x < 0 || y < 0 || x >= this.size || y >= this.size) return undefined;\n      return this.schema[x * this.size + y];\n    },\n\n    /**\n     * Sets value of given coordinates.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W|0)} c color\n     */\n    set: function set(x, y, c) {\n      this.schema[x * this.size + y] = c;\n      return this;\n    },\n\n    /**\n     * Clears the whole position (every value is set to 0).\n     */\n    clear: function clear() {\n      for (var i = 0; i < this.size * this.size; i++) {\n        this.schema[i] = 0;\n      }\n\n      return this;\n    },\n\n    /**\n     * Clones the whole position.\n     *\n     * @return {WGo.Position} copy of position\n     */\n    clone: function clone() {\n      var clone = new Position(this.size);\n      clone.schema = this.schema.slice(0);\n      return clone;\n    },\n\n    /**\n     * Compares this position with another position and return change object\n     *\n     * @param {WGo.Position} position to compare to.\n     * @return {object} change object with structure: {add:[], remove:[]}\n     */\n    compare: function compare(position) {\n      var add = [],\n          remove = [];\n\n      for (var i = 0; i < this.size * this.size; i++) {\n        if (this.schema[i] && !position.schema[i]) remove.push({\n          x: Math.floor(i / this.size),\n          y: i % this.size\n        });else if (this.schema[i] != position.schema[i]) add.push({\n          x: Math.floor(i / this.size),\n          y: i % this.size,\n          c: position.schema[i]\n        });\n      }\n\n      return {\n        add: add,\n        remove: remove\n      };\n    }\n  };\n  WGo.Position = Position;\n  /**\n   * Creates instance of game class.\n   *\n   * @class\n   * This class implements game logic. It basically analyses given moves and returns capture stones.\n   * WGo.Game also stores every position from beginning, so it has ability to check repeating positions\n   * and it can effectively restore old positions.</p>\n   *\n   * @param {number} size of the board\n   * @param {\"KO\"|\"ALL\"|\"NONE\"} checkRepeat (optional, default is \"KO\") - how to handle repeated position:\n   * KO - ko is properly handled - position cannot be same like previous position\n   * ALL - position cannot be same like any previous position - e.g. it forbids triple ko\n   * NONE - position can be repeated\n   *\n   * @param {boolean} allowRewrite (optional, default is false) - allow to play moves, which were already played:\n   * @param {boolean} allowSuicide (optional, default is false) - allow to play suicides, stones are immediately captured\n   */\n\n  var Game = function Game(size, checkRepeat, allowRewrite, allowSuicide) {\n    this.size = size || 19;\n    this.repeating = checkRepeat === undefined ? \"KO\" : checkRepeat; // possible values: KO, ALL or nothing\n\n    this.allow_rewrite = allowRewrite || false;\n    this.allow_suicide = allowSuicide || false;\n    this.stack = [];\n    this.stack[0] = new Position(this.size);\n    this.stack[0].capCount = {\n      black: 0,\n      white: 0\n    };\n    this.turn = WGo.B;\n    Object.defineProperty(this, \"position\", {\n      get: function get() {\n        return this.stack[this.stack.length - 1];\n      },\n      set: function set(pos) {\n        this.stack[this.stack.length - 1] = pos;\n      }\n    });\n  }; // function for stone capturing\n\n\n  var do_capture = function do_capture(position, captured, x, y, c) {\n    if (x >= 0 && x < position.size && y >= 0 && y < position.size && position.get(x, y) == c) {\n      position.set(x, y, 0);\n      captured.push({\n        x: x,\n        y: y\n      });\n      do_capture(position, captured, x, y - 1, c);\n      do_capture(position, captured, x, y + 1, c);\n      do_capture(position, captured, x - 1, y, c);\n      do_capture(position, captured, x + 1, y, c);\n    }\n  }; // looking at liberties\n\n\n  var check_liberties = function check_liberties(position, testing, x, y, c) {\n    // out of the board there aren't liberties\n    if (x < 0 || x >= position.size || y < 0 || y >= position.size) return true; // however empty field means liberty\n\n    if (position.get(x, y) == 0) return false; // already tested field or stone of enemy isn't giving us a liberty.\n\n    if (testing.get(x, y) == true || position.get(x, y) == -c) return true; // set this field as tested\n\n    testing.set(x, y, true); // in this case we are checking our stone, if we get 4 trues, it has no liberty\n\n    return check_liberties(position, testing, x, y - 1, c) && check_liberties(position, testing, x, y + 1, c) && check_liberties(position, testing, x - 1, y, c) && check_liberties(position, testing, x + 1, y, c);\n  }; // analysing function - modifies original position, if there are some capturing, and returns array of captured stones\n\n\n  var check_capturing = function check_capturing(position, x, y, c) {\n    var captured = []; // is there a stone possible to capture?\n\n    if (x >= 0 && x < position.size && y >= 0 && y < position.size && position.get(x, y) == c) {\n      // create testing map\n      var testing = new Position(position.size); // if it has zero liberties capture it\n\n      if (check_liberties(position, testing, x, y, c)) {\n        // capture stones from game\n        do_capture(position, captured, x, y, c);\n      }\n    }\n\n    return captured;\n  }; // analysing history\n\n\n  var checkHistory = function checkHistory(position, x, y) {\n    var flag, stop;\n    if (this.repeating == \"KO\" && this.stack.length - 2 >= 0) stop = this.stack.length - 2;else if (this.repeating == \"ALL\") stop = 0;else return true;\n\n    for (var i = this.stack.length - 2; i >= stop; i--) {\n      if (this.stack[i].get(x, y) == position.get(x, y)) {\n        flag = true;\n\n        for (var j = 0; j < this.size * this.size; j++) {\n          if (this.stack[i].schema[j] != position.schema[j]) {\n            flag = false;\n            break;\n          }\n        }\n\n        if (flag) return false;\n      }\n    }\n\n    return true;\n  };\n\n  Game.prototype = {\n    constructor: Game,\n\n    /**\n     * Gets actual position.\n     *\n     * @return {WGo.Position} actual position\n     */\n    getPosition: function getPosition() {\n      return this.stack[this.stack.length - 1];\n    },\n\n    /**\n     * Play move.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W)} c color\n     * @param {boolean} noplay - if true, move isn't played. Used by WGo.Game.isValid.\n     * @return {number} code of error, if move isn't valid. If it is valid, function returns array of captured stones.\n     *\n     * Error codes:\n     * 1 - given coordinates are not on board\n     * 2 - on given coordinates already is a stone\n     * 3 - suicide (currently they are forbbiden)\n     * 4 - repeated position\n     */\n    play: function play(x, y, c, noplay) {\n      //check coordinates validity\n      if (!this.isOnBoard(x, y)) return 1;\n      if (!this.allow_rewrite && this.position.get(x, y) != 0) return 2; // clone position\n\n      if (!c) c = this.turn;\n      var new_pos = this.position.clone();\n      new_pos.set(x, y, c); // check capturing\n\n      var cap_color = c;\n      var captured = check_capturing(new_pos, x - 1, y, -c).concat(check_capturing(new_pos, x + 1, y, -c), check_capturing(new_pos, x, y - 1, -c), check_capturing(new_pos, x, y + 1, -c));\n      console.log(captured); // check suicide\n\n      if (!captured.length) {\n        var testing = new Position(this.size);\n\n        if (check_liberties(new_pos, testing, x, y, c)) {\n          if (this.allow_suicide) {\n            cap_color = -c;\n            do_capture(new_pos, captured, x, y, c);\n          } else return 3;\n        }\n      } // check history\n\n\n      if (this.repeating && !checkHistory.call(this, new_pos, x, y)) {\n        return 4;\n      }\n\n      if (noplay) return false; // update position info\n\n      new_pos.color = c;\n      new_pos.capCount = {\n        black: this.position.capCount.black,\n        white: this.position.capCount.white\n      };\n      if (cap_color == WGo.B) new_pos.capCount.black += captured.length;else new_pos.capCount.white += captured.length; // save position\n\n      this.pushPosition(new_pos); // reverse turn\n\n      this.turn = -c;\n      return captured;\n    },\n\n    /**\n     * Play pass.\n     *\n     * @param {(WGo.B|WGo.W)} c color\n     */\n    pass: function pass(c) {\n      this.pushPosition();\n\n      if (c) {\n        this.position.color = c;\n        this.turn = -c;\n      } else {\n        this.position.color = this.turn;\n        this.turn = -this.turn;\n      }\n    },\n\n    /**\n     * Finds out validity of the move.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W)} c color\n     * @return {boolean} true if move can be played.\n     */\n    isValid: function isValid(x, y, c) {\n      return typeof this.play(x, y, c, true) != \"number\";\n    },\n\n    /**\n     * Controls position of the move.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @return {boolean} true if move is on board.\n     */\n    isOnBoard: function isOnBoard(x, y) {\n      return x >= 0 && y >= 0 && x < this.size && y < this.size;\n    },\n\n    /**\n     * Inserts move into current position. Use for setting position, for example in handicap game. Field must be empty.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W)} c color\n     * @return {boolean} true if operation is successfull.\n     */\n    addStone: function addStone(x, y, c) {\n      if (this.isOnBoard(x, y) && this.position.get(x, y) == 0) {\n        this.position.set(x, y, c || 0);\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Removes move from current position.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @return {boolean} true if operation is successfull.\n     */\n    removeStone: function removeStone(x, y) {\n      if (this.isOnBoard(x, y) && this.position.get(x, y) != 0) {\n        this.position.set(x, y, 0);\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Set or insert move of current position.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @param {(WGo.B|WGo.W)} c color\n     * @return {boolean} true if operation is successfull.\n     */\n    setStone: function setStone(x, y, c) {\n      if (this.isOnBoard(x, y)) {\n        this.position.set(x, y, c || 0);\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Get stone on given position.\n     *\n     * @param {number} x coordinate\n     * @param {number} y coordinate\n     * @return {(WGo.B|WGo.W|0)} color\n     */\n    getStone: function getStone(x, y) {\n      if (this.isOnBoard(x, y)) {\n        return this.position.get(x, y);\n      }\n\n      return 0;\n    },\n\n    /**\n     * Add position to stack. If position isn't specified current position is cloned and stacked.\n     * Pointer of actual position is moved to the new position.\n     *\n     * @param {WGo.Position} tmp position (optional)\n     */\n    pushPosition: function pushPosition(pos) {\n      if (!pos) {\n        var pos = this.position.clone();\n        pos.capCount = {\n          black: this.position.capCount.black,\n          white: this.position.capCount.white\n        };\n        pos.color = this.position.color;\n      }\n\n      this.stack.push(pos);\n      if (pos.color) this.turn = -pos.color;\n      return this;\n    },\n\n    /**\n     * Remove current position from stack. Pointer of actual position is moved to the previous position.\n     */\n    popPosition: function popPosition() {\n      var old = null;\n\n      if (this.stack.length > 0) {\n        old = this.stack.pop();\n        if (this.stack.length == 0) this.turn = WGo.B;else if (this.position.color) this.turn = -this.position.color;else this.turn = -this.turn;\n      }\n\n      return old;\n    },\n\n    /**\n     * Removes all positions.\n     */\n    firstPosition: function firstPosition() {\n      this.stack = [];\n      this.stack[0] = new Position(this.size);\n      this.stack[0].capCount = {\n        black: 0,\n        white: 0\n      };\n      this.turn = WGo.B;\n      return this;\n    },\n\n    /**\n     * Gets count of captured stones.\n     *\n     * @param {(WGo.BLACK|WGo.WHITE)} color\n     * @return {number} count\n     */\n    getCaptureCount: function getCaptureCount(color) {\n      return color == WGo.B ? this.position.capCount.black : this.position.capCount.white;\n    },\n\n    /**\n     * Validate postion. Position is tested from 0:0 to size:size, if there are some moves, that should be captured, they will be removed.\n     * You can use this, after insertion of more stones.\n     *\n     * @return array removed stones\n     */\n    validatePosition: function validatePosition() {\n      var c,\n          p,\n          white = 0,\n          black = 0,\n          captured = [],\n          new_pos = this.position.clone();\n\n      for (var x = 0; x < this.size; x++) {\n        for (var y = 0; y < this.size; y++) {\n          c = this.position.get(x, y);\n\n          if (c) {\n            p = captured.length;\n            captured = captured.concat(check_capturing(new_pos, x - 1, y, -c), check_capturing(new_pos, x + 1, y, -c), check_capturing(new_pos, x, y - 1, -c), check_capturing(new_pos, x, y + 1, -c));\n            if (c == WGo.B) black += captured - p;else white += captured - p;\n          }\n        }\n      }\n\n      this.position.capCount.black += black;\n      this.position.capCount.white += white;\n      this.position.schema = new_pos.schema;\n      return captured;\n    }\n  }; // save Game\n\n  WGo.Game = Game; // register WGo\n\n  window.WGo = WGo;\n})(window);",{"version":3,"sources":["/Users/linchengxun/Desktop/vuego-testfunc/wgo.js-master/wgo/wgo.js"],"names":["window","undefined","scripts","document","getElementsByTagName","path","length","src","split","mydir","slice","join","WGo","version","B","W","ERROR_REPORT","DIR","lang","i18n","en","opera","navigator","userAgent","search","webkit","msie","mozilla","t","str","loc","i","arguments","replace","extendClass","parent","child","prototype","constructor","super","abstractMethod","Error","clone","obj","n_obj","Array","key","filterHTML","text","Board","elem","config","default","themes","theme","tx","section","left","ty","top","bx","size","right","by","bottom","init","appendChild","element","pixelRatio","devicePixelRatio","width","height","setDimensions","setWidth","setHeight","old","shadowColor","shadowTransparentColor","shadowBlur","shadowSize","board","markupBlackColor","markupWhiteColor","markupNoneColor","markupLinesWidth","autoLineWidth","stoneRadius","lineWidth","gridLinesWidth","gridLinesColor","Math","min","starColor","starSize","stoneSize","fieldWidth","fieldHeight","coordinatesColor","font","linesShift","variationColor","theme_variable","shadow_handler","draw","args","xr","getX","x","yr","getY","y","sr","beginPath","blur","radius","max","gradient","createRadialGradient","ls","addColorStop","fillStyle","arc","PI","fill","clear","clearRect","shadow_handler_realistic","lsX","lsY","get_markup_color","obj_arr","c","is_here_stone","redraw_layer","layer","handler","z","type","stoneHandler","drawHandlers","call","getContext","obj_list","shell_seed","draw_shell_line","ctx","start_angle","end_angle","factor","thickness","strokeStyle","x1","cos","y1","sin","x2","y2","m","angle","diff_x","diff_y","atan","bx1","by1","bx2","by2","moveTo","bezierCurveTo","stroke","draw_shell","arg","from_angle","to_angle","lines","NORMAL","stone","radgrad","shadow","PAINTED","REALISTIC","whiteCount","whiteStoneGraphic","blackCount","blackStoneGraphic","randIndex","ceil","random","redraw","isOkay","img","complete","naturalWidth","idx","stoneGraphic","Image","onload","drawImage","SHELL","GLOW","MONO","lw","CR","LB","round","textBaseline","textAlign","fillText","grid","_nodraw","SQ","rect","TR","lineTo","closePath","MA","lineCap","SL","SM","outline","alpha","globalAlpha","stoneStyle","mini","coordinates","ch","xright","xleft","ytop","ybottom","charCodeAt","String","fromCharCode","CanvasLayer","createElement","context","scale","style","appendTo","weight","position","zIndex","removeFrom","removeChild","GridLayer","tmp","bw","bh","strokeRect","starPoints","MultipleCanvasLayer","n","tmpContext","layers","elements","contexts","push","ShadowLayer","setTransform","default_field_clear","calcLeftMargin","calcTopMargin","calcFieldWidth","calcFieldHeight","clearField","drawField","getMousePos","e","offsetX","offsetY","updateDim","j","listeners","className","background","backgroundColor","backgroundImage","backgroundSize","addLayer","getSection","setSection","section_or_top","setSize","err","console","log","message","removeLayer","indexOf","splice","update","changes","remove","removeAllObjects","removeObject","add","addObject","unshift","removeObjectsAt","addCustomObject","removeCustomObject","addEventListener","callback","_this","evListener","handleEvent","coo","removeEventListener","listener","getState","objects","custom","restoreState","state","Position","schema","get","set","compare","floor","Game","checkRepeat","allowRewrite","allowSuicide","repeating","allow_rewrite","allow_suicide","stack","capCount","black","white","turn","Object","defineProperty","pos","do_capture","captured","check_liberties","testing","check_capturing","checkHistory","flag","stop","getPosition","play","noplay","isOnBoard","new_pos","cap_color","concat","color","pushPosition","pass","isValid","addStone","removeStone","setStone","getStone","popPosition","pop","firstPosition","getCaptureCount","validatePosition","p"],"mappings":"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","sourcesContent":["/* eslint-disable */\n/*!\n * Copyright (c) 2013 Jan Prokop\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this\n * software and associated documentation files (the \"Software\"), to deal in the Software\n * without restriction, including without limitation the rights to use, copy, modify, merge,\n * publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons\n * to whom the Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all copies or\n * substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n * BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/* WGo.js 2.3.1 */\n\n(function(window, undefined) {\n\n\"use strict\";\n\nvar scripts= document.getElementsByTagName('script');\nvar path= scripts[scripts.length-1].src.split('?')[0];      // remove any ?query\nvar mydir= path.split('/').slice(0, -1).join('/')+'/';\n\n/**\n * Main namespace - it initializes WGo in first run and then execute main function.\n * You must call WGo.init() if you want to use library, without calling WGo.\n */\n\nvar WGo = {\n\t// basic information\n\tversion: \"2.3.1\",\n\n\t// constants for colors (rather use WGo.B or WGo.W)\n\tB: 1,\n\tW: -1,\n\n\t// if true errors will be shown in dialog window, otherwise they will be ignored\n\tERROR_REPORT: true,\n\tDIR: mydir,\n\n\t// Language of player, you can change this global variable any time. Object WGo.i18n.<your lang> must exist.\n\tlang: \"en\",\n\n\t// Add terms for each language here\n\ti18n: {\n\t\ten: {}\n\t}\n}\n\n// browser detection - can be handy\nWGo.opera = navigator.userAgent.search(/(opera)(?:.*version)?[ \\/]([\\w.]+)/i) != -1;\nWGo.webkit = navigator.userAgent.search(/(webkit)[ \\/]([\\w.]+)/i) != -1;\nWGo.msie = navigator.userAgent.search(/(msie) ([\\w.]+)/i) != -1;\nWGo.mozilla = navigator.userAgent.search(/(mozilla)(?:.*? rv:([\\w.]+))?/i) != -1 && !WGo.webkit && !WGo.msie;\n\n// translating function\nWGo.t = function(str) {\n\tvar loc = WGo.i18n[WGo.lang][str] || WGo.i18n.en[str];\n\tif(loc) {\n\t\tfor(var i = 1; i < arguments.length; i++) {\n\t\t\tloc = loc.replace(\"$\", arguments[i]);\n\t\t}\n\t\treturn loc;\n\t}\n\treturn str;\n}\n\n// helping function for class inheritance\nWGo.extendClass = function(parent, child) {\n\tchild.prototype = Object.create(parent.prototype);\n\tchild.prototype.constructor = child;\n\tchild.prototype.super = parent;\n\n\treturn child;\n};\n\n// helping function for class inheritance\nWGo.abstractMethod = function() {\n\tthrow Error('unimplemented abstract method');\n};\n\n// helping function for deep cloning of simple objects,\nWGo.clone = function(obj) {\n\tif(obj && typeof obj == \"object\") {\n\t\tvar n_obj = obj.constructor == Array ? [] : {};\n\n\t\tfor(var key in obj) {\n\t\t\tif(obj[key] == obj) n_obj[key] = obj;\n\t\t\telse n_obj[key] = WGo.clone(obj[key]);\n\t\t}\n\n\t\treturn n_obj;\n\t}\n\telse return obj;\n}\n\n// filter html to avoid XSS\nWGo.filterHTML = function(text) {\n\tif(!text || typeof text != \"string\") return text;\n\treturn text.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n}\n\n//---------------------- WGo.Board -----------------------------------------------------------------------------\n\n/**\n * Board class constructor - it creates a canvas board\n *\n * @param elem DOM element to put in\n * @param config configuration object. It is object with \"key: value\" structure. Possible configurations are:\n *\n * - size: number - size of the board (default: 19)\n * - width: number - width of the board (default: 0)\n * - height: number - height of the board (default: 0)\n * - font: string - font of board writings (!deprecated)\n * - lineWidth: number - line width of board drawings (!deprecated)\n * - autoLineWidth: boolean - if set true, line width will be automatically computed accordingly to board size - this option rewrites 'lineWidth' /and it will keep markups sharp/ (!deprecated)\n * - starPoints: Object - star points coordinates, defined for various board sizes. Look at Board.default for more info.\n * - stoneHandler: Board.DrawHandler - stone drawing handler (default: Board.drawHandlers.SHELL)\n * - starSize: number - size of star points (default: 1). Radius of stars is dynamic, however you can modify it by given constant. (!deprecated)\n * - stoneSize: number - size of stone (default: 1). Radius of stone is dynamic, however you can modify it by given constant. (!deprecated)\n * - shadowSize: number - size of stone shadow (default: 1). Radius of shadow is dynamic, however you can modify it by given constant. (!deprecated)\n * - background: string - background of the board, it can be either color (#RRGGBB) or url. Empty string means no background. (default: WGo.DIR+\"wood1.jpg\")\n * - section: {\n *     top: number,\n *     right: number,\n *     bottom: number,\n *     left: number\n *   }\n *   It defines a section of board to be displayed. You can set a number of rows(or cols) to be skipped on each side.\n *   Numbers can be negative, in that case there will be more empty space. In default all values are zeros.\n * - theme: Object - theme object, which defines all graphical attributes of the board. Default theme object is \"WGo.Board.themes.default\". For old look you may use \"WGo.Board.themes.old\".\n *\n * Note: properties lineWidth, autoLineWidth, starPoints, starSize, stoneSize and shadowSize will be considered only if you set property 'theme' to 'WGo.Board.themes.old'.\n */\n\nvar Board = function(elem, config) {\n\tvar config = config || {};\n\n\t// set user configuration\n\tfor(var key in config) this[key] = config[key];\n\n\t// add default configuration\n\tfor(var key in WGo.Board.default) if(this[key] === undefined) this[key] = WGo.Board.default[key];\n\n\t// add default theme variables\n\tfor(var key in Board.themes.default) if(this.theme[key] === undefined) this.theme[key] = Board.themes.default[key];\n\n\t// set section if set\n\tthis.tx = this.section.left;\n\tthis.ty = this.section.top;\n\tthis.bx = this.size-1-this.section.right;\n\tthis.by = this.size-1-this.section.bottom;\n\n\t// init board\n\tthis.init();\n\n\t// append to element\n\telem.appendChild(this.element);\n\n\t// set initial dimensions\n\n\t// set the pixel ratio for HDPI (e.g. Retina) screens\n\tthis.pixelRatio = window.devicePixelRatio || 1;\n\n\tif(this.width && this.height) this.setDimensions(this.width, this.height);\n\telse if(this.width) this.setWidth(this.width);\n\telse if(this.height) this.setHeight(this.height);\n}\n\n// New experimental board theme system - it can be changed in future, if it will appear to be unsuitable.\nBoard.themes = {};\n\nBoard.themes.old = {\n\tshadowColor: \"rgba(32,32,32,0.5)\",\n\tshadowTransparentColor: \"rgba(32,32,32,0)\",\n\tshadowBlur: 0,\n\tshadowSize: function(board) {\n\t\treturn board.shadowSize;\n\t},\n\tmarkupBlackColor: \"rgba(255,255,255,0.8)\",\n\tmarkupWhiteColor: \"rgba(0,0,0,0.8)\",\n\tmarkupNoneColor: \"rgba(0,0,0,0.8)\",\n\tmarkupLinesWidth: function(board) {\n\t\treturn board.autoLineWidth ? board.stoneRadius/7 : board.lineWidth;\n\t},\n\tgridLinesWidth: 1,\n\tgridLinesColor: function(board) {\n\t\treturn \"rgba(0,0,0,\"+Math.min(1, board.stoneRadius/15)+\")\";\n\t},\n\tstarColor: \"#000\",\n\tstarSize: function(board) {\n\t\treturn board.starSize*((board.width/300)+1);\n\t},\n\tstoneSize: function(board) {\n\t\treturn board.stoneSize*Math.min(board.fieldWidth, board.fieldHeight)/2;\n\t},\n\tcoordinatesColor: \"rgba(0,0,0,0.7)\",\n\tfont: function(board) {\n\t\treturn board.font;\n\t},\n\tlinesShift: 0.5\n}\n\n/**\n * Object containing default graphical properties of a board.\n * A value of all properties can be even static value or function, returning final value.\n * Theme object doesn't set board and stone textures - they are set separately.\n */\n\nBoard.themes.default = {\n\tshadowColor: \"rgba(62,32,32,0.5)\",\n\tshadowTransparentColor: \"rgba(62,32,32,0)\",\n\tshadowBlur: function(board){\n\t\treturn board.stoneRadius*0.1;\n\t},\n\tshadowSize: 1,\n\tmarkupBlackColor: \"rgba(255,255,255,0.9)\",\n\tmarkupWhiteColor: \"rgba(0,0,0,0.7)\",\n\tmarkupNoneColor: \"rgba(0,0,0,0.7)\",\n\tmarkupLinesWidth: function(board) {\n\t\treturn board.stoneRadius/8;\n\t},\n\tgridLinesWidth: function(board) {\n\t\treturn board.stoneRadius/15;\n\t},\n\tgridLinesColor: \"#654525\",\n\tstarColor: \"#531\",\n\tstarSize: function(board) {\n\t\treturn (board.stoneRadius/8)+1;\n\t},\n\tstoneSize: function(board) {\n\t\treturn Math.min(board.fieldWidth, board.fieldHeight)/2;\n\t},\n\tcoordinatesColor: \"#531\",\n\tvariationColor: \"rgba(0,32,128,0.8)\",\n\tfont: \"calibri\",\n\tlinesShift: 0.25\n}\n\nvar theme_variable = function(key, board) {\n\treturn typeof board.theme[key] == \"function\" ? board.theme[key](board) : board.theme[key];\n}\n\nvar shadow_handler = {\n\tdraw: function(args, board) {\n\t\tvar xr = board.getX(args.x),\n\t\t\tyr = board.getY(args.y),\n\t\t\tsr = board.stoneRadius;\n\n\t\tthis.beginPath();\n\n\t\tvar blur = theme_variable(\"shadowBlur\", board);\n\t\tvar radius = Math.max(0, sr-0.5);\n\t\tvar gradient = this.createRadialGradient(xr-board.ls, yr-board.ls, radius-1-blur, xr-board.ls, yr-board.ls, radius+blur);\n\n\t\tgradient.addColorStop(0, theme_variable(\"shadowColor\", board));\n\t\tgradient.addColorStop(1, theme_variable(\"shadowTransparentColor\", board));\n\n\t\tthis.fillStyle = gradient;\n\n\t\tthis.arc(xr-board.ls, yr-board.ls, radius+blur, 0, 2*Math.PI, true);\n\t\tthis.fill();\n\t},\n\tclear: function(args, board) {\n\t\tvar xr = board.getX(args.x),\n\t\t\tyr = board.getY(args.y),\n\t\t\tsr = board.stoneRadius;\n\t\tthis.clearRect(xr-1.1*sr-board.ls,yr-1.1*sr-board.ls, 2.2*sr, 2.2*sr);\n\t}\n}\n\n// Shadow handler for the 'REALISITC' rendering mode\nvar shadow_handler_realistic = {\n\tdraw: function(args, board) {\n\t\tvar xr = board.getX(args.x),\n\t\t\tyr = board.getY(args.y),\n\t\t\tsr = board.stoneRadius,\n\t\t\tlsX = 1.0,\n\t\t\tlsY = -5.0,\n\t\t\tblur = 5.0;\n\n\t\tthis.beginPath();\n\n\t\tvar radius = Math.max(0, (sr-0.5)*0.85);\n\t\tvar gradient = this.createRadialGradient(xr-lsX, yr-lsY, radius-1-blur, xr-lsX, yr-lsY, radius+blur);\n\n\t\tgradient.addColorStop(0, theme_variable(\"shadowColor\", board));\n\t\tgradient.addColorStop(1, theme_variable(\"shadowTransparentColor\", board));\n\n\t\tthis.fillStyle = gradient;\n\n\t\tthis.arc(xr-lsX, yr-lsY, radius+blur, 0, 2*Math.PI, true);\n\t\tthis.fill();\n\t},\n\tclear: function(args, board) {\n\t\tvar xr = board.getX(args.x),\n\t\t\tyr = board.getY(args.y),\n\t\t\tsr = board.stoneRadius,\n\t\t\tlsX = 1.0,\n\t\t\tlsY = -5.0,\n\t\t\tblur = 5.0;\n\n\t\tthis.clearRect(xr-1.1*sr-lsX,yr-1.1*sr-lsY, 2.2*sr, 2.2*sr);\n\t}\n}\n\nvar get_markup_color = function(board, x, y) {\n\tif(board.obj_arr[x][y][0].c == WGo.B) return theme_variable(\"markupBlackColor\", board);\n\telse if(board.obj_arr[x][y][0].c == WGo.W) return theme_variable(\"markupWhiteColor\", board);\n\treturn theme_variable(\"markupNoneColor\", board);\n}\n\nvar is_here_stone = function(board, x, y) {\n\treturn (board.obj_arr[x][y][0] && board.obj_arr[x][y][0].c == WGo.W || board.obj_arr[x][y][0].c == WGo.B);\n}\n\nvar redraw_layer = function(board, layer) {\n\tvar handler;\n\n\tboard[layer].clear();\n\tboard[layer].draw(board);\n\n\tfor(var x = 0; x < board.size; x++) {\n\t\tfor(var y = 0; y < board.size; y++) {\n\t\t\tfor(var z = 0; z < board.obj_arr[x][y].length; z++) {\n\t\t\t\tvar obj = board.obj_arr[x][y][z];\n\t\t\t\tif(!obj.type) handler = board.stoneHandler;\n\t\t\t\telse if(typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];\n\t\t\t\telse handler = obj.type;\n\n\t\t\t\tif(handler[layer]) handler[layer].draw.call(board[layer].getContext(obj), obj, board);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor(var i = 0; i < board.obj_list.length; i++) {\n\t\tvar obj = board.obj_list[i];\n\t\tvar handler = obj.handler;\n\n\t\tif(handler[layer]) handler[layer].draw.call(board[layer].getContext(obj.args), obj.args, board);\n\t}\n}\n\n// shell stone helping functions\n\nvar shell_seed;\n\nvar draw_shell_line = function(ctx, x, y, radius, start_angle, end_angle, factor, thickness) {\n\tctx.strokeStyle = \"rgba(64,64,64,0.2)\";\n\n\tctx.lineWidth = (radius/30)*thickness;\n\tctx.beginPath();\n\n\tradius -= Math.max(1, ctx.lineWidth);\n\n\tvar x1 = x + radius*Math.cos(start_angle*Math.PI);\n\tvar y1 = y + radius*Math.sin(start_angle*Math.PI);\n\tvar x2 = x + radius*Math.cos(end_angle*Math.PI);\n\tvar y2 = y + radius*Math.sin(end_angle*Math.PI);\n\n\tvar m, angle, x, diff_x, diff_y;\n\tif(x2 > x1) {\n\t\tm = (y2-y1)/(x2-x1);\n\t\tangle = Math.atan(m);\n\t}\n\telse if(x2 == x1) {\n\t\tangle = Math.PI/2;\n\t}\n\telse {\n\t\tm = (y2-y1)/(x2-x1);\n\t\tangle = Math.atan(m)-Math.PI;\n\t}\n\n\tvar c = factor*radius;\n\tdiff_x = Math.sin(angle) * c;\n\tdiff_y = Math.cos(angle) * c;\n\n\tvar bx1 = x1 + diff_x;\n\tvar by1 = y1 - diff_y;\n\n\tvar bx2 = x2 + diff_x;\n\tvar by2 = y2 - diff_y;\n\n\tctx.moveTo(x1,y1);\n\tctx.bezierCurveTo(bx1, by1, bx2, by2, x2, y2);\n\tctx.stroke();\n}\n\nvar draw_shell = function(arg) {\n\tvar from_angle = arg.angle;\n\tvar to_angle = arg.angle;\n\n\tfor(var i = 0; i < arg.lines.length; i++) {\n\t\tfrom_angle += arg.lines[i];\n\t\tto_angle -= arg.lines[i];\n\t\tdraw_shell_line(arg.ctx, arg.x, arg.y, arg.radius, from_angle, to_angle, arg.factor, arg.thickness);\n\t}\n}\n\n// drawing handlers\n\nBoard.drawHandlers = {\n\t// handler for normal stones\n\tNORMAL: {\n\t\t// draw handler for stone layer\n\t\tstone: {\n\t\t\t// drawing function - args object contain info about drawing object, board is main board object\n\t\t\t// this function is called from canvas2D context\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius,\n\t\t\t\t\tradgrad;\n\n\t\t\t\t// set stone texture\n\t\t\t\tif(args.c == WGo.W) {\n\t\t\t\t\tradgrad = this.createRadialGradient(xr-2*sr/5,yr-2*sr/5,sr/3,xr-sr/5,yr-sr/5,5*sr/5);\n\t\t\t\t\tradgrad.addColorStop(0, '#fff');\n\t\t\t\t\tradgrad.addColorStop(1, '#aaa');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tradgrad = this.createRadialGradient(xr-2*sr/5,yr-2*sr/5,1,xr-sr/5,yr-sr/5,4*sr/5);\n\t\t\t\t\tradgrad.addColorStop(0, '#666');\n\t\t\t\t\tradgrad.addColorStop(1, '#000');\n\t\t\t\t}\n\n\t\t\t\t// paint stone\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\tthis.arc(xr-board.ls, yr-board.ls, Math.max(0, sr-0.5), 0, 2*Math.PI, true);\n\t\t\t\tthis.fill();\n\t\t\t}\n\t\t},\n\t\t// adding shadow handler\n\t\tshadow: shadow_handler,\n\t},\n\n\tPAINTED: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius,\n\t\t\t\t\tradgrad;\n\n\t\t\t\tif(args.c == WGo.W) {\n\t\t\t\t\tradgrad = this.createRadialGradient(xr-2*sr/5,yr-2*sr/5,2,xr-sr/5,yr-sr/5,4*sr/5);\n\t\t\t\t\tradgrad.addColorStop(0, '#fff');\n\t\t\t\t\tradgrad.addColorStop(1, '#ddd');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tradgrad = this.createRadialGradient(xr-2*sr/5,yr-2*sr/5,1,xr-sr/5,yr-sr/5,4*sr/5);\n\t\t\t\t\tradgrad.addColorStop(0, '#111');\n\t\t\t\t\tradgrad.addColorStop(1, '#000');\n\t\t\t\t}\n\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\tthis.arc(xr-board.ls, yr-board.ls, Math.max(0, sr-0.5), 0, 2*Math.PI, true);\n\t\t\t\tthis.fill();\n\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.lineWidth = sr/6;\n\n\t\t\t\tif(args.c == WGo.W) {\n\t\t\t\t\tthis.strokeStyle = '#999';\n\t\t\t\t\tthis.arc(xr+sr/8, yr+sr/8, sr/2, 0, Math.PI/2, false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.strokeStyle = '#ccc';\n\t\t\t\t\tthis.arc(xr-sr/8, yr-sr/8, sr/2, Math.PI, 1.5*Math.PI);\n\t\t\t\t}\n\n\t\t\t\tthis.stroke();\n\t\t\t}\n\t\t},\n\t\tshadow: shadow_handler,\n\t},\n\n\t// handler for image based stones\n\tREALISTIC: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\tvar whiteCount = board.whiteStoneGraphic.length;\n\t\t\t\tvar blackCount = board.blackStoneGraphic.length;\n\n\t\t\t\tif(typeof this.randIndex === 'undefined') {\n\t\t\t\t\tthis.randIndex = Math.ceil(Math.random()*1e5);\n\t\t\t\t}\n\n\t\t\t\tvar redraw = function() {\n\t\t\t\t\tboard.redraw();\n\t\t\t\t};\n\n\t\t\t\t// Check if image has been loaded properly\n\t\t\t\t// see https://stereochro.me/ideas/detecting-broken-images-js\n\t\t\t\tvar isOkay = function(img) {\n\t\t\t\t\tif (typeof img === 'string') { return false; }\n\t \t\t\t\tif (!img.complete) { return false; }\n\t\t\t\t\tif (typeof img.naturalWidth != \"undefined\" && img.naturalWidth == 0) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t\tif(args.c == WGo.W) {\n\t\t\t\t\tvar idx = this.randIndex % whiteCount;\n\t\t\t\t\tif(typeof board.whiteStoneGraphic[idx] === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\t// The image has not been loaded yet\n\t\t\t\t\t\tvar stoneGraphic = new Image();\n\t\t\t\t\t\t// Redraw the whole board after the image has been loaded.\n\t\t\t\t\t\t// This prevents 'missing stones' and similar graphical errors\n\t\t\t\t\t\t// especially on slower internet connections.\n\t\t\t\t\t  stoneGraphic.onload = redraw;\n\t\t\t\t\t\tstoneGraphic.src = board.whiteStoneGraphic[idx];\n\t\t\t\t\t\tboard.whiteStoneGraphic[idx] = stoneGraphic;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(isOkay(board.whiteStoneGraphic[idx])) {\n\t\t\t\t\t\tthis.drawImage(board.whiteStoneGraphic[idx], xr - sr, yr - sr, 2*sr, 2*sr);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Fall back to SHELL handler if there was a problem loading the image\n\t\t\t\t\t\tBoard.drawHandlers.SHELL.stone.draw.call(this, args, board);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse { // args.c == WGo.B\n\t\t\t\t\tvar idx = this.randIndex % blackCount;\n\t\t\t\t\tif(typeof board.blackStoneGraphic[idx] === 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar stoneGraphic = new Image();\n\t\t\t\t\t  stoneGraphic.onload = redraw;\n\t\t\t\t\t\tstoneGraphic.src = board.blackStoneGraphic[idx];\n\t\t\t\t\t\tboard.blackStoneGraphic[idx] = stoneGraphic;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(isOkay(board.blackStoneGraphic[idx])) {\n\t\t\t\t\t\tthis.drawImage(board.blackStoneGraphic[idx], xr - sr, yr - sr, 2*sr, 2*sr);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tBoard.drawHandlers.SHELL.stone.draw.call(this, args, board);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tshadow: shadow_handler_realistic,\n\t},\n\n\tGLOW: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\tvar radgrad;\n\t\t\t\tif(args.c == WGo.W) {\n\t\t\t\t\tradgrad = this.createRadialGradient(xr-2*sr/5,yr-2*sr/5,sr/3,xr-sr/5,yr-sr/5,8*sr/5);\n\t\t\t\t\tradgrad.addColorStop(0, '#fff');\n\t\t\t\t\tradgrad.addColorStop(1, '#666');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tradgrad = this.createRadialGradient(xr-2*sr/5,yr-2*sr/5,1,xr-sr/5,yr-sr/5,3*sr/5);\n\t\t\t\t\tradgrad.addColorStop(0, '#555');\n\t\t\t\t\tradgrad.addColorStop(1, '#000');\n\t\t\t\t}\n\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\tthis.arc(xr-board.ls, yr-board.ls, Math.max(0, sr-0.5), 0, 2*Math.PI, true);\n\t\t\t\tthis.fill();\n\t\t\t},\n\t\t},\n\t\tshadow: shadow_handler,\n\t},\n\n\tSHELL: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr,\n\t\t\t\t\tyr,\n\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\tshell_seed = shell_seed || Math.ceil(Math.random()*9999999);\n\n\t\t\t\txr = board.getX(args.x);\n\t\t\t\tyr = board.getY(args.y);\n\n\t\t\t\tvar radgrad;\n\n\t\t\t\tif(args.c == WGo.W) {\n\t\t\t\t\tradgrad = \"#aaa\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tradgrad = \"#000\";\n\t\t\t\t}\n\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\tthis.arc(xr-board.ls, yr-board.ls, Math.max(0, sr-0.5), 0, 2*Math.PI, true);\n\t\t\t\tthis.fill();\n\n\t\t\t\t// do shell magic here\n\t\t\t\tif(args.c == WGo.W) {\n\t\t\t\t\t// do shell magic here\n\t\t\t\t\tvar type = shell_seed%(3+args.x*board.size+args.y)%3;\n\t\t\t\t\tvar z = board.size*board.size+args.x*board.size+args.y;\n\t\t\t\t\tvar angle = (2/z)*(shell_seed%z);\n\n\t\t\t\t\tif(type == 0) {\n\t\t\t\t\t\tdraw_shell({\n\t\t\t\t\t\t\tctx: this,\n\t\t\t\t\t\t\tx: xr,\n\t\t\t\t\t\t\ty: yr,\n\t\t\t\t\t\t\tradius: sr,\n\t\t\t\t\t\t\tangle: angle,\n\t\t\t\t\t\t\tlines: [0.10, 0.12, 0.11, 0.10, 0.09, 0.09, 0.09, 0.09],\n\t\t\t\t\t\t\tfactor: 0.25,\n\t\t\t\t\t\t\tthickness: 1.75\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse if(type == 1) {\n\t\t\t\t\t\tdraw_shell({\n\t\t\t\t\t\t\tctx: this,\n\t\t\t\t\t\t\tx: xr,\n\t\t\t\t\t\t\ty: yr,\n\t\t\t\t\t\t\tradius: sr,\n\t\t\t\t\t\t\tangle: angle,\n\t\t\t\t\t\t\tlines: [0.10, 0.09, 0.08, 0.07, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06, 0.06],\n\t\t\t\t\t\t\tfactor: 0.2,\n\t\t\t\t\t\t\tthickness: 1.5\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tdraw_shell({\n\t\t\t\t\t\t\tctx: this,\n\t\t\t\t\t\t\tx: xr,\n\t\t\t\t\t\t\ty: yr,\n\t\t\t\t\t\t\tradius: sr,\n\t\t\t\t\t\t\tangle: angle,\n\t\t\t\t\t\t\tlines: [0.12, 0.14, 0.13, 0.12, 0.12, 0.12],\n\t\t\t\t\t\t\tfactor: 0.3,\n\t\t\t\t\t\t\tthickness: 2\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tradgrad = this.createRadialGradient(xr-2*sr/5,yr-2*sr/5,sr/3,xr-sr/5,yr-sr/5,5*sr/5);\n\t\t\t\t\tradgrad.addColorStop(0, 'rgba(255,255,255,0.9)');\n\t\t\t\t\tradgrad.addColorStop(1, 'rgba(255,255,255,0)');\n\n\t\t\t\t\t// add radial gradient //\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\tthis.arc(xr-board.ls, yr-board.ls, Math.max(0, sr-0.5), 0, 2*Math.PI, true);\n\t\t\t\t\tthis.fill();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tradgrad = this.createRadialGradient(xr+0.4*sr, yr+0.4*sr, 0, xr+0.5*sr, yr+0.5*sr, sr);\n\t\t\t\t\tradgrad.addColorStop(0, 'rgba(32,32,32,1)');\n\t\t\t\t\tradgrad.addColorStop(1, 'rgba(0,0,0,0)');\n\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\tthis.arc(xr-board.ls, yr-board.ls, Math.max(0, sr-0.5), 0, 2*Math.PI, true);\n\t\t\t\t\tthis.fill();\n\n\t\t\t\t\tradgrad = this.createRadialGradient(xr-0.4*sr, yr-0.4*sr, 1, xr-0.5*sr, yr-0.5*sr, 1.5*sr);\n\t\t\t\t\tradgrad.addColorStop(0, 'rgba(64,64,64,1)');\n\t\t\t\t\tradgrad.addColorStop(1, 'rgba(0,0,0,0)');\n\n\t\t\t\t\tthis.beginPath();\n\t\t\t\t\tthis.fillStyle = radgrad;\n\t\t\t\t\tthis.arc(xr-board.ls, yr-board.ls, Math.max(0, sr-0.5), 0, 2*Math.PI, true);\n\t\t\t\t\tthis.fill();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tshadow: shadow_handler,\n\t},\n\n\tMONO: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius,\n\t\t\t\t\tlw = theme_variable(\"markupLinesWidth\", board) || 1;\n\n\t\t\t\tif(args.c == WGo.W) this.fillStyle = \"white\";\n\t\t\t\telse this.fillStyle = \"black\";\n\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.arc(xr, yr, Math.max(0, sr-lw), 0, 2*Math.PI, true);\n\t\t\t\tthis.fill();\n\n\t\t\t\tthis.lineWidth = lw;\n\t\t\t\tthis.strokeStyle = \"black\";\n\t\t\t\tthis.stroke();\n\t\t\t}\n\t\t},\n\t},\n\n\tCR: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\tthis.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.arc(xr-board.ls, yr-board.ls, sr/2, 0, 2*Math.PI, true);\n\t\t\t\tthis.stroke();\n\t\t\t},\n\t\t},\n\t},\n\n\t// Label drawing handler\n\tLB: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius,\n\t\t\t\t\tfont = args.font || theme_variable(\"font\", board) || \"\";\n\n\t\t\t\tthis.fillStyle = args.c || get_markup_color(board, args.x, args.y);\n\n\t\t\t\tif(args.text.length == 1) this.font = Math.round(sr*1.5)+\"px \"+font;\n\t\t\t\telse if(args.text.length == 2) this.font = Math.round(sr*1.2)+\"px \"+font;\n\t\t\t\telse this.font = Math.round(sr)+\"px \"+font;\n\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.textBaseline=\"middle\";\n\t\t\t\tthis.textAlign=\"center\";\n\t\t\t\tthis.fillText(args.text, xr, yr, 2*sr);\n\n\t\t\t},\n\t\t},\n\n\t\t// modifies grid layer too\n\t\tgrid: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tif(!is_here_stone(board, args.x, args.y) && !args._nodraw) {\n\t\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\t\tsr = board.stoneRadius;\n\t\t\t\t\tthis.clearRect(xr-sr,yr-sr,2*sr,2*sr);\n\t\t\t\t}\n\t\t\t},\n\t\t\tclear: function(args, board) {\n\t\t\t\tif(!is_here_stone(board, args.x, args.y))  {\n\t\t\t\t\targs._nodraw = true;\n\t\t\t\t\tredraw_layer(board, \"grid\");\n\t\t\t\t\tdelete args._nodraw;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\n\tSQ: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = Math.round(board.stoneRadius);\n\n\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\tthis.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.rect(Math.round(xr-sr/2)-board.ls, Math.round(yr-sr/2)-board.ls, sr, sr);\n\t\t\t\tthis.stroke();\n\t\t\t}\n\t\t}\n\t},\n\n\tTR: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\tthis.lineWidth = args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1;\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.moveTo(xr-board.ls, yr-board.ls-Math.round(sr/2));\n\t\t\t\tthis.lineTo(Math.round(xr-sr/2)-board.ls, Math.round(yr+sr/3)+board.ls);\n\t\t\t\tthis.lineTo(Math.round(xr+sr/2)+board.ls, Math.round(yr+sr/3)+board.ls);\n\t\t\t\tthis.closePath();\n\t\t\t\tthis.stroke();\n\t\t\t}\n\t\t}\n\t},\n\n\tMA: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\tthis.lineCap=\"round\";\n\t\t\t\tthis.lineWidth = (args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1) * 2 - 1;\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.moveTo(Math.round(xr-sr/2), Math.round(yr-sr/2));\n\t\t\t\tthis.lineTo(Math.round(xr+sr/2), Math.round(yr+sr/2));\n\t\t\t\tthis.moveTo(Math.round(xr+sr/2)-1, Math.round(yr-sr/2));\n\t\t\t\tthis.lineTo(Math.round(xr-sr/2)-1, Math.round(yr+sr/2));\n\t\t\t\tthis.stroke();\n\t\t\t\tthis.lineCap=\"butt\";\n\t\t\t}\n\t\t}\n\t},\n\n\tSL: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\tthis.fillStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.rect(xr-sr/2, yr-sr/2, sr, sr);\n\t\t\t\tthis.fill();\n\t\t\t}\n\t\t}\n\t},\n\n\tSM: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tvar xr = board.getX(args.x),\n\t\t\t\t\tyr = board.getY(args.y),\n\t\t\t\t\tsr = board.stoneRadius;\n\n\t\t\t\tthis.strokeStyle = args.c || get_markup_color(board, args.x, args.y);\n\t\t\t\tthis.lineWidth = (args.lineWidth || theme_variable(\"markupLinesWidth\", board) || 1)*2;\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.arc(xr-sr/3, yr-sr/3, sr/6, 0, 2*Math.PI, true);\n\t\t\t\tthis.stroke();\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.arc(xr+sr/3, yr-sr/3, sr/6, 0, 2*Math.PI, true);\n\t\t\t\tthis.stroke();\n\t\t\t\tthis.beginPath();\n\t\t\t\tthis.moveTo(xr-sr/1.5,yr);\n\t\t\t\tthis.bezierCurveTo(xr-sr/1.5,yr+sr/2,xr+sr/1.5,yr+sr/2,xr+sr/1.5,yr);\n\t\t\t\tthis.stroke();\n\t\t\t}\n\t\t}\n\t},\n\n\toutline: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tif(args.alpha) this.globalAlpha = args.alpha;\n\t\t\t\telse this.globalAlpha = 0.3;\n\t\t\t\tif(args.stoneStyle) Board.drawHandlers[args.stoneStyle].stone.draw.call(this, args, board);\n\t\t\t\telse board.stoneHandler.stone.draw.call(this, args, board);\n\t\t\t\tthis.globalAlpha = 1;\n\t\t\t}\n\t\t}\n\t},\n\n\tmini: {\n\t\tstone: {\n\t\t\tdraw: function(args, board) {\n\t\t\t\tboard.stoneRadius = board.stoneRadius/2;\n\t\t\t\tif(args.stoneStyle) Board.drawHandlers[args.stoneStyle].stone.draw.call(this, args, board);\n\t\t\t\telse board.stoneHandler.stone.draw.call(this, args, board);\n\t\t\t\tboard.stoneRadius = board.stoneRadius*2;\n\t\t\t}\n\t\t}\n\t},\n}\n\nBoard.coordinates = {\n\tgrid: {\n\t\tdraw: function(args, board) {\n\t\t\tvar ch, t, xright, xleft, ytop, ybottom;\n\n\t\t\tthis.fillStyle = theme_variable(\"coordinatesColor\", board);\n\t\t\tthis.textBaseline=\"middle\";\n\t\t\tthis.textAlign=\"center\";\n\t\t\tthis.font = board.stoneRadius+\"px \"+(board.font || \"\");\n\n\t\t\txright = board.getX(-0.75);\n\t\t\txleft = board.getX(board.size-0.25);\n\t\t\tytop = board.getY(-0.75);\n\t\t\tybottom = board.getY(board.size-0.25);\n\n\t\t\tfor(var i = 0; i < board.size; i++) {\n\t\t\t\tch = i+\"A\".charCodeAt(0);\n\t\t\t\tif(ch >= \"I\".charCodeAt(0)) ch++;\n\n\t\t\t\tt = board.getY(i);\n\t\t\t\tthis.fillText(board.size-i, xright, t);\n\t\t\t\tthis.fillText(board.size-i, xleft, t);\n\n\t\t\t\tt = board.getX(i);\n\t\t\t\tthis.fillText(String.fromCharCode(ch), t, ytop);\n\t\t\t\tthis.fillText(String.fromCharCode(ch), t, ybottom);\n\t\t\t}\n\n\t\t\tthis.fillStyle = \"black\";\n\t\t}\n\t}\n}\n\nBoard.CanvasLayer = function() {\n\tthis.element = document.createElement('canvas');\n\tthis.context = this.element.getContext('2d');\n\n\t// Adjust pixel ratio for HDPI screens (e.g. Retina)\n\tthis.pixelRatio = window.devicePixelRatio || 1;\n\tif (this.pixelRatio > 1) {\n\t\tthis.context.scale(this.pixelRatio, this.pixelRatio);\n\t}\n}\n\nBoard.CanvasLayer.prototype = {\n\tconstructor: Board.CanvasLayer,\n\n\tsetDimensions: function(width, height) {\n\t\tthis.element.width = width;\n\t\tthis.element.style.width = (width / this.pixelRatio) + 'px';\n\t\tthis.element.height = height;\n\t\tthis.element.style.height = (height / this.pixelRatio) + 'px';\n\t},\n\n\tappendTo: function(element, weight) {\n\t\tthis.element.style.position = 'absolute';\n\t\tthis.element.style.zIndex = weight;\n\t\telement.appendChild(this.element);\n\t},\n\n\tremoveFrom: function(element) {\n\t\telement.removeChild(this.element);\n\t},\n\n\tgetContext: function() {\n\t\treturn this.context;\n\t},\n\n\tdraw: function(board) {\t},\n\n\tclear: function() {\n\t\tthis.context.clearRect(0,0,this.element.width,this.element.height);\n\t}\n}\n\nBoard.GridLayer = WGo.extendClass(Board.CanvasLayer, function() {\n\tthis.super.call(this);\n});\n\nBoard.GridLayer.prototype.draw = function(board) {\n\t// draw grid\n\tvar tmp;\n\n\tthis.context.beginPath();\n\tthis.context.lineWidth = theme_variable(\"gridLinesWidth\", board);\n\tthis.context.strokeStyle = theme_variable(\"gridLinesColor\", board);\n\n\tvar tx = Math.round(board.left),\n\t\tty = Math.round(board.top),\n\t\tbw = Math.round(board.fieldWidth*(board.size-1)),\n\t\tbh = Math.round(board.fieldHeight*(board.size-1));\n\n\tthis.context.strokeRect(tx-board.ls, ty-board.ls, bw, bh);\n\n\tfor(var i = 1; i < board.size-1; i++) {\n\t\ttmp = Math.round(board.getX(i))-board.ls;\n\t\tthis.context.moveTo(tmp, ty);\n\t\tthis.context.lineTo(tmp, ty+bh);\n\n\t\ttmp = Math.round(board.getY(i))-board.ls;\n\t\tthis.context.moveTo(tx, tmp);\n\t\tthis.context.lineTo(tx+bw, tmp);\n\t}\n\n\tthis.context.stroke();\n\n\t// draw stars\n\tthis.context.fillStyle = theme_variable(\"starColor\", board);\n\n\tif(board.starPoints[board.size]) {\n\t\tfor(var key in board.starPoints[board.size]) {\n\t\t\tthis.context.beginPath();\n\t\t\tthis.context.arc(board.getX(board.starPoints[board.size][key].x)-board.ls, board.getY(board.starPoints[board.size][key].y)-board.ls, theme_variable(\"starSize\", board), 0, 2*Math.PI,true);\n\t\t\tthis.context.fill();\n\t\t}\n\t}\n}\n\n/**\n * Layer that is composed from more canvases. The proper canvas is selected according to drawn object.\n * In default there are 4 canvases and they are used for board objects like stones. This allows overlapping of objects.\n */\nBoard.MultipleCanvasLayer = WGo.extendClass(Board.CanvasLayer, function() {\n\tthis.init(4);\n});\n\nBoard.MultipleCanvasLayer.prototype.init = function(n) {\n\tvar tmp, tmpContext;\n\n\tthis.layers = n;\n\n\tthis.elements = [];\n\tthis.contexts = [];\n\n\t// Adjust pixel ratio for HDPI screens (e.g. Retina)\n\tthis.pixelRatio = window.devicePixelRatio || 1;\n\n\tfor(var i = 0; i < n; i++) {\n\t\ttmp = document.createElement('canvas');\n\t\ttmpContext = tmp.getContext('2d');\n\n\t\tif (this.pixelRatio > 1) {\n\t\t\ttmpContext.scale(this.pixelRatio, this.pixelRatio);\n\t\t}\n\n\t\tthis.elements.push(tmp);\n\t\tthis.contexts.push(tmpContext);\n\t}\n}\n\nBoard.MultipleCanvasLayer.prototype.appendTo = function(element, weight) {\n\tfor(var i = 0; i < this.layers; i++) {\n\t\tthis.elements[i].style.position = 'absolute';\n\t\tthis.elements[i].style.zIndex = weight;\n\t\telement.appendChild(this.elements[i]);\n\t}\n}\n\nBoard.MultipleCanvasLayer.prototype.removeFrom = function(element) {\n\tfor(var i = 0; i < this.layers; i++) {\n\t\telement.removeChild(this.elements[i]);\n\t}\n}\n\nBoard.MultipleCanvasLayer.prototype.getContext = function(args) {\n\tif(args.x%2) {\n\t\treturn (args.y%2) ? this.contexts[0] : this.contexts[1];\n\t}\n\telse {\n\t\treturn (args.y%2) ? this.contexts[2] : this.contexts[3];\n\t}\n\t//return ((args.x%2) && (args.y%2) || !(args.x%2) && !(args.y%2)) ? this.context_odd : this.context_even;\n}\n\nBoard.MultipleCanvasLayer.prototype.clear = function(element, weight) {\n\tfor(var i = 0; i < this.layers; i++) {\n\t\tthis.contexts[i].clearRect(0,0,this.elements[i].width,this.elements[i].height);\n\t}\n}\n\nBoard.MultipleCanvasLayer.prototype.setDimensions = function(width, height) {\n\tfor(var i = 0; i < this.layers; i++) {\n\t\tthis.elements[i].width = width;\n\t\tthis.elements[i].style.width = (width / this.pixelRatio) + 'px';\n\t\tthis.elements[i].height = height;\n\t\tthis.elements[i].style.height = (height / this.pixelRatio) + 'px';\n\t}\n}\n\nBoard.ShadowLayer = WGo.extendClass(Board.MultipleCanvasLayer, function(board, shadowSize, shadowBlur) {\n\tthis.init(2);\n\tthis.shadowSize = shadowSize === undefined ? 1 : shadowSize;\n\tthis.board = board;\n});\n\nBoard.ShadowLayer.prototype.getContext = function(args) {\n\treturn ((args.x%2) && (args.y%2) || !(args.x%2) && !(args.y%2)) ? this.contexts[0] : this.contexts[1];\n}\n\nBoard.ShadowLayer.prototype.setDimensions = function(width, height) {\n\tthis.super.prototype.setDimensions.call(this, width, height);\n\n\tfor(var i = 0; i < this.layers; i++) {\n\t\tthis.contexts[i].setTransform(1,0,0,1,Math.round(this.shadowSize*this.board.stoneRadius/7),Math.round(this.shadowSize*this.board.stoneRadius/7));\n\t}\n}\n\nvar default_field_clear = function(args, board) {\n\tvar xr = board.getX(args.x),\n\t\tyr = board.getY(args.y),\n\t\tsr = board.stoneRadius;\n\tthis.clearRect(xr-2*sr-board.ls,yr-2*sr-board.ls, 4*sr, 4*sr);\n}\n\n// Private methods of WGo.Board\n\nvar calcLeftMargin = function() {\n\treturn (3*this.width)/(4*(this.bx+1-this.tx)+2) - this.fieldWidth*this.tx;\n}\n\nvar calcTopMargin = function() {\n\treturn (3*this.height)/(4*(this.by+1-this.ty)+2) - this.fieldHeight*this.ty;\n}\n\nvar calcFieldWidth = function() {\n\treturn (4*this.width)/(4*(this.bx+1-this.tx)+2);\n}\n\nvar calcFieldHeight = function() {\n\treturn (4*this.height)/(4*(this.by+1-this.ty)+2);\n}\n\nvar clearField = function(x,y) {\n\tvar handler;\n\tfor(var z = 0; z < this.obj_arr[x][y].length; z++) {\n\t\tvar obj = this.obj_arr[x][y][z];\n\t\tif(!obj.type) handler = this.stoneHandler;\n\t\telse if(typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];\n\t\telse handler = obj.type;\n\n\t\tfor(var layer in handler) {\n\t\t\tif(handler[layer].clear) handler[layer].clear.call(this[layer].getContext(obj), obj, this);\n\t\t\telse default_field_clear.call(this[layer].getContext(obj), obj, this);\n\t\t}\n\t}\n}\n\nvar drawField = function(x,y) {\n\tvar handler;\n\tfor(var z = 0; z < this.obj_arr[x][y].length; z++) {\n\t\tvar obj = this.obj_arr[x][y][z];\n\t\tif(!obj.type) handler = this.stoneHandler;\n\t\telse if(typeof obj.type == \"string\") handler = Board.drawHandlers[obj.type];\n\t\telse handler = obj.type;\n\n\t\tfor(var layer in handler) {\n\t\t\thandler[layer].draw.call(this[layer].getContext(obj), obj, this);\n\t\t}\n\t}\n}\n\nvar getMousePos = function(e) {\n\t// new hopefully better translation of coordinates\n\n\tvar x, y;\n\n\tx = e.offsetX * this.pixelRatio;\n\tx -= this.left;\n\tx /= this.fieldWidth;\n\tx = Math.round(x);\n\n\ty = e.offsetY * this.pixelRatio;\n\ty -= this.top;\n\ty /= this.fieldHeight;\n\ty = Math.round(y);\n\n\treturn {\n\t\tx: x >= this.size ? -1 : x,\n\t\ty: y >= this.size ? -1 : y\n\t};\n}\n\nvar updateDim = function() {\n\tthis.element.style.width = (this.width / this.pixelRatio) + \"px\";\n\tthis.element.style.height = (this.height / this.pixelRatio) + \"px\";\n\n\tthis.stoneRadius = theme_variable(\"stoneSize\", this);\n\t//if(this.autoLineWidth) this.lineWidth = this.stoneRadius/7; //< 15 ? 1 : 3;\n\tthis.ls = theme_variable(\"linesShift\", this);\n\n\tfor(var i = 0; i < this.layers.length; i++) {\n\t\tthis.layers[i].setDimensions(this.width, this.height);\n\t}\n}\n\n// Public methods are in the prototype:\n\nBoard.prototype = {\n\tconstructor: Board,\n\n\t/**\n     * Initialization method, it is called in constructor. You shouldn't call it, but you can alter it.\n\t */\n\n\tinit: function() {\n\n\t\t// placement of objects (in 3D array)\n\t\tthis.obj_arr = [];\n\t\tfor(var i = 0; i < this.size; i++) {\n\t\t\tthis.obj_arr[i] = [];\n\t\t\tfor(var j = 0; j < this.size; j++) this.obj_arr[i][j] = [];\n\t\t}\n\n\t\t// other objects, stored in list\n\t\tthis.obj_list = [];\n\n\t\t// layers\n\t\tthis.layers = [];\n\n\t\t// event listeners, binded to board\n\t\tthis.listeners = [];\n\n\t\tthis.element = document.createElement('div');\n\t\tthis.element.className = 'wgo-board';\n\t\tthis.element.style.position = 'relative';\n\n\t\tif(this.background) {\n\t\t\tif(this.background[0] == \"#\") this.element.style.backgroundColor = this.background;\n\t\t\telse {\n\t\t\t\tthis.element.style.backgroundImage = \"url('\"+this.background+\"')\";\n\t\t\t\t/*this.element.style.backgroundRepeat = \"repeat\";*/\n\t\t\t\tif(this.stoneHandler == Board.drawHandlers.REALISTIC){\n\t\t\t\t\t// The photographed wood images do not repeat and are the size of an actual\n\t\t\t\t\t// Go-Board. Therefore scale to fit.\n\t\t\t\t\tthis.element.style.backgroundSize = \"100%\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.grid = new Board.GridLayer();\n\t\tthis.shadow = new Board.ShadowLayer(this, theme_variable(\"shadowSize\", this));\n\t\tthis.stone = new Board.MultipleCanvasLayer();\n\n\t\tthis.addLayer(this.grid, 100);\n\t\tthis.addLayer(this.shadow, 200);\n\t\tthis.addLayer(this.stone, 300);\n\t},\n\n\t/**\n\t * Set new width of board, height is computed to keep aspect ratio.\n\t *\n\t * @param {number} width\n\t */\n\n\tsetWidth: function(width) {\n\t\tthis.width = width;\n\t\tthis.width *= this.pixelRatio;\n\t\tthis.fieldHeight = this.fieldWidth = calcFieldWidth.call(this);\n\t\tthis.left = calcLeftMargin.call(this);\n\n\t\tthis.height = (this.by-this.ty+1.5)*this.fieldHeight;\n\t\tthis.top = calcTopMargin.call(this);\n\n\t\tupdateDim.call(this);\n\t\tthis.redraw();\n\t},\n\n\t/**\n\t * Set new height of board, width is computed to keep aspect ratio.\n\t *\n\t * @param {number} height\n\t */\n\n\tsetHeight: function(height) {\n\t\tthis.height = height;\n\t\tthis.height *= this.pixelRatio;\n\t\tthis.fieldWidth = this.fieldHeight = calcFieldHeight.call(this);\n\t\tthis.top = calcTopMargin.call(this);\n\n\t\tthis.width = (this.bx-this.tx+1.5)*this.fieldWidth;\n\t\tthis.left = calcLeftMargin.call(this);\n\n\t\tupdateDim.call(this);\n\t\tthis.redraw();\n\t},\n\n\t/**\n\t * Set both dimensions.\n\t *\n\t * @param {number} width\n\t * @param {number} height\n\t */\n\n\tsetDimensions: function(width, height) {\n\t\tthis.width = width || parseInt(this.element.style.width, 10);\n\t\tthis.width *= this.pixelRatio;\n\t\tthis.height = height || parseInt(this.element.style.height, 10);\n\t\tthis.height *= this.pixelRatio;\n\n\t\tthis.fieldWidth = calcFieldWidth.call(this);\n\t\tthis.fieldHeight = calcFieldHeight.call(this);\n\t\tthis.left = calcLeftMargin.call(this);\n\t\tthis.top = calcTopMargin.call(this);\n\n\t\tupdateDim.call(this);\n\t\tthis.redraw();\n\t},\n\n\t/**\n\t * Get currently visible section of the board\n\t */\n\n\tgetSection: function() {\n\t\treturn this.section;\n\t},\n\n\t/**\n\t * Set section of the board to be displayed\n\t */\n\n\tsetSection: function(section_or_top, right, bottom, left) {\n\t\tif(typeof section_or_top == \"object\") {\n\t\t\tthis.section = section_or_top;\n\t\t}\n\t\telse {\n\t\t\tthis.section = {\n\t\t\t\ttop: section_or_top,\n\t\t\t\tright: right,\n\t\t\t\tbottom: bottom,\n\t\t\t\tleft: left,\n\t\t\t}\n\t\t}\n\n\t\tthis.tx = this.section.left;\n\t\tthis.ty = this.section.top;\n\t\tthis.bx = this.size-1-this.section.right;\n\t\tthis.by = this.size-1-this.section.bottom;\n\n\t\tthis.setDimensions();\n\t},\n\n\t/**\n\t * Set board size (eg: 9, 13 or 19), this will clear board's objects.\n\t */\n\n\tsetSize: function(size) {\n\t\tvar size = size || 19;\n\n\t\tif(size != this.size) {\n\t\t\tthis.size = size;\n\n\t\t\tthis.obj_arr = [];\n\t\t\tfor(var i = 0; i < this.size; i++) {\n\t\t\t\tthis.obj_arr[i] = [];\n\t\t\t\tfor(var j = 0; j < this.size; j++) this.obj_arr[i][j] = [];\n\t\t\t}\n\n\t\t\tthis.bx = this.size-1-this.section.right;\n\t\t\tthis.by = this.size-1-this.section.bottom;\n\t\t\tthis.setDimensions();\n\t\t}\n\t},\n\n\t/**\n\t * Redraw everything.\n\t */\n\n\tredraw: function() {\n\t\ttry {\n\t\t\t// redraw layers\n\t\t\tfor(var i = 0; i < this.layers.length; i++) {\n\t\t\t\tthis.layers[i].clear(this);\n\t\t\t\tthis.layers[i].draw(this);\n\t\t\t}\n\n\t\t\t// redraw field objects\n\t\t\tfor(var i = 0; i < this.size; i++) {\n\t\t\t\tfor(var j = 0; j < this.size; j++) {\n\t\t\t\t\tdrawField.call(this, i, j);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// redraw custom objects\n\t\t\tfor(var i = 0; i < this.obj_list.length; i++) {\n\t\t\t\tvar obj = this.obj_list[i];\n\t\t\t\tvar handler = obj.handler;\n\n\t\t\t\tfor(var layer in handler) {\n\t\t\t\t\thandler[layer].draw.call(this[layer].getContext(obj.args), obj.args, this);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch(err) {\n\t\t\t// If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n\t\t\tconsole.log(\"WGo board failed to render. Error: \"+err.message);\n\t\t}\n\t},\n\n\t/**\n\t * Get absolute X coordinate\n\t *\n\t * @param {number} x relative coordinate\n\t */\n\n\tgetX: function(x) {\n\t\treturn this.left+x*this.fieldWidth;\n\t},\n\n\t/**\n\t * Get absolute Y coordinate\n\t *\n\t * @param {number} y relative coordinate\n\t */\n\n\tgetY: function(y) {\n\t\treturn this.top+y*this.fieldHeight;\n\t},\n\n\t/**\n\t * Add layer to the board. It is meant to be only for canvas layers.\n\t *\n\t * @param {Board.CanvasLayer} layer to add\n\t * @param {number} weight layer with biggest weight is on the top\n\t */\n\n\taddLayer: function(layer, weight) {\n\t\tlayer.appendTo(this.element, weight);\n\t\tlayer.setDimensions(this.width, this.height);\n\t\tthis.layers.push(layer);\n\t},\n\n\t/**\n\t * Remove layer from the board.\n\t *\n\t * @param {Board.CanvasLayer} layer to remove\n\t */\n\n\tremoveLayer: function(layer) {\n\t\tvar i = this.layers.indexOf(layer);\n\t\tif(i >= 0) {\n\t\t\tthis.layers.splice(i,1);\n\t\t\tlayer.removeFrom(this.element);\n\t\t}\n\t},\n\n\tupdate: function(changes) {\n\t\tvar i;\n\t\tif(changes.remove && changes.remove == \"all\") this.removeAllObjects();\n\t\telse if(changes.remove) {\n\t\t\tfor(i = 0; i < changes.remove.length; i++) this.removeObject(changes.remove[i]);\n\t\t}\n\n\t\tif(changes.add) {\n\t\t\tfor(i = 0; i < changes.add.length; i++) this.addObject(changes.add[i]);\n\t\t}\n\t},\n\n\taddObject: function(obj) {\n\t\t// handling multiple objects\n\t\tif(obj.constructor == Array) {\n\t\t\tfor(var i = 0; i < obj.length; i++) this.addObject(obj[i]);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\t// clear all objects on object's coordinates\n\t\t\tclearField.call(this, obj.x, obj.y);\n\n\t\t\t// if object of this type is on the board, replace it\n\t\t\tvar layers = this.obj_arr[obj.x][obj.y];\n\t\t\tfor(var z = 0; z < layers.length; z++) {\n\t\t\t\tif(layers[z].type == obj.type) {\n\t\t\t\t\tlayers[z] = obj;\n\t\t\t\t\tdrawField.call(this, obj.x, obj.y);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if object is a stone, add it at the beginning, otherwise at the end\n\t\t\tif(!obj.type) layers.unshift(obj);\n\t\t\telse layers.push(obj);\n\n\t\t\t// draw all objects\n\t\t\tdrawField.call(this, obj.x, obj.y);\n\t\t}\n\t\tcatch(err) {\n\t\t\t// If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n\t\t\tconsole.log(\"WGo board failed to render. Error: \"+err.message);\n\t\t}\n\t},\n\n\tremoveObject: function(obj) {\n\t\t// handling multiple objects\n\t\tif(obj.constructor == Array) {\n\t\t\tfor(var n = 0; n < obj.length; n++) this.removeObject(obj[n]);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tvar i;\n\t\t\tfor(var j = 0; j < this.obj_arr[obj.x][obj.y].length; j++) {\n\t\t\t\tif(this.obj_arr[obj.x][obj.y][j].type == obj.type) {\n\t\t\t\t\ti = j;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(i === undefined) return;\n\n\t\t\t// clear all objects on object's coordinates\n\t\t\tclearField.call(this, obj.x, obj.y);\n\n\t\t\tthis.obj_arr[obj.x][obj.y].splice(i,1);\n\n\t\t\tdrawField.call(this, obj.x, obj.y);\n\t\t}\n\t\tcatch(err) {\n\t\t\t// If the board is too small some canvas painting function can throw an exception, but we don't want to break our app\n\t\t\tconsole.log(\"WGo board failed to render. Error: \"+err.message);\n\t\t}\n\t},\n\n\tremoveObjectsAt: function(x, y) {\n\t\tif(!this.obj_arr[x][y].length) return;\n\n\t\tclearField.call(this, x, y);\n\t\tthis.obj_arr[x][y] = [];\n\t},\n\n\tremoveAllObjects: function() {\n\t\tthis.obj_arr = [];\n\t\tfor(var i = 0; i < this.size; i++) {\n\t\t\tthis.obj_arr[i] = [];\n\t\t\tfor(var j = 0; j < this.size; j++) this.obj_arr[i][j] = [];\n\t\t}\n\t\tthis.redraw();\n\t},\n\n\taddCustomObject: function(handler, args) {\n\t\tthis.obj_list.push({handler: handler, args: args});\n\t\tthis.redraw();\n\t},\n\n\tremoveCustomObject: function(handler, args) {\n\t\tfor(var i = 0; i < this.obj_list.length; i++) {\n\t\t\tvar obj = this.obj_list[i];\n\t\t\tif(obj.handler == handler && obj.args == args) {\n\t\t\t\tthis.obj_list.splice(i, 1);\n\t\t\t\tthis.redraw();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\taddEventListener: function(type, callback) {\n\t\tvar _this = this,\n\t\t\tevListener = {\n\t\t\t\ttype: type,\n\t\t\t\tcallback: callback,\n\t\t\t\thandleEvent: function(e) {\n\t\t\t\t\tvar coo = getMousePos.call(_this, e);\n\t\t\t\t\tcallback(coo.x, coo.y, e);\n\t\t\t\t}\n\t\t\t};\n\n\t\tthis.element.addEventListener(type, evListener, true);\n\t\tthis.listeners.push(evListener);\n\t},\n\n\tremoveEventListener: function(type, callback) {\n\t\tfor(var i = 0; i < this.listeners.length; i++) {\n\t\t\tvar listener = this.listeners[i];\n\t\t\tif(listener.type == type && listener.callback == callback) {\n\t\t\t\tthis.element.removeEventListener(listener.type, listener, true);\n\t\t\t\tthis.listeners.splice(i, 1);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\tgetState: function() {\n\t\treturn {\n\t\t\tobjects: WGo.clone(this.obj_arr),\n\t\t\tcustom: WGo.clone(this.obj_list)\n\t\t};\n\t},\n\n\trestoreState: function(state) {\n\t\tthis.obj_arr = state.objects || this.obj_arr;\n\t\tthis.obj_list = state.custom || this.obj_list;\n\n\t\tthis.redraw();\n\t}\n}\n\nBoard.default = {\n\tsize: 19,\n\twidth: 0,\n\theight: 0,\n\tfont: \"Calibri\", // deprecated\n\tlineWidth: 1, // deprecated\n\tautoLineWidth: false, // deprecated\n  starPoints: {\n    5 :[{x: 2, y: 2}],\n    7 :[{x: 3, y: 3}],\n    8 :[{x: 2, y: 2}, {x: 5, y: 2}, {x: 2, y: 5}, {x: 5, y: 5}],\n    9 :[{x: 2, y: 2}, {x: 6, y: 2}, {x: 4, y: 4}, {x: 2, y: 6}, {x: 6, y: 6}],\n    10:[{x: 2, y: 2}, {x: 7, y: 2}, {x: 2, y: 7}, {x: 7, y: 7}],\n    11:[{x: 2, y: 2}, {x: 8, y: 2}, {x: 5, y: 5}, {x: 2, y: 8}, {x: 8, y: 8}],\n    12:[{x: 3, y: 3}, {x: 8, y: 3}, {x: 3, y: 8}, {x: 8, y: 8}],\n    13:[{x: 3, y: 3}, {x: 9, y: 3}, {x: 6, y: 6}, {x: 3, y: 9}, {x: 9, y: 9}],\n    14:[{x: 3, y: 3}, {x:10, y: 3}, {x: 3, y:10}, {x:10, y:10}],\n    15:[{x: 3, y: 3}, {x:11, y: 3}, {x: 7, y: 7}, {x: 3, y:11}, {x:11, y:11}],\n    16:[{x: 3, y: 3}, {x:12, y: 3}, {x: 3, y:12}, {x:12, y:12}],\n    17:[{x: 3, y: 3}, {x: 8, y: 3}, {x:13, y: 3}, {x: 3, y: 8}, {x: 8, y: 8},\n        {x:13, y: 8}, {x: 3, y:13}, {x: 8, y:13}, {x:13, y:13}],\n    18:[{x: 3, y: 3}, {x:14, y: 3}, {x: 3, y:14}, {x:14, y:14}],\n    19:[{x: 3, y: 3}, {x: 9, y: 3}, {x:15, y: 3}, {x: 3, y: 9}, {x: 9, y: 9},\n        {x:15, y: 9}, {x: 3, y:15}, {x: 9, y:15}, {x:15, y:15}],\n    20:[{x: 3, y: 3}, {x:16, y: 3}, {x: 3, y:16}, {x:16, y:16}],\n    21:[{x: 3, y: 3}, {x:10, y: 3}, {x:17, y: 3}, {x: 3, y:10}, {x:10, y:10},\n        {x:17, y:10}, {x: 3, y:17}, {x:10, y:17}, {x:17, y:17}],\n  },\n\t//stoneHandler: Board.drawHandlers.SHELL,\n\tstoneHandler: Board.drawHandlers.REALISTIC, // New photograph based stones\n\tstarSize: 1, // deprecated\n\tshadowSize: 1, // deprecated\n\tstoneSize: 1, // deprecated\n\tsection: {\n\t\ttop: 0,\n\t\tright: 0,\n\t\tbottom: 0,\n\t\tleft: 0,\n\t},\n\n\t//background: WGo.DIR+\"wood1.jpg\",    // Original version, tileing\n\t//background: WGo.DIR+\"wood_512.jpg\", // Mobile friendly, low resolution\n\tbackground: WGo.DIR+\"wood_1024.jpg\",  // High resolution version, use with REALISTIC handler\n\n\t//whiteStoneGraphic: [ WGo.DIR+\"white_128.png\" ], // Single image only, hires\n\t//blackStoneGraphic: [ WGo.DIR+\"black_128.png\" ], // Single image only, hires\n\n\t//whiteStoneGraphic: [ WGo.DIR+\"white_64.png\" ], // Single image only, lowres\n\t//blackStoneGraphic: [ WGo.DIR+\"black_64.png\" ], // Single image only, lowres\n\n\twhiteStoneGraphic: [  WGo.DIR + \"stones/white00_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white01_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white02_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white03_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white04_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white05_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white06_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white07_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white08_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white09_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/white10_128.png\"\n\t\t\t\t\t\t\t\t\t\t ],\n\tblackStoneGraphic: [ \tWGo.DIR + \"stones/black00_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/black01_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/black02_128.png\",\n\t\t\t\t\t\t\t\t\t\t\t\tWGo.DIR + \"stones/black03_128.png\"\n\t\t\t\t\t\t\t\t\t\t ],\n\n\ttheme: {}\n}\n\n// save Board\nWGo.Board = Board;\n\n//-------- WGo.Game ---------------------------------------------------------------------------\n\n/**\n * Creates instance of position object.\n *\n * @class\n * <p>WGo.Position is simple object storing position of go game. It is implemented as matrix <em>size</em> x <em>size</em> with values WGo.BLACK, WGo.WHITE or 0. It can be used by any extension.</p>\n *\n * @param {number} size of the board\n */\n\nvar Position = function(size) {\n\tthis.size = size || 19;\n\tthis.schema = [];\n\tfor(var i = 0; i < this.size*this.size; i++) {\n\t\tthis.schema[i] = 0;\n\t}\n}\n\nPosition.prototype = {\n\tconstructor: WGo.Position,\n\n\t/**\n\t * Returns value of given coordinates.\n\t *\n\t * @param {number} x coordinate\n\t * @param {number} y coordinate\n\t * @return {(WGo.BLACK|WGo.WHITE|0)} color\n\t */\n\n\tget: function(x,y) {\n\t\tif(x < 0 || y < 0 || x >= this.size || y >= this.size) return undefined;\n\t\treturn this.schema[x*this.size+y];\n\t},\n\n\t/**\n\t * Sets value of given coordinates.\n\t *\n\t * @param {number} x coordinate\n\t * @param {number} y coordinate\n\t * @param {(WGo.B|WGo.W|0)} c color\n\t */\n\n\tset: function(x,y,c) {\n\t\tthis.schema[x*this.size+y] = c;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Clears the whole position (every value is set to 0).\n\t */\n\n\tclear: function() {\n\t\tfor(var i = 0; i < this.size*this.size; i++) this.schema[i] = 0;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Clones the whole position.\n\t *\n\t * @return {WGo.Position} copy of position\n\t */\n\n\tclone: function() {\n\t\tvar clone = new Position(this.size);\n\t\tclone.schema = this.schema.slice(0);\n\t\treturn clone;\n\t},\n\n\t/**\n\t * Compares this position with another position and return change object\n\t *\n\t * @param {WGo.Position} position to compare to.\n\t * @return {object} change object with structure: {add:[], remove:[]}\n\t */\n\n\tcompare: function(position) {\n\t\tvar add = [], remove = [];\n\n\t\tfor(var i = 0; i < this.size*this.size; i++) {\n\t\t\tif(this.schema[i] && !position.schema[i]) remove.push({\n\t\t\t\tx: Math.floor(i/this.size),\n\t\t\t\ty: i%this.size\n\t\t\t});\n\t\t\telse if(this.schema[i] != position.schema[i]) add.push({\n\t\t\t\tx: Math.floor(i/this.size),\n\t\t\t\ty: i%this.size,\n\t\t\t\tc: position.schema[i]\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tadd: add,\n\t\t\tremove: remove\n\t\t}\n\t}\n}\n\nWGo.Position = Position;\n\n/**\n * Creates instance of game class.\n *\n * @class\n * This class implements game logic. It basically analyses given moves and returns capture stones.\n * WGo.Game also stores every position from beginning, so it has ability to check repeating positions\n * and it can effectively restore old positions.</p>\n *\n * @param {number} size of the board\n * @param {\"KO\"|\"ALL\"|\"NONE\"} checkRepeat (optional, default is \"KO\") - how to handle repeated position:\n * KO - ko is properly handled - position cannot be same like previous position\n * ALL - position cannot be same like any previous position - e.g. it forbids triple ko\n * NONE - position can be repeated\n *\n * @param {boolean} allowRewrite (optional, default is false) - allow to play moves, which were already played:\n * @param {boolean} allowSuicide (optional, default is false) - allow to play suicides, stones are immediately captured\n */\n\nvar Game = function(size, checkRepeat, allowRewrite, allowSuicide) {\n\tthis.size = size || 19;\n\tthis.repeating = checkRepeat === undefined ? \"KO\" : checkRepeat; // possible values: KO, ALL or nothing\n\tthis.allow_rewrite = allowRewrite || false;\n\tthis.allow_suicide = allowSuicide || false;\n\n\tthis.stack = [];\n\tthis.stack[0] = new Position(this.size);\n\tthis.stack[0].capCount = {black:0, white:0};\n\tthis.turn = WGo.B;\n\n\tObject.defineProperty(this, \"position\", {\n\t\tget : function(){ return this.stack[this.stack.length-1]; },\n\t\tset : function(pos){ this.stack[this.stack.length-1] = pos; }\n\t});\n}\n\n// function for stone capturing\nvar do_capture = function(position, captured, x, y, c) {\n\tif(x >= 0 && x < position.size && y >= 0 && y < position.size && position.get(x,y) == c) {\n\t\tposition.set(x,y,0);\n\t\tcaptured.push({x:x, y:y});\n\n\t\tdo_capture(position, captured, x, y-1, c);\n\t\tdo_capture(position, captured, x, y+1, c);\n\t\tdo_capture(position, captured, x-1, y, c);\n\t\tdo_capture(position, captured, x+1, y, c);\n\t}\n}\n// looking at liberties\nvar check_liberties = function(position, testing, x, y, c) {\n\t// out of the board there aren't liberties\n\tif(x < 0 || x >= position.size || y < 0 || y >= position.size) return true;\n\t// however empty field means liberty\n\tif(position.get(x,y) == 0) return false;\n\t// already tested field or stone of enemy isn't giving us a liberty.\n\tif(testing.get(x,y) == true || position.get(x,y) == -c) return true;\n\n\t// set this field as tested\n\ttesting.set(x,y,true);\n\n\t// in this case we are checking our stone, if we get 4 trues, it has no liberty\n\treturn \tcheck_liberties(position, testing, x, y-1, c) &&\n\t\t\tcheck_liberties(position, testing, x, y+1, c) &&\n\t\t\tcheck_liberties(position, testing, x-1, y, c) &&\n\t\t\tcheck_liberties(position, testing, x+1, y, c);\n}\n\n// analysing function - modifies original position, if there are some capturing, and returns array of captured stones\nvar check_capturing = function(position, x, y, c) {\n\tvar captured = [];\n\t// is there a stone possible to capture?\n\tif(x >= 0 && x < position.size && y >= 0 && y < position.size && position.get(x,y) == c) {\n\t\t// create testing map\n\t\tvar testing = new Position(position.size);\n\t\t// if it has zero liberties capture it\n\t\tif(check_liberties(position, testing, x, y, c)) {\n\t\t\t// capture stones from game\n\t\t\tdo_capture(position, captured, x, y, c);\n\t\t}\n\t}\n\treturn captured;\n}\n\n// analysing history\nvar checkHistory = function(position, x, y) {\n\tvar flag, stop;\n\n\tif(this.repeating == \"KO\" && this.stack.length-2 >= 0) stop = this.stack.length-2;\n\telse if(this.repeating == \"ALL\") stop = 0;\n\telse return true;\n\n\tfor(var i = this.stack.length-2; i >= stop; i--) {\n\t\tif(this.stack[i].get(x,y) == position.get(x,y)) {\n\t\t\tflag = true;\n\t\t\tfor(var j = 0; j < this.size*this.size; j++) {\n\t\t\t\tif(this.stack[i].schema[j] != position.schema[j]) {\n\t\t\t\t\tflag = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(flag) return false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nGame.prototype = {\n\n\tconstructor: Game,\n\n\t/**\n\t * Gets actual position.\n\t *\n\t * @return {WGo.Position} actual position\n\t */\n\n\tgetPosition: function() {\n\t\treturn this.stack[this.stack.length-1];\n\t},\n\n\t/**\n\t * Play move.\n\t *\n\t * @param {number} x coordinate\n\t * @param {number} y coordinate\n\t * @param {(WGo.B|WGo.W)} c color\n\t * @param {boolean} noplay - if true, move isn't played. Used by WGo.Game.isValid.\n\t * @return {number} code of error, if move isn't valid. If it is valid, function returns array of captured stones.\n\t *\n\t * Error codes:\n\t * 1 - given coordinates are not on board\n\t * 2 - on given coordinates already is a stone\n\t * 3 - suicide (currently they are forbbiden)\n\t * 4 - repeated position\n\t */\n\n\tplay: function(x,y,c,noplay) {\n\t\t//check coordinates validity\n\t\tif(!this.isOnBoard(x,y)) return 1;\n\t\tif(!this.allow_rewrite && this.position.get(x,y) != 0) return 2;\n\n\t\t// clone position\n\t\tif(!c) c = this.turn;\n\n\t\tvar new_pos = this.position.clone();\n\t\tnew_pos.set(x,y,c);\n\n\t\t// check capturing\n\t\tvar cap_color = c;\n\t\tvar captured = check_capturing(new_pos, x-1, y, -c).concat(check_capturing(new_pos, x+1, y, -c), check_capturing(new_pos, x, y-1, -c), check_capturing(new_pos, x, y+1, -c));\n\t\tconsole.log(captured)\n\t\t// check suicide\n\t\tif(!captured.length) {\n\t\t\tvar testing = new Position(this.size);\n\t\t\tif(check_liberties(new_pos, testing, x, y, c)) {\n\t\t\t\tif(this.allow_suicide) {\n\t\t\t\t\tcap_color = -c;\n\t\t\t\t\tdo_capture(new_pos, captured, x, y, c);\n\t\t\t\t}\n\t\t\t\telse return 3;\n\t\t\t}\n\t\t}\n\n\t\t// check history\n\t\tif(this.repeating && !checkHistory.call(this, new_pos, x, y)) {\n\t\t\treturn 4;\n\t\t}\n\n\t\tif(noplay) return false;\n\n\t\t// update position info\n\t\tnew_pos.color = c;\n\t\tnew_pos.capCount = {\n\t\t\tblack: this.position.capCount.black,\n\t\t\twhite: this.position.capCount.white\n\t\t};\n\t\tif(cap_color == WGo.B) new_pos.capCount.black += captured.length;\n\t\telse new_pos.capCount.white += captured.length;\n\n\t\t// save position\n\t\tthis.pushPosition(new_pos);\n\n\t\t// reverse turn\n\t\tthis.turn = -c;\n\n\t\treturn captured;\n\n\t},\n\n\t/**\n\t * Play pass.\n\t *\n\t * @param {(WGo.B|WGo.W)} c color\n\t */\n\n\tpass: function(c) {\n\t\tthis.pushPosition();\n\t\tif(c) {\n\t\t\tthis.position.color = c;\n\t\t\tthis.turn = -c;\n\t\t}\n\t\telse {\n\t\t\tthis.position.color = this.turn;\n\t\t\tthis.turn = -this.turn;\n\t\t}\n\t},\n\n\t/**\n\t * Finds out validity of the move.\n\t *\n\t * @param {number} x coordinate\n\t * @param {number} y coordinate\n\t * @param {(WGo.B|WGo.W)} c color\n\t * @return {boolean} true if move can be played.\n\t */\n\n\tisValid: function(x,y,c) {\n\t\treturn typeof this.play(x,y,c,true) != \"number\";\n\t},\n\n\t/**\n\t * Controls position of the move.\n\t *\n\t * @param {number} x coordinate\n\t * @param {number} y coordinate\n\t * @return {boolean} true if move is on board.\n\t */\n\n\tisOnBoard: function(x,y) {\n\t\treturn x >= 0 && y >= 0 && x < this.size && y < this.size;\n\t},\n\n\t/**\n\t * Inserts move into current position. Use for setting position, for example in handicap game. Field must be empty.\n\t *\n\t * @param {number} x coordinate\n\t * @param {number} y coordinate\n\t * @param {(WGo.B|WGo.W)} c color\n\t * @return {boolean} true if operation is successfull.\n\t */\n\n\taddStone: function(x,y,c) {\n\t\tif(this.isOnBoard(x,y) && this.position.get(x,y) == 0) {\n\t\t\tthis.position.set(x,y,c || 0);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes move from current position.\n\t *\n\t * @param {number} x coordinate\n\t * @param {number} y coordinate\n\t * @return {boolean} true if operation is successfull.\n\t */\n\n\tremoveStone: function(x,y) {\n\t\tif(this.isOnBoard(x,y) && this.position.get(x,y) != 0) {\n\t\t\tthis.position.set(x,y,0);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Set or insert move of current position.\n\t *\n\t * @param {number} x coordinate\n\t * @param {number} y coordinate\n\t * @param {(WGo.B|WGo.W)} c color\n\t * @return {boolean} true if operation is successfull.\n\t */\n\n\tsetStone: function(x,y,c) {\n\t\tif(this.isOnBoard(x,y)) {\n\t\t\tthis.position.set(x,y,c || 0);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Get stone on given position.\n\t *\n\t * @param {number} x coordinate\n\t * @param {number} y coordinate\n\t * @return {(WGo.B|WGo.W|0)} color\n\t */\n\n\tgetStone: function(x,y) {\n\t\tif(this.isOnBoard(x,y)) {\n\t\t\treturn this.position.get(x,y);\n\t\t}\n\t\treturn 0;\n\t},\n\n\t/**\n\t * Add position to stack. If position isn't specified current position is cloned and stacked.\n\t * Pointer of actual position is moved to the new position.\n\t *\n\t * @param {WGo.Position} tmp position (optional)\n\t */\n\n\tpushPosition: function(pos) {\n\t\tif(!pos) {\n\t\t\tvar pos = this.position.clone();\n\t\t\tpos.capCount = {\n\t\t\t\tblack: this.position.capCount.black,\n\t\t\t\twhite: this.position.capCount.white\n\t\t\t};\n\t\t\tpos.color = this.position.color;\n\t\t}\n\t\tthis.stack.push(pos);\n\t\tif(pos.color) this.turn = -pos.color;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Remove current position from stack. Pointer of actual position is moved to the previous position.\n\t */\n\n\tpopPosition: function() {\n\t\tvar old = null;\n\t\tif(this.stack.length > 0) {\n\t\t\told = this.stack.pop();\n\n\t\t\tif(this.stack.length == 0) this.turn = WGo.B;\n\t\t\telse if(this.position.color) this.turn = -this.position.color;\n\t\t\telse this.turn = -this.turn;\n\t\t}\n\t\treturn old;\n\t},\n\n\t/**\n\t * Removes all positions.\n\t */\n\n\tfirstPosition: function() {\n\t\tthis.stack = [];\n\t\tthis.stack[0] = new Position(this.size);\n\t\tthis.stack[0].capCount = {black:0, white:0};\n\t\tthis.turn = WGo.B;\n\t\treturn this;\n\t},\n\n\t/**\n\t * Gets count of captured stones.\n\t *\n\t * @param {(WGo.BLACK|WGo.WHITE)} color\n\t * @return {number} count\n\t */\n\n\tgetCaptureCount: function(color) {\n\t\treturn color == WGo.B ? this.position.capCount.black : this.position.capCount.white;\n\t},\n\n\t/**\n\t * Validate postion. Position is tested from 0:0 to size:size, if there are some moves, that should be captured, they will be removed.\n\t * You can use this, after insertion of more stones.\n\t *\n\t * @return array removed stones\n\t */\n\n\tvalidatePosition: function() {\n\t\tvar c, p,\n\t\t    white = 0,\n\t\t\tblack = 0,\n\t\t    captured = [],\n\t\t    new_pos = this.position.clone();\n\n\t\tfor(var x = 0; x < this.size; x++) {\n\t\t\tfor(var y = 0; y < this.size; y++) {\n\t\t\t\tc = this.position.get(x,y);\n\t\t\t\tif(c) {\n\t\t\t\t\tp = captured.length;\n\t\t\t\t\tcaptured = captured.concat(check_capturing(new_pos, x-1, y, -c),\n\t\t\t\t\t\t\t\t\t\t\t   check_capturing(new_pos, x+1, y, -c),\n\t\t\t\t\t\t\t\t\t\t\t   check_capturing(new_pos, x, y-1, -c),\n\t\t\t\t\t\t\t\t\t\t\t   check_capturing(new_pos, x, y+1, -c));\n\n\t\t\t\t\tif(c == WGo.B) black += captured-p;\n\t\t\t\t\telse white += captured-p;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.position.capCount.black += black;\n\t\tthis.position.capCount.white += white;\n\t\tthis.position.schema = new_pos.schema;\n\n\t\treturn captured;\n\t},\n};\n\n// save Game\nWGo.Game = Game;\n\n// register WGo\nwindow.WGo = WGo;\n\n})(window);\n"]}]}