{"remainingRequest":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/babel-loader/lib/index.js!/Users/linchengxun/Desktop/vuego-testfunc/node_modules/eslint-loader/index.js??ref--13-0!/Users/linchengxun/Desktop/vuego-testfunc/wgo.js-master/wgo/basicplayer.commentbox.js","dependencies":[{"path":"/Users/linchengxun/Desktop/vuego-testfunc/wgo.js-master/wgo/basicplayer.commentbox.js","mtime":1552470065945},{"path":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/linchengxun/Desktop/vuego-testfunc/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\n\n/* eslint-disable */\n(function (WGo, undefined) {\n  \"use strict\";\n\n  var prepare_dom = function prepare_dom() {\n    this.box = document.createElement(\"div\");\n    this.box.className = \"wgo-box-wrapper wgo-comments-wrapper\";\n    this.element.appendChild(this.box);\n    this.comments_title = document.createElement(\"div\");\n    this.comments_title.className = \"wgo-box-title\";\n    this.comments_title.innerHTML = WGo.t(\"comments\");\n    this.box.appendChild(this.comments_title);\n    this.comments = document.createElement(\"div\");\n    this.comments.className = \"wgo-comments-content\";\n    this.box.appendChild(this.comments);\n    this.help = document.createElement(\"div\");\n    this.help.className = \"wgo-help\";\n    this.help.style.display = \"none\";\n    this.comments.appendChild(this.help);\n    this.notification = document.createElement(\"div\");\n    this.notification.className = \"wgo-notification\";\n    this.notification.style.display = \"none\";\n    this.comments.appendChild(this.notification);\n    this.comment_text = document.createElement(\"div\");\n    this.comment_text.className = \"wgo-comment-text\";\n    this.comments.appendChild(this.comment_text);\n  };\n\n  var mark = function mark(move) {\n    var x, y;\n    x = move.charCodeAt(0) - 'a'.charCodeAt(0);\n    if (x < 0) x += 'a'.charCodeAt(0) - 'A'.charCodeAt(0);\n    if (x > 7) x--;\n    y = move.charCodeAt(1) - '0'.charCodeAt(0);\n    if (move.length > 2) y = y * 10 + (move.charCodeAt(2) - '0'.charCodeAt(0));\n    y = this.kifuReader.game.size - y;\n    this._tmp_mark = {\n      type: 'MA',\n      x: x,\n      y: y\n    };\n    this.board.addObject(this._tmp_mark);\n  };\n\n  var unmark = function unmark() {\n    this.board.removeObject(this._tmp_mark);\n    delete this._tmp_mark;\n  };\n\n  var search_nodes = function search_nodes(nodes, player) {\n    for (var i in nodes) {\n      if (nodes[i].className && nodes[i].className == \"wgo-move-link\") {\n        nodes[i].addEventListener(\"mouseover\", mark.bind(player, nodes[i].innerHTML));\n        nodes[i].addEventListener(\"mouseout\", unmark.bind(player));\n      } else if (nodes[i].childNodes && nodes[i].childNodes.length) search_nodes(nodes[i].childNodes, player);\n    }\n  };\n\n  var format_info = function format_info(info, title) {\n    var ret = '<div class=\"wgo-info-list\">';\n    if (title) ret += '<div class=\"wgo-info-title\">' + WGo.t(\"gameinfo\") + '</div>';\n\n    for (var key in info) {\n      ret += '<div class=\"wgo-info-item\"><span class=\"wgo-info-label\">' + key + '</span><span class=\"wgo-info-value\">' + info[key] + '</span></div>';\n    }\n\n    ret += '</div>';\n    return ret;\n  };\n  /**\n   * Implements box for comments and game informations.\n   */\n\n\n  var CommentBox = WGo.extendClass(WGo.BasicPlayer.component.Component, function (player) {\n    this.super(player);\n    this.player = player;\n    this.element.className = \"wgo-commentbox\";\n    prepare_dom.call(this);\n    player.addEventListener(\"kifuLoaded\", function (e) {\n      if (e.kifu.hasComments()) {\n        this.comments_title.innerHTML = WGo.t(\"comments\");\n        this.element.className = \"wgo-commentbox\";\n\n        this._update = function (e) {\n          this.setComments(e);\n        }.bind(this);\n\n        player.addEventListener(\"update\", this._update);\n      } else {\n        this.comments_title.innerHTML = WGo.t(\"gameinfo\");\n        this.element.className = \"wgo-commentbox wgo-gameinfo\";\n\n        if (this._update) {\n          player.removeEventListener(\"update\", this._update);\n          delete this._update;\n        }\n\n        this.comment_text.innerHTML = format_info(e.target.getGameInfo());\n      }\n    }.bind(this));\n\n    player.notification = function (text) {\n      if (text) {\n        this.notification.style.display = \"block\";\n        this.notification.innerHTML = text;\n        this.is_notification = true;\n      } else {\n        this.notification.style.display = \"none\";\n        this.is_notification = false;\n      }\n    }.bind(this);\n\n    player.help = function (text) {\n      if (text) {\n        this.help.style.display = \"block\";\n        this.help.innerHTML = text;\n        this.is_help = true;\n      } else {\n        this.help.style.display = \"none\";\n        this.is_help = false;\n      }\n    }.bind(this);\n  });\n\n  CommentBox.prototype.setComments = function (e) {\n    if (this.player._tmp_mark) unmark.call(this.player);\n    var msg = \"\";\n\n    if (!e.node.parent) {\n      msg = format_info(e.target.getGameInfo(), true);\n    }\n\n    this.comment_text.innerHTML = msg + this.getCommentText(e.node.comment, this.player.config.formatNicks, this.player.config.formatMoves);\n\n    if (this.player.config.formatMoves) {\n      if (this.comment_text.childNodes && this.comment_text.childNodes.length) search_nodes(this.comment_text.childNodes, this.player);\n    }\n  };\n\n  CommentBox.prototype.getCommentText = function (comment, formatNicks, formatMoves) {\n    // to avoid XSS we must transform < and > to entities, it is highly recomanded not to change it\n    //.replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\") : \"\";\n    if (comment) {\n      var comm = \"<p>\" + WGo.filterHTML(comment).replace(/\\n/g, \"</p><p>\") + \"</p>\";\n      if (formatNicks) comm = comm.replace(/(<p>)([^:]{3,}:)\\s/g, '<p><span class=\"wgo-comments-nick\">$2</span> ');\n      if (formatMoves) comm = comm.replace(/\\b[a-zA-Z]1?\\d\\b/g, '<a href=\"javascript:void(0)\" class=\"wgo-move-link\">$&</a>');\n      return comm;\n    }\n\n    return \"\";\n  };\n  /**\n   * Adding 2 configuration to BasicPlayer:\n   *\n   * - formatNicks: tries to highlight nicknames in comments (default: true)\n   * - formatMoves: tries to highlight coordinates in comments (default: true)\n   */\n\n\n  WGo.BasicPlayer.default.formatNicks = true;\n  WGo.BasicPlayer.default.formatMoves = true;\n\n  WGo.BasicPlayer.attributes[\"data-wgo-formatnicks\"] = function (value) {\n    if (value.toLowerCase() == \"false\") this.formatNicks = false;\n  };\n\n  WGo.BasicPlayer.attributes[\"data-wgo-formatmoves\"] = function (value) {\n    if (value.toLowerCase() == \"false\") this.formatMoves = false;\n  };\n\n  WGo.BasicPlayer.layouts[\"right_top\"].right.push(\"CommentBox\");\n  WGo.BasicPlayer.layouts[\"right\"].right.push(\"CommentBox\");\n  WGo.BasicPlayer.layouts[\"one_column\"].bottom.push(\"CommentBox\");\n  WGo.i18n.en[\"comments\"] = \"Comments\";\n  WGo.i18n.en[\"gameinfo\"] = \"Game info\";\n  WGo.BasicPlayer.component.CommentBox = CommentBox;\n})(WGo);",{"version":3,"sources":["/Users/linchengxun/Desktop/vuego-testfunc/wgo.js-master/wgo/basicplayer.commentbox.js"],"names":["WGo","undefined","prepare_dom","box","document","createElement","className","element","appendChild","comments_title","innerHTML","t","comments","help","style","display","notification","comment_text","mark","move","x","y","charCodeAt","length","kifuReader","game","size","_tmp_mark","type","board","addObject","unmark","removeObject","search_nodes","nodes","player","i","addEventListener","bind","childNodes","format_info","info","title","ret","key","CommentBox","extendClass","BasicPlayer","component","Component","super","call","e","kifu","hasComments","_update","setComments","removeEventListener","target","getGameInfo","text","is_notification","is_help","prototype","msg","node","parent","getCommentText","comment","config","formatNicks","formatMoves","comm","filterHTML","replace","default","attributes","value","toLowerCase","layouts","right","push","bottom","i18n","en"],"mappings":"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","sourcesContent":["/* eslint-disable */\n(function(WGo, undefined){\n\n\"use strict\";\n\nvar prepare_dom = function() {\n\tthis.box = document.createElement(\"div\");\n\tthis.box.className = \"wgo-box-wrapper wgo-comments-wrapper\";\n\tthis.element.appendChild(this.box);\n\t\n\tthis.comments_title = document.createElement(\"div\");\n\tthis.comments_title.className = \"wgo-box-title\";\n\tthis.comments_title.innerHTML = WGo.t(\"comments\");\n\tthis.box.appendChild(this.comments_title);\n\t\n\tthis.comments = document.createElement(\"div\");\n\tthis.comments.className = \"wgo-comments-content\";\n\tthis.box.appendChild(this.comments);\n\t\n\tthis.help = document.createElement(\"div\");\n\tthis.help.className = \"wgo-help\";\n\tthis.help.style.display = \"none\";\n\tthis.comments.appendChild(this.help);\n\t\n\tthis.notification = document.createElement(\"div\");\n\tthis.notification.className = \"wgo-notification\";\n\tthis.notification.style.display = \"none\";\n\tthis.comments.appendChild(this.notification);\n\t\n\tthis.comment_text = document.createElement(\"div\");\n\tthis.comment_text.className = \"wgo-comment-text\"; \n\tthis.comments.appendChild(this.comment_text);\n}\n\nvar mark = function(move) {\n\tvar x,y;\n\t\n\tx = move.charCodeAt(0)-'a'.charCodeAt(0);\n\tif(x < 0) x += 'a'.charCodeAt(0)-'A'.charCodeAt(0);\n\tif(x > 7) x--;\n\ty = (move.charCodeAt(1)-'0'.charCodeAt(0));\n\tif(move.length > 2) y = y*10+(move.charCodeAt(2)-'0'.charCodeAt(0));\n\ty = this.kifuReader.game.size-y;\n\n\tthis._tmp_mark = {type:'MA', x:x, y:y};\n\tthis.board.addObject(this._tmp_mark);\n}\n\nvar unmark = function() {\n\tthis.board.removeObject(this._tmp_mark);\n\tdelete this._tmp_mark;\n}\n\nvar search_nodes = function(nodes, player) {\n\tfor(var i in nodes) {\n\t\tif(nodes[i].className && nodes[i].className == \"wgo-move-link\") {\n\t\t\tnodes[i].addEventListener(\"mouseover\", mark.bind(player, nodes[i].innerHTML));\n\t\t\tnodes[i].addEventListener(\"mouseout\", unmark.bind(player));\n\t\t}\n\t\telse if(nodes[i].childNodes && nodes[i].childNodes.length) search_nodes(nodes[i].childNodes, player);\n\t}\n}\t\n\nvar format_info = function(info, title) {\n\tvar ret = '<div class=\"wgo-info-list\">';\n\tif(title) ret += '<div class=\"wgo-info-title\">'+WGo.t(\"gameinfo\")+'</div>';\n\tfor(var key in info) {\n\t\tret += '<div class=\"wgo-info-item\"><span class=\"wgo-info-label\">'+key+'</span><span class=\"wgo-info-value\">'+info[key]+'</span></div>';\n\t}\n\tret += '</div>';\n\treturn ret;\n}\n\n/**\n * Implements box for comments and game informations.\n */\n\nvar CommentBox = WGo.extendClass(WGo.BasicPlayer.component.Component, function(player) {\n\tthis.super(player);\n\tthis.player = player;\n\t\n\tthis.element.className = \"wgo-commentbox\";\n\t\n\tprepare_dom.call(this);\n\t\n\tplayer.addEventListener(\"kifuLoaded\", function(e) {\n\t\tif(e.kifu.hasComments()) {\n\t\t\tthis.comments_title.innerHTML = WGo.t(\"comments\");\n\t\t\tthis.element.className = \"wgo-commentbox\";\n\t\t\t\n\t\t\tthis._update = function(e) {\n\t\t\t\tthis.setComments(e);\n\t\t\t}.bind(this);\n\t\t\t\n\t\t\tplayer.addEventListener(\"update\", this._update);\n\t\t}\n\t\telse {\n\t\t\tthis.comments_title.innerHTML = WGo.t(\"gameinfo\");\n\t\t\tthis.element.className = \"wgo-commentbox wgo-gameinfo\";\n\t\t\t\n\t\t\tif(this._update) {\n\t\t\t\tplayer.removeEventListener(\"update\", this._update);\n\t\t\t\tdelete this._update;\n\t\t\t}\n\t\t\tthis.comment_text.innerHTML = format_info(e.target.getGameInfo());\n\t\t}\n\t}.bind(this));\n\t\n\tplayer.notification = function(text) {\n\t\tif(text) {\n\t\t\tthis.notification.style.display = \"block\";\n\t\t\tthis.notification.innerHTML = text;\n\t\t\tthis.is_notification = true;\n\t\t}\n\t\telse {\n\t\t\tthis.notification.style.display = \"none\";\n\t\t\tthis.is_notification = false;\n\t\t}\n\t}.bind(this);\n\t\n\tplayer.help = function(text) {\n\t\tif(text) {\n\t\t\tthis.help.style.display = \"block\";\n\t\t\tthis.help.innerHTML = text;\n\t\t\tthis.is_help = true;\n\t\t}\n\t\telse {\n\t\t\tthis.help.style.display = \"none\";\n\t\t\tthis.is_help = false;\n\t\t}\n\t}.bind(this);\n});\n\nCommentBox.prototype.setComments = function(e) {\n\tif(this.player._tmp_mark) unmark.call(this.player);\n\n\tvar msg = \"\";\n\tif(!e.node.parent) {\n\t\tmsg = format_info(e.target.getGameInfo(), true);\n\t}\n\t\n\tthis.comment_text.innerHTML = msg+this.getCommentText(e.node.comment, this.player.config.formatNicks, this.player.config.formatMoves);\n\n\tif(this.player.config.formatMoves) {\n\t\tif(this.comment_text.childNodes && this.comment_text.childNodes.length) search_nodes(this.comment_text.childNodes, this.player);\n\t}\n};\n\nCommentBox.prototype.getCommentText = function(comment, formatNicks, formatMoves) {\n\t// to avoid XSS we must transform < and > to entities, it is highly recomanded not to change it\n\t//.replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\") : \"\";\n\tif(comment) {\n\t\tvar comm =  \"<p>\"+WGo.filterHTML(comment).replace(/\\n/g, \"</p><p>\")+\"</p>\";\n\t\tif(formatNicks) comm = comm.replace(/(<p>)([^:]{3,}:)\\s/g, '<p><span class=\"wgo-comments-nick\">$2</span> ');\n\t\tif(formatMoves) comm = comm.replace(/\\b[a-zA-Z]1?\\d\\b/g, '<a href=\"javascript:void(0)\" class=\"wgo-move-link\">$&</a>');\n\t\treturn comm;\n\t}\n\treturn \"\";\n};\n\n/**\n * Adding 2 configuration to BasicPlayer:\n *\n * - formatNicks: tries to highlight nicknames in comments (default: true)\n * - formatMoves: tries to highlight coordinates in comments (default: true)\n */\n \nWGo.BasicPlayer.default.formatNicks = true;\nWGo.BasicPlayer.default.formatMoves = true;\n\nWGo.BasicPlayer.attributes[\"data-wgo-formatnicks\"] = function(value) {\n\tif(value.toLowerCase() == \"false\") this.formatNicks = false;\n}\n\t\nWGo.BasicPlayer.attributes[\"data-wgo-formatmoves\"] = function(value) {\n\tif(value.toLowerCase() == \"false\") this.formatMoves = false;\n}\n\nWGo.BasicPlayer.layouts[\"right_top\"].right.push(\"CommentBox\");\nWGo.BasicPlayer.layouts[\"right\"].right.push(\"CommentBox\");\nWGo.BasicPlayer.layouts[\"one_column\"].bottom.push(\"CommentBox\");\n\nWGo.i18n.en[\"comments\"] = \"Comments\";\nWGo.i18n.en[\"gameinfo\"] = \"Game info\";\n\nWGo.BasicPlayer.component.CommentBox = CommentBox\n\n})(WGo);\n"]}]}